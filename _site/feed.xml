<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="http://0.0.0.0:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://0.0.0.0:4000/" rel="alternate" type="text/html" hreflang="en" /><updated>2025-11-20T12:55:01-05:00</updated><id>http://0.0.0.0:4000/feed.xml</id><title type="html">Cybersecurityjunior</title><subtitle>From beginner tips and career transitions to advanced homelabs. Follow my journey and learn with me as I navigate the world of cyber.</subtitle><entry><title type="html">Compliance Frameworks: SOC 2, ISO 27001, and NIST Explained</title><link href="http://0.0.0.0:4000/posts/compliance-frameworks-explained/" rel="alternate" type="text/html" title="Compliance Frameworks: SOC 2, ISO 27001, and NIST Explained" /><published>2025-11-25T09:00:00-05:00</published><updated>2025-11-15T03:28:20-05:00</updated><id>http://0.0.0.0:4000/posts/compliance-frameworks-explained</id><content type="html" xml:base="http://0.0.0.0:4000/posts/compliance-frameworks-explained/"><![CDATA[<blockquote>
  <p><strong>Here‚Äôs the reality:</strong> Your customers want to know their data is safe. Your partners need assurance. Regulators require proof. Compliance frameworks provide that proof. But they can seem overwhelming - SOC 2, ISO 27001, NIST, PCI DSS, HIPAA‚Ä¶ Let‚Äôs break them down so you understand what they actually mean and why they matter.</p>
</blockquote>

<h2 id="what-is-compliance-really">What is Compliance, Really?</h2>

<p><strong>Compliance</strong> means following rules, standards, or laws. In cybersecurity, it means proving you have security controls in place.</p>

<p><strong>Think of it like this:</strong></p>
<ul>
  <li><strong>Without compliance:</strong> ‚ÄúTrust us, we‚Äôre secure‚Äù (not very convincing)</li>
  <li><strong>With compliance:</strong> ‚ÄúHere‚Äôs our SOC 2 report proving we‚Äôre secure‚Äù (much more convincing)</li>
</ul>

<p><strong>Why it matters:</strong></p>
<ol>
  <li><strong>Customer Trust</strong> - Customers want proof you‚Äôre secure</li>
  <li><strong>Business Requirements</strong> - Many companies require compliance to do business</li>
  <li><strong>Legal Requirements</strong> - Some industries require it by law</li>
  <li><strong>Risk Management</strong> - Helps identify and fix security gaps</li>
</ol>

<h2 id="soc-2-service-organization-control-2">SOC 2: Service Organization Control 2</h2>

<h3 id="what-is-soc-2">What is SOC 2?</h3>

<p><strong>SOC 2</strong> is a framework for service organizations (SaaS companies, cloud providers, etc.) to prove they have security controls.</p>

<p><strong>Think of it as:</strong> A report card for your security practices.</p>

<h3 id="the-5-trust-service-criteria">The 5 Trust Service Criteria</h3>

<p>SOC 2 evaluates 5 areas:</p>

<ol>
  <li><strong>Security</strong> - Required for all SOC 2 reports</li>
  <li><strong>Availability</strong> - Systems are available when needed</li>
  <li><strong>Processing Integrity</strong> - Data processing is accurate</li>
  <li><strong>Confidentiality</strong> - Sensitive data is protected</li>
  <li><strong>Privacy</strong> - Personal information is handled properly</li>
</ol>

<p><strong>Most companies start with Security only</strong>, then add others as needed.</p>

<h3 id="soc-2-types">SOC 2 Types</h3>

<ul>
  <li><strong>Type I</strong> - ‚ÄúWe have controls in place‚Äù (point in time)</li>
  <li><strong>Type II</strong> - ‚ÄúWe have controls and they work‚Äù (over 6-12 months)</li>
</ul>

<p><strong>Type II is more valuable</strong> - it proves your controls actually work over time.</p>

<h3 id="what-you-need-for-soc-2">What You Need for SOC 2</h3>

<ol>
  <li><strong>Access Controls</strong> - Who can access what</li>
  <li><strong>Change Management</strong> - How you manage changes</li>
  <li><strong>Monitoring</strong> - Logging and alerting</li>
  <li><strong>Incident Response</strong> - What you do when something goes wrong</li>
  <li><strong>Risk Assessment</strong> - Identifying and managing risks</li>
</ol>

<p><strong>Real-world example:</strong> Your compliance tool helps with SOC 2 by automatically checking:</p>
<ul>
  <li>IAM policies (access controls)</li>
  <li>S3 encryption (confidentiality)</li>
  <li>Security group configurations (security)</li>
  <li>VPC flow logs (monitoring)</li>
</ul>

<h3 id="soc-2-process">SOC 2 Process</h3>

<ol>
  <li><strong>Gap Assessment</strong> - Find what‚Äôs missing</li>
  <li><strong>Remediation</strong> - Fix the gaps</li>
  <li><strong>Audit</strong> - External auditor reviews everything</li>
  <li><strong>Report</strong> - Get your SOC 2 report</li>
  <li><strong>Maintenance</strong> - Keep controls working (annual audits)</li>
</ol>

<p><strong>Timeline:</strong> 6-12 months for first Type II report
<strong>Cost:</strong> $20,000 - $100,000+ depending on scope</p>

<h2 id="iso-27001-information-security-management">ISO 27001: Information Security Management</h2>

<h3 id="what-is-iso-27001">What is ISO 27001?</h3>

<p><strong>ISO 27001</strong> is an international standard for information security management systems (ISMS).</p>

<p><strong>Think of it as:</strong> A comprehensive security management system, not just controls.</p>

<h3 id="key-differences-from-soc-2">Key Differences from SOC 2</h3>

<table>
  <thead>
    <tr>
      <th>Feature</th>
      <th>SOC 2</th>
      <th>ISO 27001</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Focus</td>
      <td>Controls</td>
      <td>Management System</td>
    </tr>
    <tr>
      <td>Scope</td>
      <td>Service organizations</td>
      <td>Any organization</td>
    </tr>
    <tr>
      <td>Certification</td>
      <td>Report</td>
      <td>Certificate</td>
    </tr>
    <tr>
      <td>Geographic</td>
      <td>Primarily US</td>
      <td>International</td>
    </tr>
  </tbody>
</table>

<h3 id="iso-27001-structure">ISO 27001 Structure</h3>

<p><strong>14 Control Domains:</strong></p>
<ol>
  <li>Information Security Policies</li>
  <li>Organization of Information Security</li>
  <li>Human Resource Security</li>
  <li>Asset Management</li>
  <li>Access Control</li>
  <li>Cryptography</li>
  <li>Physical and Environmental Security</li>
  <li>Operations Security</li>
  <li>Communications Security</li>
  <li>System Acquisition, Development, and Maintenance</li>
  <li>Supplier Relationships</li>
  <li>Information Security Incident Management</li>
  <li>Business Continuity</li>
  <li>Compliance</li>
</ol>

<p><strong>That‚Äôs a lot!</strong> Most organizations implement a subset based on their needs.</p>

<h3 id="iso-27001-process">ISO 27001 Process</h3>

<ol>
  <li><strong>Define Scope</strong> - What‚Äôs included</li>
  <li><strong>Risk Assessment</strong> - Identify risks</li>
  <li><strong>Implement Controls</strong> - Put controls in place</li>
  <li><strong>Internal Audit</strong> - Check yourself</li>
  <li><strong>External Audit</strong> - Get certified</li>
  <li><strong>Maintain</strong> - Annual surveillance audits</li>
</ol>

<p><strong>Timeline:</strong> 12-18 months
<strong>Cost:</strong> $30,000 - $150,000+</p>

<h2 id="nist-national-institute-of-standards-and-technology">NIST: National Institute of Standards and Technology</h2>

<h3 id="what-is-nist">What is NIST?</h3>

<p><strong>NIST</strong> creates cybersecurity frameworks. The most popular is <strong>NIST Cybersecurity Framework (CSF)</strong>.</p>

<p><strong>Think of it as:</strong> A flexible framework you can adapt to your needs.</p>

<h3 id="nist-cybersecurity-framework">NIST Cybersecurity Framework</h3>

<p><strong>5 Core Functions:</strong></p>

<ol>
  <li><strong>Identify</strong> - Understand your systems and risks</li>
  <li><strong>Protect</strong> - Implement safeguards</li>
  <li><strong>Detect</strong> - Find security events</li>
  <li><strong>Respond</strong> - Handle incidents</li>
  <li><strong>Recover</strong> - Restore operations</li>
</ol>

<p><strong>Unlike SOC 2 and ISO 27001, NIST is voluntary</strong> - but many organizations use it.</p>

<h3 id="nist-800-53">NIST 800-53</h3>

<p><strong>NIST 800-53</strong> is a more detailed control catalog, often used by government contractors.</p>

<p><strong>18 Control Families:</strong></p>
<ul>
  <li>Access Control</li>
  <li>Audit and Accountability</li>
  <li>Security Assessment</li>
  <li>Configuration Management</li>
  <li>And 14 more‚Ä¶</li>
</ul>

<p><strong>Real-world use:</strong> Required for many US government contracts.</p>

<h2 id="comparing-the-frameworks">Comparing the Frameworks</h2>

<h3 id="when-to-use-which">When to Use Which?</h3>

<p><strong>SOC 2:</strong></p>
<ul>
  <li>SaaS companies</li>
  <li>Cloud service providers</li>
  <li>B2B software companies</li>
  <li>When customers ask for it</li>
</ul>

<p><strong>ISO 27001:</strong></p>
<ul>
  <li>International companies</li>
  <li>Organizations wanting certification</li>
  <li>Companies in regulated industries</li>
  <li>When you need a management system</li>
</ul>

<p><strong>NIST:</strong></p>
<ul>
  <li>Government contractors</li>
  <li>Organizations wanting flexibility</li>
  <li>Companies building security programs</li>
  <li>When you need a framework, not certification</li>
</ul>

<h3 id="can-you-do-multiple">Can You Do Multiple?</h3>

<p><strong>Yes!</strong> Many companies do:</p>
<ul>
  <li>SOC 2 for customers</li>
  <li>ISO 27001 for international markets</li>
  <li>NIST for government contracts</li>
</ul>

<p><strong>The good news:</strong> They overlap a lot. Controls for one help with others.</p>

<h2 id="how-your-compliance-tool-helps">How Your Compliance Tool Helps</h2>

<p>Your automated compliance tool helps with all these frameworks by:</p>

<h3 id="1-continuous-monitoring">1. Continuous Monitoring</h3>

<p>Instead of checking once a year, check continuously:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c1"># Daily compliance checks
</span><span class="k">def</span> <span class="nf">daily_compliance_scan</span><span class="p">():</span>
    <span class="n">findings</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">soc2</span><span class="sh">'</span><span class="p">:</span> <span class="nf">check_soc2_controls</span><span class="p">(),</span>
        <span class="sh">'</span><span class="s">iso27001</span><span class="sh">'</span><span class="p">:</span> <span class="nf">check_iso27001_controls</span><span class="p">(),</span>
        <span class="sh">'</span><span class="s">nist</span><span class="sh">'</span><span class="p">:</span> <span class="nf">check_nist_controls</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">findings</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-evidence-collection">2. Evidence Collection</h3>

<p>Automatically collect evidence for audits:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">collect_audit_evidence</span><span class="p">():</span>
    <span class="n">evidence</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">iam_policies</span><span class="sh">'</span><span class="p">:</span> <span class="nf">get_all_iam_policies</span><span class="p">(),</span>
        <span class="sh">'</span><span class="s">s3_encryption</span><span class="sh">'</span><span class="p">:</span> <span class="nf">check_s3_encryption</span><span class="p">(),</span>
        <span class="sh">'</span><span class="s">security_groups</span><span class="sh">'</span><span class="p">:</span> <span class="nf">audit_security_groups</span><span class="p">(),</span>
        <span class="sh">'</span><span class="s">vpc_flow_logs</span><span class="sh">'</span><span class="p">:</span> <span class="nf">verify_flow_logs</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">evidence</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-gap-analysis">3. Gap Analysis</h3>

<p>Identify what‚Äôs missing:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">gap_analysis</span><span class="p">():</span>
    <span class="n">required_controls</span> <span class="o">=</span> <span class="nf">load_framework_requirements</span><span class="p">(</span><span class="sh">'</span><span class="s">soc2</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">current_controls</span> <span class="o">=</span> <span class="nf">scan_current_state</span><span class="p">()</span>
    
    <span class="n">gaps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">required_controls</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">is_implemented</span><span class="p">(</span><span class="n">control</span><span class="p">,</span> <span class="n">current_controls</span><span class="p">):</span>
            <span class="n">gaps</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">control</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">gaps</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="common-compliance-controls">Common Compliance Controls</h2>

<h3 id="access-control-all-frameworks">Access Control (All Frameworks)</h3>

<p><strong>What it means:</strong> Control who can access what.</p>

<p><strong>How to implement:</strong></p>
<ul>
  <li>IAM policies with least privilege</li>
  <li>Multi-factor authentication</li>
  <li>Regular access reviews</li>
</ul>

<p><strong>Your tool checks:</strong></p>
<ul>
  <li>IAM policies for wildcards</li>
  <li>MFA enforcement</li>
  <li>Access key rotation</li>
</ul>

<h3 id="encryption-all-frameworks">Encryption (All Frameworks)</h3>

<p><strong>What it means:</strong> Protect data at rest and in transit.</p>

<p><strong>How to implement:</strong></p>
<ul>
  <li>Encrypt S3 buckets</li>
  <li>Use HTTPS/TLS</li>
  <li>Encrypt databases</li>
</ul>

<p><strong>Your tool checks:</strong></p>
<ul>
  <li>S3 encryption status</li>
  <li>Security group rules (HTTPS only)</li>
  <li>Database encryption</li>
</ul>

<h3 id="monitoring-all-frameworks">Monitoring (All Frameworks)</h3>

<p><strong>What it means:</strong> Know what‚Äôs happening in your systems.</p>

<p><strong>How to implement:</strong></p>
<ul>
  <li>CloudTrail for API logging</li>
  <li>VPC Flow Logs for network traffic</li>
  <li>SIEM for security events</li>
</ul>

<p><strong>Your tool checks:</strong></p>
<ul>
  <li>CloudTrail enabled</li>
  <li>Flow logs enabled</li>
  <li>Log retention periods</li>
</ul>

<h3 id="incident-response-all-frameworks">Incident Response (All Frameworks)</h3>

<p><strong>What it means:</strong> Have a plan when things go wrong.</p>

<p><strong>How to implement:</strong></p>
<ul>
  <li>Incident response plan</li>
  <li>Automated alerting</li>
  <li>Regular testing</li>
</ul>

<p><strong>Your tool helps:</strong></p>
<ul>
  <li>Automated security scanning</li>
  <li>Alerting on findings</li>
  <li>Evidence collection</li>
</ul>

<h2 id="building-a-compliance-program">Building a Compliance Program</h2>

<h3 id="step-1-choose-your-framework">Step 1: Choose Your Framework</h3>

<p>Start with what your customers/partners need:</p>
<ul>
  <li>B2B SaaS? ‚Üí SOC 2</li>
  <li>International? ‚Üí ISO 27001</li>
  <li>Government? ‚Üí NIST</li>
</ul>

<h3 id="step-2-gap-assessment">Step 2: Gap Assessment</h3>

<p>Find what‚Äôs missing:</p>
<ul>
  <li>Use your compliance tool</li>
  <li>Review framework requirements</li>
  <li>Document gaps</li>
</ul>

<h3 id="step-3-remediate">Step 3: Remediate</h3>

<p>Fix the gaps:</p>
<ul>
  <li>Implement missing controls</li>
  <li>Update policies</li>
  <li>Train staff</li>
</ul>

<h3 id="step-4-maintain">Step 4: Maintain</h3>

<p>Keep it working:</p>
<ul>
  <li>Continuous monitoring</li>
  <li>Regular audits</li>
  <li>Update controls as needed</li>
</ul>

<h2 id="key-takeaways">Key Takeaways</h2>

<ol>
  <li><strong>Compliance = Proof</strong> - Shows you‚Äôre secure</li>
  <li><strong>SOC 2</strong> - For service organizations (US-focused)</li>
  <li><strong>ISO 27001</strong> - International standard (certification)</li>
  <li><strong>NIST</strong> - Flexible framework (voluntary)</li>
  <li><strong>They Overlap</strong> - Controls help with multiple frameworks</li>
  <li><strong>Automation Helps</strong> - Tools like yours make compliance easier</li>
  <li><strong>It‚Äôs Ongoing</strong> - Not a one-time thing</li>
</ol>

<h2 id="practice-exercise">Practice Exercise</h2>

<p>Try this yourself:</p>

<ol>
  <li>Review SOC 2 Trust Service Criteria</li>
  <li>Map your current AWS controls to SOC 2</li>
  <li>Identify gaps using your compliance tool</li>
  <li>Create a remediation plan</li>
  <li>Document evidence for one control</li>
</ol>

<h2 id="resources-to-learn-more">Resources to Learn More</h2>

<ul>
  <li><a href="https://www.aicpa.org/interestareas/frc/assuranceadvisoryservices/aicpasoc2report.html">SOC 2 Guide</a></li>
  <li><a href="https://www.iso.org/standard/54534.html">ISO 27001 Standard</a></li>
  <li><a href="https://www.nist.gov/cyberframework">NIST Cybersecurity Framework</a></li>
</ul>

<h2 id="whats-next">What‚Äôs Next?</h2>

<p>Congratulations! You‚Äôve now learned all the skills needed to build and understand the automated AWS compliance tool:</p>

<ol>
  <li>‚úÖ AWS IAM - Access control</li>
  <li>‚úÖ AWS S3 - Secure storage</li>
  <li>‚úÖ EC2 Security Groups - Network security</li>
  <li>‚úÖ AWS VPC - Network architecture</li>
  <li>‚úÖ Python &amp; Boto3 - Automation</li>
  <li>‚úÖ Docker - Containerization</li>
  <li>‚úÖ Kubernetes - Orchestration</li>
  <li>‚úÖ Elasticsearch/SIEM - Security monitoring</li>
  <li>‚úÖ CI/CD Security - Secure deployments</li>
  <li>‚úÖ Infrastructure as Code - Managing infrastructure</li>
  <li>‚úÖ Compliance Frameworks - Understanding requirements</li>
</ol>

<p>You‚Äôre now ready to build production-ready security tools and understand enterprise security requirements!</p>

<blockquote>
  <p><strong>üí° Pro Tip:</strong> Start with one framework (usually SOC 2 for SaaS companies). Get that right, then consider others. Don‚Äôt try to do everything at once - compliance is a journey, not a destination!</p>
</blockquote>

<hr />

<p><em>You‚Äôve completed the learning path! Go back to the main compliance tool tutorial and build it with confidence. You now understand every component!</em></p>]]></content><author><name></name></author><category term="Compliance" /><category term="Security" /><category term="Business" /><category term="compliance" /><category term="soc2" /><category term="iso27001" /><category term="nist" /><category term="security-frameworks" /><category term="auditing" /><summary type="html"><![CDATA[Compliance frameworks are like safety standards for your organization. They prove to customers, partners, and regulators that you take security seriously. Let's break down the major frameworks - SOC 2, ISO 27001, and NIST - in plain English.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://placehold.co/1000x400/1F2937/FFFFFF?text=Compliance+Frameworks" /><media:content medium="image" url="https://placehold.co/1000x400/1F2937/FFFFFF?text=Compliance+Frameworks" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Infrastructure as Code: Managing Cloud Resources with Code</title><link href="http://0.0.0.0:4000/posts/infrastructure-as-code-basics/" rel="alternate" type="text/html" title="Infrastructure as Code: Managing Cloud Resources with Code" /><published>2025-11-24T09:00:00-05:00</published><updated>2025-11-15T03:28:20-05:00</updated><id>http://0.0.0.0:4000/posts/infrastructure-as-code-basics</id><content type="html" xml:base="http://0.0.0.0:4000/posts/infrastructure-as-code-basics/"><![CDATA[<blockquote>
  <p><strong>The old way:</strong> You need a VPC, some EC2 instances, and an S3 bucket. You log into AWS console, click around for an hour, create everything manually, and hope you remember what you did. <strong>The new way:</strong> You write code that defines your infrastructure. Run a command, and everything is created. Need to change something? Update the code. Need to recreate it? Run the code again. That‚Äôs Infrastructure as Code (IaC).</p>
</blockquote>

<h2 id="what-is-infrastructure-as-code">What is Infrastructure as Code?</h2>

<p><strong>Infrastructure as Code (IaC)</strong> means managing infrastructure (servers, networks, databases) using code and automation, rather than manual processes.</p>

<p><strong>Think of it like this:</strong></p>
<ul>
  <li><strong>Manual:</strong> Like building a house by telling workers what to do each day</li>
  <li><strong>IaC:</strong> Like having a blueprint (code) that workers follow exactly</li>
</ul>

<p><strong>Benefits:</strong></p>
<ol>
  <li><strong>Version Control</strong> - Track changes to infrastructure</li>
  <li><strong>Reproducibility</strong> - Create identical environments</li>
  <li><strong>Consistency</strong> - Same infrastructure every time</li>
  <li><strong>Speed</strong> - Deploy in minutes, not hours</li>
  <li><strong>Documentation</strong> - Code IS documentation</li>
</ol>

<h2 id="terraform-vs-pulumi">Terraform vs Pulumi</h2>

<h3 id="terraform">Terraform</h3>

<ul>
  <li>Uses HCL (HashiCorp Configuration Language)</li>
  <li>Declarative (you describe what you want)</li>
  <li>Very popular, huge ecosystem</li>
  <li>State management built-in</li>
</ul>

<h3 id="pulumi">Pulumi</h3>

<ul>
  <li>Uses real programming languages (Python, TypeScript, Go)</li>
  <li>More flexible, can use loops, functions, etc.</li>
  <li>Modern, cloud-native</li>
  <li>Great for complex logic</li>
</ul>

<p><strong>For beginners:</strong> Start with Terraform (simpler syntax). Then learn Pulumi if you need more flexibility.</p>

<h2 id="getting-started-with-terraform">Getting Started with Terraform</h2>

<h3 id="installation">Installation</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="c"># macOS</span>
brew <span class="nb">install </span>terraform

<span class="c"># Linux</span>
wget https://releases.hashicorp.com/terraform/1.6.0/terraform_1.6.0_linux_amd64.zip
unzip terraform_1.6.0_linux_amd64.zip
<span class="nb">sudo mv </span>terraform /usr/local/bin/
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="your-first-terraform-file">Your First Terraform File</h3>

<p>Create <code class="language-plaintext highlighter-rouge">main.tf</code>:</p>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td><td class="rouge-code"><pre><span class="c1"># Configure AWS Provider</span>
<span class="nx">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">aws</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">source</span>  <span class="o">=</span> <span class="s2">"hashicorp/aws"</span>
      <span class="nx">version</span> <span class="o">=</span> <span class="s2">"~&gt; 5.0"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="o">=</span> <span class="s2">"us-east-1"</span>
<span class="p">}</span>

<span class="c1"># Create an S3 bucket</span>
<span class="nx">resource</span> <span class="s2">"aws_s3_bucket"</span> <span class="s2">"compliance_reports"</span> <span class="p">{</span>
  <span class="nx">bucket</span> <span class="o">=</span> <span class="s2">"compliance-reports-2025"</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Name</span>        <span class="o">=</span> <span class="s2">"Compliance Reports"</span>
    <span class="nx">Environment</span> <span class="o">=</span> <span class="s2">"Production"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Enable encryption</span>
<span class="nx">resource</span> <span class="s2">"aws_s3_bucket_server_side_encryption_configuration"</span> <span class="s2">"compliance_reports"</span> <span class="p">{</span>
  <span class="nx">bucket</span> <span class="o">=</span> <span class="nx">aws_s3_bucket</span><span class="p">.</span><span class="nx">compliance_reports</span><span class="p">.</span><span class="nx">id</span>

  <span class="nx">rule</span> <span class="p">{</span>
    <span class="nx">apply_server_side_encryption_by_default</span> <span class="p">{</span>
      <span class="nx">sse_algorithm</span> <span class="o">=</span> <span class="s2">"AES256"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Block public access</span>
<span class="nx">resource</span> <span class="s2">"aws_s3_bucket_public_access_block"</span> <span class="s2">"compliance_reports"</span> <span class="p">{</span>
  <span class="nx">bucket</span> <span class="o">=</span> <span class="nx">aws_s3_bucket</span><span class="p">.</span><span class="nx">compliance_reports</span><span class="p">.</span><span class="nx">id</span>

  <span class="nx">block_public_acls</span>       <span class="o">=</span> <span class="kc">true</span>
  <span class="nx">block_public_policy</span>     <span class="o">=</span> <span class="kc">true</span>
  <span class="nx">ignore_public_acls</span>      <span class="o">=</span> <span class="kc">true</span>
  <span class="nx">restrict_public_buckets</span> <span class="o">=</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="initialize-and-apply">Initialize and Apply</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c"># Initialize Terraform (downloads providers)</span>
terraform init

<span class="c"># See what will be created (dry run)</span>
terraform plan

<span class="c"># Create the resources</span>
terraform apply

<span class="c"># Destroy everything (cleanup)</span>
terraform destroy
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="building-a-complete-vpc-with-terraform">Building a Complete VPC with Terraform</h2>

<p>Here‚Äôs a complete VPC setup:</p>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
</pre></td><td class="rouge-code"><pre><span class="c1"># variables.tf</span>
<span class="nx">variable</span> <span class="s2">"vpc_cidr"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"CIDR block for VPC"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">string</span>
  <span class="nx">default</span>     <span class="o">=</span> <span class="s2">"10.0.0.0/16"</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"environment"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"Environment name"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">string</span>
  <span class="nx">default</span>     <span class="o">=</span> <span class="s2">"production"</span>
<span class="p">}</span>

<span class="c1"># main.tf</span>
<span class="nx">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">aws</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">source</span>  <span class="o">=</span> <span class="s2">"hashicorp/aws"</span>
      <span class="nx">version</span> <span class="o">=</span> <span class="s2">"~&gt; 5.0"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="o">=</span> <span class="s2">"us-east-1"</span>
<span class="p">}</span>

<span class="c1"># VPC</span>
<span class="nx">resource</span> <span class="s2">"aws_vpc"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">cidr_block</span>           <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">vpc_cidr</span>
  <span class="nx">enable_dns_hostnames</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="nx">enable_dns_support</span>   <span class="o">=</span> <span class="kc">true</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.environment}-vpc"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Internet Gateway</span>
<span class="nx">resource</span> <span class="s2">"aws_internet_gateway"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span> <span class="o">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.environment}-igw"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Public Subnet</span>
<span class="nx">resource</span> <span class="s2">"aws_subnet"</span> <span class="s2">"public"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span>                  <span class="o">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">cidr_block</span>              <span class="o">=</span> <span class="s2">"10.0.1.0/24"</span>
  <span class="nx">availability_zone</span>       <span class="o">=</span> <span class="s2">"us-east-1a"</span>
  <span class="nx">map_public_ip_on_launch</span> <span class="o">=</span> <span class="kc">true</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.environment}-public-subnet"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Private Subnet</span>
<span class="nx">resource</span> <span class="s2">"aws_subnet"</span> <span class="s2">"private"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span>            <span class="o">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">cidr_block</span>        <span class="o">=</span> <span class="s2">"10.0.2.0/24"</span>
  <span class="nx">availability_zone</span> <span class="o">=</span> <span class="s2">"us-east-1a"</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.environment}-private-subnet"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># NAT Gateway (needs Elastic IP)</span>
<span class="nx">resource</span> <span class="s2">"aws_eip"</span> <span class="s2">"nat"</span> <span class="p">{</span>
  <span class="nx">domain</span> <span class="o">=</span> <span class="s2">"vpc"</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.environment}-nat-eip"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_nat_gateway"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">allocation_id</span> <span class="o">=</span> <span class="nx">aws_eip</span><span class="p">.</span><span class="nx">nat</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">subnet_id</span>     <span class="o">=</span> <span class="nx">aws_subnet</span><span class="p">.</span><span class="nx">public</span><span class="p">.</span><span class="nx">id</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.environment}-nat"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Route Tables</span>
<span class="nx">resource</span> <span class="s2">"aws_route_table"</span> <span class="s2">"public"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span> <span class="o">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>

  <span class="nx">route</span> <span class="p">{</span>
    <span class="nx">cidr_block</span> <span class="o">=</span> <span class="s2">"0.0.0.0/0"</span>
    <span class="nx">gateway_id</span> <span class="o">=</span> <span class="nx">aws_internet_gateway</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="p">}</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.environment}-public-rt"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_route_table"</span> <span class="s2">"private"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span> <span class="o">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>

  <span class="nx">route</span> <span class="p">{</span>
    <span class="nx">cidr_block</span>     <span class="o">=</span> <span class="s2">"0.0.0.0/0"</span>
    <span class="nx">nat_gateway_id</span> <span class="o">=</span> <span class="nx">aws_nat_gateway</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="p">}</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.environment}-private-rt"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Route Table Associations</span>
<span class="nx">resource</span> <span class="s2">"aws_route_table_association"</span> <span class="s2">"public"</span> <span class="p">{</span>
  <span class="nx">subnet_id</span>      <span class="o">=</span> <span class="nx">aws_subnet</span><span class="p">.</span><span class="nx">public</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">route_table_id</span> <span class="o">=</span> <span class="nx">aws_route_table</span><span class="p">.</span><span class="nx">public</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_route_table_association"</span> <span class="s2">"private"</span> <span class="p">{</span>
  <span class="nx">subnet_id</span>      <span class="o">=</span> <span class="nx">aws_subnet</span><span class="p">.</span><span class="nx">private</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">route_table_id</span> <span class="o">=</span> <span class="nx">aws_route_table</span><span class="p">.</span><span class="nx">private</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="getting-started-with-pulumi">Getting Started with Pulumi</h2>

<h3 id="installation-1">Installation</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># Install Pulumi CLI</span>
curl <span class="nt">-fsSL</span> https://get.pulumi.com | sh

<span class="c"># Or with Homebrew</span>
brew <span class="nb">install </span>pulumi
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="your-first-pulumi-program-python">Your First Pulumi Program (Python)</h3>

<p>Create <code class="language-plaintext highlighter-rouge">__main__.py</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">pulumi</span>
<span class="kn">import</span> <span class="n">pulumi_aws</span> <span class="k">as</span> <span class="n">aws</span>

<span class="c1"># Create S3 bucket
</span><span class="n">bucket</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">s3</span><span class="p">.</span><span class="nc">Bucket</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">compliance-reports</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">bucket</span><span class="o">=</span><span class="sh">"</span><span class="s">compliance-reports-2025</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">tags</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Compliance Reports</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">Environment</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Production</span><span class="sh">"</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Enable encryption
</span><span class="n">encryption</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">s3</span><span class="p">.</span><span class="nc">BucketServerSideEncryptionConfigurationV2</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">compliance-reports-encryption</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
    <span class="n">rules</span><span class="o">=</span><span class="p">[</span><span class="n">aws</span><span class="p">.</span><span class="n">s3</span><span class="p">.</span><span class="nc">BucketServerSideEncryptionConfigurationV2RuleArgs</span><span class="p">(</span>
        <span class="n">apply_server_side_encryption_by_default</span><span class="o">=</span><span class="n">aws</span><span class="p">.</span><span class="n">s3</span><span class="p">.</span><span class="nc">BucketServerSideEncryptionConfigurationV2RuleApplyServerSideEncryptionByDefaultArgs</span><span class="p">(</span>
            <span class="n">sse_algorithm</span><span class="o">=</span><span class="sh">"</span><span class="s">AES256</span><span class="sh">"</span>
        <span class="p">)</span>
    <span class="p">)]</span>
<span class="p">)</span>

<span class="c1"># Block public access
</span><span class="n">public_access_block</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">s3</span><span class="p">.</span><span class="nc">BucketPublicAccessBlock</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">compliance-reports-pab</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
    <span class="n">block_public_acls</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">block_public_policy</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">ignore_public_acls</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">restrict_public_buckets</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>

<span class="c1"># Export bucket name
</span><span class="n">pulumi</span><span class="p">.</span><span class="nf">export</span><span class="p">(</span><span class="sh">"</span><span class="s">bucket_name</span><span class="sh">"</span><span class="p">,</span> <span class="n">bucket</span><span class="p">.</span><span class="nb">id</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="run-pulumi">Run Pulumi</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c"># Initialize (creates project)</span>
pulumi new aws-python

<span class="c"># Preview changes</span>
pulumi preview

<span class="c"># Deploy</span>
pulumi up

<span class="c"># Destroy</span>
pulumi destroy
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="building-vpc-with-pulumi">Building VPC with Pulumi</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">pulumi</span>
<span class="kn">import</span> <span class="n">pulumi_aws</span> <span class="k">as</span> <span class="n">aws</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">pulumi</span><span class="p">.</span><span class="nc">Config</span><span class="p">()</span>
<span class="n">vpc_cidr</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">vpc_cidr</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">10.0.0.0/16</span><span class="sh">"</span>
<span class="n">environment</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">environment</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">production</span><span class="sh">"</span>

<span class="c1"># VPC
</span><span class="n">vpc</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">ec2</span><span class="p">.</span><span class="nc">Vpc</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">main-vpc</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">cidr_block</span><span class="o">=</span><span class="n">vpc_cidr</span><span class="p">,</span>
    <span class="n">enable_dns_hostnames</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">enable_dns_support</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">tags</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">environment</span><span class="si">}</span><span class="s">-vpc</span><span class="sh">"</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Internet Gateway
</span><span class="n">igw</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">ec2</span><span class="p">.</span><span class="nc">InternetGateway</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">main-igw</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">vpc_id</span><span class="o">=</span><span class="n">vpc</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
    <span class="n">tags</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">environment</span><span class="si">}</span><span class="s">-igw</span><span class="sh">"</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Public Subnet
</span><span class="n">public_subnet</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">ec2</span><span class="p">.</span><span class="nc">Subnet</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">public-subnet</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">vpc_id</span><span class="o">=</span><span class="n">vpc</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
    <span class="n">cidr_block</span><span class="o">=</span><span class="sh">"</span><span class="s">10.0.1.0/24</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">availability_zone</span><span class="o">=</span><span class="sh">"</span><span class="s">us-east-1a</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">map_public_ip_on_launch</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">tags</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">environment</span><span class="si">}</span><span class="s">-public-subnet</span><span class="sh">"</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Private Subnet
</span><span class="n">private_subnet</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">ec2</span><span class="p">.</span><span class="nc">Subnet</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">private-subnet</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">vpc_id</span><span class="o">=</span><span class="n">vpc</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
    <span class="n">cidr_block</span><span class="o">=</span><span class="sh">"</span><span class="s">10.0.2.0/24</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">availability_zone</span><span class="o">=</span><span class="sh">"</span><span class="s">us-east-1a</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">tags</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">environment</span><span class="si">}</span><span class="s">-private-subnet</span><span class="sh">"</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Elastic IP for NAT
</span><span class="n">eip</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">ec2</span><span class="p">.</span><span class="nc">Eip</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">nat-eip</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">domain</span><span class="o">=</span><span class="sh">"</span><span class="s">vpc</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">tags</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">environment</span><span class="si">}</span><span class="s">-nat-eip</span><span class="sh">"</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># NAT Gateway
</span><span class="n">nat_gw</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">ec2</span><span class="p">.</span><span class="nc">NatGateway</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">main-nat</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">allocation_id</span><span class="o">=</span><span class="n">eip</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
    <span class="n">subnet_id</span><span class="o">=</span><span class="n">public_subnet</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
    <span class="n">tags</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">environment</span><span class="si">}</span><span class="s">-nat</span><span class="sh">"</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Public Route Table
</span><span class="n">public_rt</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">ec2</span><span class="p">.</span><span class="nc">RouteTable</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">public-rt</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">vpc_id</span><span class="o">=</span><span class="n">vpc</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
    <span class="n">routes</span><span class="o">=</span><span class="p">[</span>
        <span class="n">aws</span><span class="p">.</span><span class="n">ec2</span><span class="p">.</span><span class="nc">RouteTableRouteArgs</span><span class="p">(</span>
            <span class="n">cidr_block</span><span class="o">=</span><span class="sh">"</span><span class="s">0.0.0.0/0</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">gateway_id</span><span class="o">=</span><span class="n">igw</span><span class="p">.</span><span class="nb">id</span>
        <span class="p">)</span>
    <span class="p">],</span>
    <span class="n">tags</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">environment</span><span class="si">}</span><span class="s">-public-rt</span><span class="sh">"</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Private Route Table
</span><span class="n">private_rt</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">ec2</span><span class="p">.</span><span class="nc">RouteTable</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">private-rt</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">vpc_id</span><span class="o">=</span><span class="n">vpc</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
    <span class="n">routes</span><span class="o">=</span><span class="p">[</span>
        <span class="n">aws</span><span class="p">.</span><span class="n">ec2</span><span class="p">.</span><span class="nc">RouteTableRouteArgs</span><span class="p">(</span>
            <span class="n">cidr_block</span><span class="o">=</span><span class="sh">"</span><span class="s">0.0.0.0/0</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">nat_gateway_id</span><span class="o">=</span><span class="n">nat_gw</span><span class="p">.</span><span class="nb">id</span>
        <span class="p">)</span>
    <span class="p">],</span>
    <span class="n">tags</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">environment</span><span class="si">}</span><span class="s">-private-rt</span><span class="sh">"</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Route Table Associations
</span><span class="n">public_rta</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">ec2</span><span class="p">.</span><span class="nc">RouteTableAssociation</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">public-rta</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">subnet_id</span><span class="o">=</span><span class="n">public_subnet</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
    <span class="n">route_table_id</span><span class="o">=</span><span class="n">public_rt</span><span class="p">.</span><span class="nb">id</span>
<span class="p">)</span>

<span class="n">private_rta</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">ec2</span><span class="p">.</span><span class="nc">RouteTableAssociation</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">private-rta</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">subnet_id</span><span class="o">=</span><span class="n">private_subnet</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
    <span class="n">route_table_id</span><span class="o">=</span><span class="n">private_rt</span><span class="p">.</span><span class="nb">id</span>
<span class="p">)</span>

<span class="c1"># Export outputs
</span><span class="n">pulumi</span><span class="p">.</span><span class="nf">export</span><span class="p">(</span><span class="sh">"</span><span class="s">vpc_id</span><span class="sh">"</span><span class="p">,</span> <span class="n">vpc</span><span class="p">.</span><span class="nb">id</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="nf">export</span><span class="p">(</span><span class="sh">"</span><span class="s">public_subnet_id</span><span class="sh">"</span><span class="p">,</span> <span class="n">public_subnet</span><span class="p">.</span><span class="nb">id</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="nf">export</span><span class="p">(</span><span class="sh">"</span><span class="s">private_subnet_id</span><span class="sh">"</span><span class="p">,</span> <span class="n">private_subnet</span><span class="p">.</span><span class="nb">id</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="security-best-practices">Security Best Practices</h2>

<h3 id="1-use-remote-state">1. Use Remote State</h3>

<p>Store Terraform state remotely (S3, not local):</p>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nx">terraform</span> <span class="p">{</span>
  <span class="nx">backend</span> <span class="s2">"s3"</span> <span class="p">{</span>
    <span class="nx">bucket</span> <span class="o">=</span> <span class="s2">"my-terraform-state"</span>
    <span class="nx">key</span>    <span class="o">=</span> <span class="s2">"compliance-tool/terraform.tfstate"</span>
    <span class="nx">region</span> <span class="o">=</span> <span class="s2">"us-east-1"</span>
    <span class="nx">encrypt</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-enable-state-locking">2. Enable State Locking</h3>

<p>Prevent concurrent modifications:</p>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nx">terraform</span> <span class="p">{</span>
  <span class="nx">backend</span> <span class="s2">"s3"</span> <span class="p">{</span>
    <span class="c1"># ... other config ...</span>
    <span class="nx">dynamodb_table</span> <span class="o">=</span> <span class="s2">"terraform-state-lock"</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-use-variables-not-hardcoded-values">3. Use Variables, Not Hardcoded Values</h3>

<p><strong>Bad:</strong></p>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nx">resource</span> <span class="s2">"aws_s3_bucket"</span> <span class="s2">"bucket"</span> <span class="p">{</span>
  <span class="nx">bucket</span> <span class="o">=</span> <span class="s2">"my-hardcoded-bucket-name"</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Good:</strong></p>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nx">variable</span> <span class="s2">"bucket_name"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="o">=</span> <span class="nx">string</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_s3_bucket"</span> <span class="s2">"bucket"</span> <span class="p">{</span>
  <span class="nx">bucket</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">bucket_name</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4-scan-infrastructure-code">4. Scan Infrastructure Code</h3>

<p>Use tools like <code class="language-plaintext highlighter-rouge">tfsec</code> or <code class="language-plaintext highlighter-rouge">checkov</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># Install tfsec</span>
brew <span class="nb">install </span>tfsec

<span class="c"># Scan Terraform code</span>
tfsec <span class="nb">.</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="5-use-modules">5. Use Modules</h3>

<p>Reusable components:</p>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nx">module</span> <span class="s2">"vpc"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="o">=</span> <span class="s2">"./modules/vpc"</span>
  
  <span class="nx">vpc_cidr</span> <span class="o">=</span> <span class="s2">"10.0.0.0/16"</span>
  <span class="nx">environment</span> <span class="o">=</span> <span class="s2">"production"</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="key-takeaways">Key Takeaways</h2>

<ol>
  <li><strong>IaC = Infrastructure as Code</strong> - Manage infrastructure with code</li>
  <li><strong>Terraform = HCL</strong> - Declarative, popular</li>
  <li><strong>Pulumi = Real Languages</strong> - More flexible</li>
  <li><strong>Version Control</strong> - Track all changes</li>
  <li><strong>Reproducible</strong> - Same infrastructure every time</li>
  <li><strong>Secure State</strong> - Store state remotely, encrypted</li>
  <li><strong>Scan Code</strong> - Use security scanning tools</li>
</ol>

<h2 id="practice-exercise">Practice Exercise</h2>

<p>Try this yourself:</p>

<ol>
  <li>Install Terraform</li>
  <li>Create a simple S3 bucket with Terraform</li>
  <li>Add encryption and public access block</li>
  <li>Deploy it</li>
  <li>Modify it</li>
  <li>Destroy it</li>
</ol>

<h2 id="resources-to-learn-more">Resources to Learn More</h2>

<ul>
  <li><a href="https://www.terraform.io/docs">Terraform Documentation</a></li>
  <li><a href="https://www.pulumi.com/docs/">Pulumi Documentation</a></li>
  <li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs">Terraform AWS Provider</a></li>
</ul>

<h2 id="whats-next">What‚Äôs Next?</h2>

<p>Now that you understand IaC, you‚Äôre ready to:</p>
<ul>
  <li>Build complete infrastructure stacks</li>
  <li>Version control your infrastructure</li>
  <li>Automate deployments</li>
</ul>

<p>Remember: Infrastructure as Code is about treating infrastructure like software. Version it, test it, review it!</p>

<blockquote>
  <p><strong>üí° Pro Tip:</strong> Start small with Terraform. Create one resource (like an S3 bucket), understand how it works, then gradually build more complex infrastructure. Don‚Äôt try to recreate your entire AWS account on day one!</p>
</blockquote>

<hr />

<p><em>Ready to understand compliance? Check out our final post on Compliance Frameworks, where we‚Äôll learn about SOC 2, ISO 27001, and NIST!</em></p>]]></content><author><name></name></author><category term="Infrastructure" /><category term="DevOps" /><category term="Cloud Security" /><category term="terraform" /><category term="pulumi" /><category term="infrastructure-as-code" /><category term="iac" /><category term="devops" /><category term="cloud" /><summary type="html"><![CDATA[Instead of clicking through AWS console to create resources, you write code that defines your infrastructure. This code can be versioned, reviewed, tested, and reused. Let's learn Terraform and Pulumi to manage infrastructure like software.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://placehold.co/1000x400/7B42BC/FFFFFF?text=Infrastructure+as+Code" /><media:content medium="image" url="https://placehold.co/1000x400/7B42BC/FFFFFF?text=Infrastructure+as+Code" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">CI/CD Security: Building Secure Deployment Pipelines</title><link href="http://0.0.0.0:4000/posts/cicd-security-fundamentals/" rel="alternate" type="text/html" title="CI/CD Security: Building Secure Deployment Pipelines" /><published>2025-11-23T09:00:00-05:00</published><updated>2025-11-15T03:28:20-05:00</updated><id>http://0.0.0.0:4000/posts/cicd-security-fundamentals</id><content type="html" xml:base="http://0.0.0.0:4000/posts/cicd-security-fundamentals/"><![CDATA[<blockquote>
  <p><strong>The challenge:</strong> You‚Äôve built an amazing application. Now you need to deploy it. Manually deploying is slow and error-prone. CI/CD automates this. But here‚Äôs the problem: if your pipeline isn‚Äôt secure, attackers can inject malicious code, steal secrets, or deploy vulnerable software. Let‚Äôs learn how to build secure CI/CD pipelines.</p>
</blockquote>

<h2 id="what-is-cicd-really">What is CI/CD, Really?</h2>

<p><strong>CI/CD</strong> stands for:</p>
<ul>
  <li><strong>CI (Continuous Integration)</strong> - Automatically build and test code when changes are pushed</li>
  <li><strong>CD (Continuous Deployment)</strong> - Automatically deploy code that passes tests</li>
</ul>

<p><strong>Think of it like this:</strong></p>
<ul>
  <li><strong>Without CI/CD:</strong> Write code ‚Üí Manually test ‚Üí Manually deploy ‚Üí Hope it works</li>
  <li><strong>With CI/CD:</strong> Write code ‚Üí Push to Git ‚Üí Pipeline automatically tests ‚Üí Automatically deploys if tests pass</li>
</ul>

<p><strong>The security problem:</strong> If your pipeline isn‚Äôt secure, it becomes an attack vector. Attackers can:</p>
<ul>
  <li>Inject malicious code</li>
  <li>Steal secrets (API keys, passwords)</li>
  <li>Deploy backdoors</li>
  <li>Access production systems</li>
</ul>

<h2 id="cicd-security-principles">CI/CD Security Principles</h2>

<h3 id="1-shift-left-security">1. Shift Left Security</h3>

<p><strong>‚ÄúShift left‚Äù</strong> means adding security early in the development process, not at the end.</p>

<p><strong>Bad approach:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Code ‚Üí Deploy ‚Üí Security Review ‚Üí Oops, found vulnerabilities!
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Good approach:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Code ‚Üí Security Scan ‚Üí Fix Issues ‚Üí Deploy
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-least-privilege">2. Least Privilege</h3>

<p>Give your pipeline only the permissions it needs, nothing more.</p>

<h3 id="3-secrets-management">3. Secrets Management</h3>

<p>Never hardcode secrets. Use secret management systems.</p>

<h3 id="4-code-scanning">4. Code Scanning</h3>

<p>Automatically scan code for vulnerabilities before deployment.</p>

<h2 id="github-actions-secure-pipeline-example">GitHub Actions: Secure Pipeline Example</h2>

<p>Here‚Äôs a secure CI/CD pipeline for the compliance tool:</p>

<h3 id="githubworkflowsci-cdyml">.github/workflows/ci-cd.yml</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
</pre></td><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">CI/CD Pipeline</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span> <span class="nv">main</span><span class="pi">,</span> <span class="nv">develop</span> <span class="pi">]</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span> <span class="nv">main</span> <span class="pi">]</span>

<span class="na">env</span><span class="pi">:</span>
  <span class="na">PYTHON_VERSION</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.11'</span>
  <span class="na">DOCKER_IMAGE</span><span class="pi">:</span> <span class="s">compliance-tool</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># Job 1: Code Quality Checks</span>
  <span class="na">code-quality</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout code</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Python</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-python@v4</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">python-version</span><span class="pi">:</span> <span class="s">$</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install dependencies</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">python -m pip install --upgrade pip</span>
          <span class="s">pip install -r requirements.txt</span>
          <span class="s">pip install pylint flake8</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run Pylint</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">pylint **/*.py --fail-under=7.0</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run Flake8</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics</span>

  <span class="c1"># Job 2: Security Scanning</span>
  <span class="na">security-scan</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout code</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run Bandit (SAST)</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">securecodewarrior/github-action-bandit@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">.</span>
          <span class="na">exit_zero</span><span class="pi">:</span> <span class="kc">false</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run Safety (Dependency Check)</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">pip install safety</span>
          <span class="s">safety check --json</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run Trivy (Container Scan)</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">aquasecurity/trivy-action@master</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">scan-type</span><span class="pi">:</span> <span class="s1">'</span><span class="s">fs'</span>
          <span class="na">scan-ref</span><span class="pi">:</span> <span class="s1">'</span><span class="s">.'</span>
          <span class="na">format</span><span class="pi">:</span> <span class="s1">'</span><span class="s">sarif'</span>
          <span class="na">output</span><span class="pi">:</span> <span class="s1">'</span><span class="s">trivy-results.sarif'</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Upload Trivy results</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">github/codeql-action/upload-sarif@v2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">sarif_file</span><span class="pi">:</span> <span class="s1">'</span><span class="s">trivy-results.sarif'</span>

  <span class="c1"># Job 3: Run Tests</span>
  <span class="na">test</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">code-quality</span><span class="pi">,</span> <span class="nv">security-scan</span><span class="pi">]</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout code</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Python</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-python@v4</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">python-version</span><span class="pi">:</span> <span class="s">$</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install dependencies</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">pip install -r requirements.txt</span>
          <span class="s">pip install pytest pytest-cov</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run tests</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">pytest tests/ --cov=. --cov-report=xml</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Upload coverage</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">codecov/codecov-action@v3</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">file</span><span class="pi">:</span> <span class="s">./coverage.xml</span>

  <span class="c1"># Job 4: Build Docker Image</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">test</span><span class="pi">]</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout code</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Docker Buildx</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/setup-buildx-action@v2</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Login to Docker Hub</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/login-action@v2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">username</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">password</span><span class="pi">:</span> <span class="s">$</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and push</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/build-push-action@v4</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
          <span class="na">push</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">tags</span><span class="pi">:</span> <span class="s">$/$:latest</span>
          <span class="na">cache-from</span><span class="pi">:</span> <span class="s">type=registry,ref=$/$:buildcache</span>
          <span class="na">cache-to</span><span class="pi">:</span> <span class="s">type=registry,ref=$/$:buildcache,mode=max</span>

  <span class="c1"># Job 5: Deploy to Kubernetes</span>
  <span class="na">deploy</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">build</span><span class="pi">]</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">github.ref == 'refs/heads/main'</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout code</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Configure AWS credentials</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">aws-actions/configure-aws-credentials@v2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">aws-access-key-id</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">aws-secret-access-key</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">aws-region</span><span class="pi">:</span> <span class="s">us-east-1</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up kubectl</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">azure/setup-kubectl@v3</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy to EKS</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">aws eks update-kubeconfig --name compliance-cluster</span>
          <span class="s">kubectl set image deployment/compliance-scanner \</span>
            <span class="s">scanner=$/$:latest \</span>
            <span class="s">-n compliance-system</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="security-best-practices-in-cicd">Security Best Practices in CI/CD</h2>

<h3 id="1-use-secrets-never-hardcode">1. Use Secrets, Never Hardcode</h3>

<p><strong>Bad:</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">aws configure set aws_access_key_id "AKIA..."</span>
    <span class="s">aws configure set aws_secret_access_key "secret..."</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Good:</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Configure AWS</span>
  <span class="na">uses</span><span class="pi">:</span> <span class="s">aws-actions/configure-aws-credentials@v2</span>
  <span class="na">with</span><span class="pi">:</span>
    <span class="na">aws-access-key-id</span><span class="pi">:</span> <span class="s">$</span>
    <span class="na">aws-secret-access-key</span><span class="pi">:</span> <span class="s">$</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-scan-dependencies">2. Scan Dependencies</h3>

<p>Always scan dependencies for vulnerabilities:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Safety check</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">pip install safety</span>
    <span class="s">safety check --json</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-scan-container-images">3. Scan Container Images</h3>

<p>Scan Docker images before deployment:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Trivy scan</span>
  <span class="na">uses</span><span class="pi">:</span> <span class="s">aquasecurity/trivy-action@master</span>
  <span class="na">with</span><span class="pi">:</span>
    <span class="na">image-ref</span><span class="pi">:</span> <span class="s1">'</span><span class="s">my-image:latest'</span>
    <span class="na">format</span><span class="pi">:</span> <span class="s1">'</span><span class="s">sarif'</span>
    <span class="na">output</span><span class="pi">:</span> <span class="s1">'</span><span class="s">trivy-results.sarif'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4-use-iam-roles-better-than-access-keys">4. Use IAM Roles (Better than Access Keys)</h3>

<p>For AWS, use OIDC instead of access keys:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Configure AWS credentials</span>
  <span class="na">uses</span><span class="pi">:</span> <span class="s">aws-actions/configure-aws-credentials@v2</span>
  <span class="na">with</span><span class="pi">:</span>
    <span class="na">role-to-assume</span><span class="pi">:</span> <span class="s">arn:aws:iam::123456789012:role/GitHubActionsRole</span>
    <span class="na">aws-region</span><span class="pi">:</span> <span class="s">us-east-1</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="5-require-approvals-for-production">5. Require Approvals for Production</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="na">deploy-production</span><span class="pi">:</span>
  <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
  <span class="na">environment</span><span class="pi">:</span> <span class="s">production</span>  <span class="c1"># Requires approval</span>
  <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">./deploy.sh</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="gitlab-ci-example">GitLab CI Example</h2>

<p>Here‚Äôs the same pipeline in GitLab CI:</p>

<h3 id="gitlab-ciyml">.gitlab-ci.yml</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
</pre></td><td class="rouge-code"><pre><span class="na">stages</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">quality</span>
  <span class="pi">-</span> <span class="s">security</span>
  <span class="pi">-</span> <span class="s">test</span>
  <span class="pi">-</span> <span class="s">build</span>
  <span class="pi">-</span> <span class="s">deploy</span>

<span class="na">variables</span><span class="pi">:</span>
  <span class="na">DOCKER_IMAGE</span><span class="pi">:</span> <span class="s">compliance-tool</span>
  <span class="na">PYTHON_VERSION</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.11"</span>

<span class="na">code-quality</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">quality</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">python:${PYTHON_VERSION}</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">pip install -r requirements.txt</span>
    <span class="pi">-</span> <span class="s">pip install pylint flake8</span>
    <span class="pi">-</span> <span class="s">pylint **/*.py --fail-under=7.0</span>
    <span class="pi">-</span> <span class="s">flake8 . --count --select=E9,F63,F7,F82</span>
  <span class="na">only</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">merge_requests</span>
    <span class="pi">-</span> <span class="s">main</span>

<span class="na">security-scan</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">security</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">python:${PYTHON_VERSION}</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">pip install safety bandit</span>
    <span class="pi">-</span> <span class="s">safety check</span>
    <span class="pi">-</span> <span class="s">bandit -r . -f json -o bandit-report.json</span>
  <span class="na">artifacts</span><span class="pi">:</span>
    <span class="na">reports</span><span class="pi">:</span>
      <span class="na">sast</span><span class="pi">:</span> <span class="s">bandit-report.json</span>
  <span class="na">only</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">merge_requests</span>
    <span class="pi">-</span> <span class="s">main</span>

<span class="na">test</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">python:${PYTHON_VERSION}</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">pip install -r requirements.txt</span>
    <span class="pi">-</span> <span class="s">pip install pytest pytest-cov</span>
    <span class="pi">-</span> <span class="s">pytest tests/ --cov=. --cov-report=xml</span>
  <span class="na">coverage</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/TOTAL.*\s+(\d+%)$/'</span>
  <span class="na">artifacts</span><span class="pi">:</span>
    <span class="na">reports</span><span class="pi">:</span>
      <span class="na">coverage_report</span><span class="pi">:</span>
        <span class="na">coverage_format</span><span class="pi">:</span> <span class="s">cobertura</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">coverage.xml</span>
  <span class="na">only</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">merge_requests</span>
    <span class="pi">-</span> <span class="s">main</span>

<span class="na">build</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">build</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">docker:latest</span>
  <span class="na">services</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">docker:dind</span>
  <span class="na">before_script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">docker build -t $CI_REGISTRY_IMAGE:latest .</span>
    <span class="pi">-</span> <span class="s">docker push $CI_REGISTRY_IMAGE:latest</span>
  <span class="na">only</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">main</span>

<span class="na">deploy</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">bitnami/kubectl:latest</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">kubectl set image deployment/compliance-scanner \</span>
        <span class="s">scanner=$CI_REGISTRY_IMAGE:latest \</span>
        <span class="s">-n compliance-system</span>
  <span class="na">environment</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">production</span>
  <span class="na">only</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">main</span>
  <span class="na">when</span><span class="pi">:</span> <span class="s">manual</span>  <span class="c1"># Requires manual approval</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="security-scanning-tools">Security Scanning Tools</h2>

<h3 id="1-bandit-python-sast">1. Bandit (Python SAST)</h3>

<p>Scans Python code for security issues:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>pip <span class="nb">install </span>bandit
bandit <span class="nt">-r</span> <span class="nb">.</span> <span class="nt">-f</span> json <span class="nt">-o</span> bandit-report.json
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Finds:</strong></p>
<ul>
  <li>Hardcoded passwords</li>
  <li>SQL injection risks</li>
  <li>Insecure random number generation</li>
  <li>And more</li>
</ul>

<h3 id="2-safety-dependency-check">2. Safety (Dependency Check)</h3>

<p>Checks Python dependencies for known vulnerabilities:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>pip <span class="nb">install </span>safety
safety check
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-trivy-container-scanning">3. Trivy (Container Scanning)</h3>

<p>Scans Docker images for vulnerabilities:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>trivy image my-image:latest
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4-snyk-multi-language">4. Snyk (Multi-language)</h3>

<p>Scans code, dependencies, and containers:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>snyk <span class="nb">test
</span>snyk monitor
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="secure-deployment-practices">Secure Deployment Practices</h2>

<h3 id="1-blue-green-deployment">1. Blue-Green Deployment</h3>

<p>Deploy to a new environment, test it, then switch traffic:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="na">deploy-blue</span><span class="pi">:</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">kubectl apply -f k8s/blue/</span>
    <span class="pi">-</span> <span class="s">./test-deployment.sh blue</span>
    <span class="pi">-</span> <span class="s">kubectl switch blue</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-canary-deployment">2. Canary Deployment</h3>

<p>Deploy to a small percentage, monitor, then roll out:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="na">deploy-canary</span><span class="pi">:</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">kubectl set image deployment/app app=my-image:new -n production</span>
    <span class="pi">-</span> <span class="s">kubectl scale deployment/app --replicas=1 -n production</span>
    <span class="pi">-</span> <span class="s">sleep </span><span class="m">300</span>  <span class="c1"># Monitor for 5 minutes</span>
    <span class="pi">-</span> <span class="s">kubectl scale deployment/app --replicas=10 -n production</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-rollback-strategy">3. Rollback Strategy</h3>

<p>Always have a rollback plan:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="na">rollback</span><span class="pi">:</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">kubectl rollout undo deployment/app -n production</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="key-takeaways">Key Takeaways</h2>

<ol>
  <li><strong>CI/CD = Automation</strong> - But must be secure</li>
  <li><strong>Shift Left Security</strong> - Scan early, not late</li>
  <li><strong>Use Secrets Management</strong> - Never hardcode</li>
  <li><strong>Scan Everything</strong> - Code, dependencies, containers</li>
  <li><strong>Least Privilege</strong> - Minimal permissions</li>
  <li><strong>Require Approvals</strong> - For production deployments</li>
  <li><strong>Have Rollback Plans</strong> - Things will break</li>
</ol>

<h2 id="practice-exercise">Practice Exercise</h2>

<p>Try this yourself:</p>

<ol>
  <li>Create a GitHub Actions workflow</li>
  <li>Add code quality checks</li>
  <li>Add security scanning (Bandit, Safety)</li>
  <li>Add container scanning (Trivy)</li>
  <li>Configure secrets properly</li>
  <li>Add deployment step</li>
</ol>

<h2 id="resources-to-learn-more">Resources to Learn More</h2>

<ul>
  <li><a href="https://docs.github.com/en/actions/security-guides">GitHub Actions Security</a></li>
  <li><a href="https://docs.gitlab.com/ee/ci/security/">GitLab CI/CD Security</a></li>
  <li><a href="https://owasp.org/www-project-top-10-ci-cd-security-risks/">OWASP CI/CD Security</a></li>
</ul>

<h2 id="whats-next">What‚Äôs Next?</h2>

<p>Now that you understand CI/CD security, you‚Äôre ready to:</p>
<ul>
  <li>Build production-ready pipelines</li>
  <li>Integrate security scanning</li>
  <li>Deploy securely to cloud platforms</li>
</ul>

<p>Remember: Secure CI/CD is about automation AND security. Don‚Äôt sacrifice one for the other!</p>

<blockquote>
  <p><strong>üí° Pro Tip:</strong> Start with a simple pipeline, then gradually add security checks. Don‚Äôt try to implement everything at once. Get the basics working first, then enhance security!</p>
</blockquote>

<hr />

<p><em>Ready to manage infrastructure as code? Check out our next post on Infrastructure as Code, where we‚Äôll learn Terraform and Pulumi!</em></p>]]></content><author><name></name></author><category term="CI/CD" /><category term="DevSecOps" /><category term="Security" /><category term="cicd" /><category term="devsecops" /><category term="security" /><category term="github-actions" /><category term="gitlab-ci" /><category term="jenkins" /><category term="automation" /><summary type="html"><![CDATA[CI/CD (Continuous Integration/Continuous Deployment) pipelines automate your software delivery. But automation without security is dangerous. Let's learn how to build secure pipelines that scan code, test security, and deploy safely.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://placehold.co/1000x400/2088FF/FFFFFF?text=CI%2FCD+Security" /><media:content medium="image" url="https://placehold.co/1000x400/2088FF/FFFFFF?text=CI%2FCD+Security" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Elasticsearch &amp;amp; SIEM: Security Monitoring for Beginners</title><link href="http://0.0.0.0:4000/posts/elasticsearch-siem-basics/" rel="alternate" type="text/html" title="Elasticsearch &amp;amp; SIEM: Security Monitoring for Beginners" /><published>2025-11-22T09:00:00-05:00</published><updated>2025-11-15T03:28:20-05:00</updated><id>http://0.0.0.0:4000/posts/elasticsearch-siem-basics</id><content type="html" xml:base="http://0.0.0.0:4000/posts/elasticsearch-siem-basics/"><![CDATA[<blockquote>
  <p><strong>Here‚Äôs the reality:</strong> Security events happen constantly. Failed login attempts, unusual network traffic, configuration changes - thousands of events every minute. Manually reviewing logs is impossible. SIEM (Security Information and Event Management) systems collect, analyze, and alert on these events automatically. Elasticsearch is often the engine behind SIEM solutions. Let‚Äôs learn how it works.</p>
</blockquote>

<h2 id="what-is-siem-really">What is SIEM, Really?</h2>

<p><strong>SIEM</strong> stands for Security Information and Event Management. Think of it as:</p>

<p><strong>Real-world analogy:</strong></p>
<ul>
  <li><strong>Logs</strong> = Security camera footage</li>
  <li><strong>SIEM</strong> = The system that watches all cameras 24/7</li>
  <li><strong>Alerts</strong> = Notifications when something suspicious happens</li>
  <li><strong>Dashboards</strong> = The control room where you see everything</li>
</ul>

<p><strong>What SIEM does:</strong></p>
<ol>
  <li><strong>Collects</strong> logs from all your systems (servers, network devices, applications)</li>
  <li><strong>Stores</strong> them in a searchable database (Elasticsearch)</li>
  <li><strong>Analyzes</strong> them for patterns and anomalies</li>
  <li><strong>Alerts</strong> you when something suspicious happens</li>
  <li><strong>Visualizes</strong> data in dashboards</li>
</ol>

<h2 id="the-elk-stack">The ELK Stack</h2>

<p><strong>ELK</strong> stands for:</p>
<ul>
  <li><strong>Elasticsearch</strong> - Search and analytics engine</li>
  <li><strong>Logstash</strong> - Data processing pipeline</li>
  <li><strong>Kibana</strong> - Visualization and dashboards</li>
</ul>

<p><strong>How they work together:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Logs ‚Üí Logstash (processes) ‚Üí Elasticsearch (stores) ‚Üí Kibana (visualizes)
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="understanding-elasticsearch">Understanding Elasticsearch</h2>

<h3 id="what-is-elasticsearch">What is Elasticsearch?</h3>

<p>Elasticsearch is a search engine built on Apache Lucene. Think of it like Google, but for your logs.</p>

<p><strong>Key concepts:</strong></p>

<ol>
  <li><strong>Index</strong> - Like a database (e.g., ‚Äúsecurity-logs‚Äù)</li>
  <li><strong>Document</strong> - Like a row in a database (a single log entry)</li>
  <li><strong>Field</strong> - Like a column (e.g., ‚Äútimestamp‚Äù, ‚Äúsource_ip‚Äù)</li>
  <li><strong>Query</strong> - Search for specific data</li>
</ol>

<h3 id="example-document">Example Document</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-11-22T10:30:00Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"source_ip"</span><span class="p">:</span><span class="w"> </span><span class="s2">"192.168.1.100"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"event_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"failed_login"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Authentication failed for user admin"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="setting-up-elasticsearch-docker">Setting Up Elasticsearch (Docker)</h2>

<p>Let‚Äôs set up a simple Elasticsearch instance for testing:</p>

<h3 id="docker-composeyml">docker-compose.yml</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">elasticsearch</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">docker.elastic.co/elasticsearch/elasticsearch:8.11.0</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">elasticsearch</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">discovery.type=single-node</span>
      <span class="pi">-</span> <span class="s">xpack.security.enabled=false</span>  <span class="c1"># Disable for testing</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">ES_JAVA_OPTS=-Xms512m</span><span class="nv"> </span><span class="s">-Xmx512m"</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9200:9200"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">es_data:/usr/share/elasticsearch/data</span>

  <span class="na">kibana</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">docker.elastic.co/kibana/kibana:8.11.0</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">kibana</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ELASTICSEARCH_HOSTS=http://elasticsearch:9200</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5601:5601"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">elasticsearch</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">es_data</span><span class="pi">:</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Run it:</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker-compose up <span class="nt">-d</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Access:</strong></p>
<ul>
  <li>Elasticsearch: http://localhost:9200</li>
  <li>Kibana: http://localhost:5601</li>
</ul>

<h2 id="sending-logs-to-elasticsearch-with-python">Sending Logs to Elasticsearch with Python</h2>

<p>Here‚Äôs how to send security events from your compliance tool:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">elasticsearch</span> <span class="kn">import</span> <span class="n">Elasticsearch</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="n">json</span>

<span class="c1"># Connect to Elasticsearch
</span><span class="n">es</span> <span class="o">=</span> <span class="nc">Elasticsearch</span><span class="p">(</span>
    <span class="p">[</span><span class="sh">'</span><span class="s">http://localhost:9200</span><span class="sh">'</span><span class="p">],</span>
    <span class="c1"># For production, add authentication:
</span>    <span class="c1"># http_auth=('elastic', 'password')
</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">index_security_event</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="n">source_ip</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">severity</span><span class="o">=</span><span class="sh">'</span><span class="s">info</span><span class="sh">'</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Index a security event to Elasticsearch.</span><span class="sh">"""</span>
    <span class="n">document</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">utcnow</span><span class="p">().</span><span class="nf">isoformat</span><span class="p">(),</span>
        <span class="sh">'</span><span class="s">event_type</span><span class="sh">'</span><span class="p">:</span> <span class="n">event_type</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">source_ip</span><span class="sh">'</span><span class="p">:</span> <span class="n">source_ip</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">severity</span><span class="sh">'</span><span class="p">:</span> <span class="n">severity</span>
    <span class="p">}</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Index the document
</span>        <span class="n">response</span> <span class="o">=</span> <span class="n">es</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="sh">'</span><span class="s">security-events</span><span class="sh">'</span><span class="p">,</span>
            <span class="n">document</span><span class="o">=</span><span class="n">document</span>
        <span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚úÖ Event indexed: </span><span class="si">{</span><span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">_id</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">_id</span><span class="sh">'</span><span class="p">]</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚ùå Error indexing event: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">index_compliance_finding</span><span class="p">(</span><span class="n">finding_type</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">details</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Index a compliance finding.</span><span class="sh">"""</span>
    <span class="n">document</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">utcnow</span><span class="p">().</span><span class="nf">isoformat</span><span class="p">(),</span>
        <span class="sh">'</span><span class="s">finding_type</span><span class="sh">'</span><span class="p">:</span> <span class="n">finding_type</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">resource</span><span class="sh">'</span><span class="p">:</span> <span class="n">resource</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>  <span class="c1"># PASS, FAIL, WARN
</span>        <span class="sh">'</span><span class="s">details</span><span class="sh">'</span><span class="p">:</span> <span class="n">details</span>
    <span class="p">}</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">es</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="sh">'</span><span class="s">compliance-findings</span><span class="sh">'</span><span class="p">,</span>
            <span class="n">document</span><span class="o">=</span><span class="n">document</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">_id</span><span class="sh">'</span><span class="p">]</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚ùå Error indexing finding: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="c1"># Example: Index compliance findings from scan
</span><span class="k">def</span> <span class="nf">index_scan_results</span><span class="p">(</span><span class="n">scan_results</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Index all findings from a compliance scan.</span><span class="sh">"""</span>
    <span class="k">for</span> <span class="n">finding</span> <span class="ow">in</span> <span class="n">scan_results</span><span class="p">:</span>
        <span class="nf">index_compliance_finding</span><span class="p">(</span>
            <span class="n">finding_type</span><span class="o">=</span><span class="n">finding</span><span class="p">[</span><span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">],</span>
            <span class="n">resource</span><span class="o">=</span><span class="n">finding</span><span class="p">[</span><span class="sh">'</span><span class="s">resource</span><span class="sh">'</span><span class="p">],</span>
            <span class="n">status</span><span class="o">=</span><span class="n">finding</span><span class="p">[</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">],</span>
            <span class="n">details</span><span class="o">=</span><span class="n">finding</span><span class="p">[</span><span class="sh">'</span><span class="s">details</span><span class="sh">'</span><span class="p">]</span>
        <span class="p">)</span>

<span class="c1"># Example usage
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="c1"># Index a security event
</span>    <span class="nf">index_security_event</span><span class="p">(</span>
        <span class="n">event_type</span><span class="o">=</span><span class="sh">'</span><span class="s">failed_login</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">source_ip</span><span class="o">=</span><span class="sh">'</span><span class="s">192.168.1.100</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">message</span><span class="o">=</span><span class="sh">'</span><span class="s">Multiple failed login attempts</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">severity</span><span class="o">=</span><span class="sh">'</span><span class="s">high</span><span class="sh">'</span>
    <span class="p">)</span>
    
    <span class="c1"># Index a compliance finding
</span>    <span class="nf">index_compliance_finding</span><span class="p">(</span>
        <span class="n">finding_type</span><span class="o">=</span><span class="sh">'</span><span class="s">s3_public_access</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">resource</span><span class="o">=</span><span class="sh">'</span><span class="s">s3://my-bucket</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="sh">'</span><span class="s">FAIL</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">details</span><span class="o">=</span><span class="sh">'</span><span class="s">Bucket has public access enabled</span><span class="sh">'</span>
    <span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="querying-elasticsearch">Querying Elasticsearch</h2>

<h3 id="search-for-events">Search for Events</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">search_security_events</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Search for security events.</span><span class="sh">"""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">es</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="sh">'</span><span class="s">security-events</span><span class="sh">'</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="p">{</span>
                <span class="sh">'</span><span class="s">query</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                    <span class="sh">'</span><span class="s">match</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                        <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="n">query</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="sh">'</span><span class="s">size</span><span class="sh">'</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">sort</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span><span class="sh">'</span><span class="s">order</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">desc</span><span class="sh">'</span><span class="p">}}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">hits</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">hits</span><span class="sh">'</span><span class="p">]</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error searching: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">get_failed_logins_last_hour</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Get all failed login attempts in the last hour.</span><span class="sh">"""</span>
    <span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
    
    <span class="n">one_hour_ago</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="nf">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)).</span><span class="nf">isoformat</span><span class="p">()</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">es</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="sh">'</span><span class="s">security-events</span><span class="sh">'</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="p">{</span>
                <span class="sh">'</span><span class="s">query</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                    <span class="sh">'</span><span class="s">bool</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                        <span class="sh">'</span><span class="s">must</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span><span class="sh">'</span><span class="s">match</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span><span class="sh">'</span><span class="s">event_type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">failed_login</span><span class="sh">'</span><span class="p">}},</span>
                            <span class="p">{</span><span class="sh">'</span><span class="s">range</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span><span class="sh">'</span><span class="s">gte</span><span class="sh">'</span><span class="p">:</span> <span class="n">one_hour_ago</span><span class="p">}}}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="sh">'</span><span class="s">size</span><span class="sh">'</span><span class="p">:</span> <span class="mi">100</span>
            <span class="p">}</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">hits</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">hits</span><span class="sh">'</span><span class="p">]</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error querying: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">get_compliance_failures</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Get all compliance failures.</span><span class="sh">"""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">es</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="sh">'</span><span class="s">compliance-findings</span><span class="sh">'</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="p">{</span>
                <span class="sh">'</span><span class="s">query</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                    <span class="sh">'</span><span class="s">match</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                        <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">FAIL</span><span class="sh">'</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="sh">'</span><span class="s">size</span><span class="sh">'</span><span class="p">:</span> <span class="mi">1000</span>
            <span class="p">}</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">hits</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">hits</span><span class="sh">'</span><span class="p">]</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error querying: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="building-a-simple-siem-dashboard">Building a Simple SIEM Dashboard</h2>

<h3 id="create-index-template">Create Index Template</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">create_security_index_template</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Create an index template for security events.</span><span class="sh">"""</span>
    <span class="n">template</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">index_patterns</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">security-events-*</span><span class="sh">'</span><span class="p">],</span>
        <span class="sh">'</span><span class="s">template</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">settings</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">number_of_shards</span><span class="sh">'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">number_of_replicas</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">},</span>
            <span class="sh">'</span><span class="s">mappings</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">properties</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                    <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span><span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">date</span><span class="sh">'</span><span class="p">},</span>
                    <span class="sh">'</span><span class="s">event_type</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span><span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">keyword</span><span class="sh">'</span><span class="p">},</span>
                    <span class="sh">'</span><span class="s">source_ip</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span><span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ip</span><span class="sh">'</span><span class="p">},</span>
                    <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span><span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">text</span><span class="sh">'</span><span class="p">},</span>
                    <span class="sh">'</span><span class="s">severity</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span><span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">keyword</span><span class="sh">'</span><span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">es</span><span class="p">.</span><span class="n">indices</span><span class="p">.</span><span class="nf">put_index_template</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sh">'</span><span class="s">security-events-template</span><span class="sh">'</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="n">template</span>
        <span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">‚úÖ Index template created</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error creating template: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="aggregate-statistics">Aggregate Statistics</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">get_security_statistics</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Get security statistics from Elasticsearch.</span><span class="sh">"""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Count by event type
</span>        <span class="n">response</span> <span class="o">=</span> <span class="n">es</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="sh">'</span><span class="s">security-events</span><span class="sh">'</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="p">{</span>
                <span class="sh">'</span><span class="s">size</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">aggs</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                    <span class="sh">'</span><span class="s">event_types</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                        <span class="sh">'</span><span class="s">terms</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                            <span class="sh">'</span><span class="s">field</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">event_type</span><span class="sh">'</span><span class="p">,</span>
                            <span class="sh">'</span><span class="s">size</span><span class="sh">'</span><span class="p">:</span> <span class="mi">10</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                    <span class="sh">'</span><span class="s">by_severity</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                        <span class="sh">'</span><span class="s">terms</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                            <span class="sh">'</span><span class="s">field</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">severity</span><span class="sh">'</span><span class="p">,</span>
                            <span class="sh">'</span><span class="s">size</span><span class="sh">'</span><span class="p">:</span> <span class="mi">5</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">event_types</span><span class="sh">'</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">aggregations</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">event_types</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">buckets</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">by_severity</span><span class="sh">'</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">aggregations</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">by_severity</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">buckets</span><span class="sh">'</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error getting statistics: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="integrating-with-compliance-tool">Integrating with Compliance Tool</h2>

<p>Here‚Äôs how to integrate Elasticsearch with your compliance scanner:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">boto3</span>
<span class="kn">from</span> <span class="n">elasticsearch</span> <span class="kn">import</span> <span class="n">Elasticsearch</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">def</span> <span class="nf">scan_and_index_compliance</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Scan AWS resources and index findings to Elasticsearch.</span><span class="sh">"""</span>
    <span class="n">es</span> <span class="o">=</span> <span class="nc">Elasticsearch</span><span class="p">([</span><span class="sh">'</span><span class="s">http://localhost:9200</span><span class="sh">'</span><span class="p">])</span>
    <span class="n">s3_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">s3</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="c1"># Scan S3 buckets
</span>    <span class="n">buckets</span> <span class="o">=</span> <span class="n">s3_client</span><span class="p">.</span><span class="nf">list_buckets</span><span class="p">()</span>
    
    <span class="n">findings</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="n">buckets</span><span class="p">[</span><span class="sh">'</span><span class="s">Buckets</span><span class="sh">'</span><span class="p">]:</span>
        <span class="n">bucket_name</span> <span class="o">=</span> <span class="n">bucket</span><span class="p">[</span><span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="c1"># Check for public access
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="n">public_access</span> <span class="o">=</span> <span class="n">s3_client</span><span class="p">.</span><span class="nf">get_public_access_block</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">)</span>
            <span class="c1"># ... check logic ...
</span>            
            <span class="n">finding</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">utcnow</span><span class="p">().</span><span class="nf">isoformat</span><span class="p">(),</span>
                <span class="sh">'</span><span class="s">resource_type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">s3_bucket</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">resource_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">bucket_name</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">check_type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">public_access</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">PASS</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># or 'FAIL'
</span>                <span class="sh">'</span><span class="s">details</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Public access is blocked</span><span class="sh">'</span>
            <span class="p">}</span>
            
            <span class="c1"># Index to Elasticsearch
</span>            <span class="n">es</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="sh">'</span><span class="s">compliance-findings</span><span class="sh">'</span><span class="p">,</span>
                <span class="n">document</span><span class="o">=</span><span class="n">finding</span>
            <span class="p">)</span>
            
            <span class="n">findings</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">finding</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error checking bucket </span><span class="si">{</span><span class="n">bucket_name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">findings</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="security-best-practices">Security Best Practices</h2>

<h3 id="1-enable-authentication">1. Enable Authentication</h3>

<p>Always enable authentication in production:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="na">environment</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">xpack.security.enabled=true</span>
  <span class="pi">-</span> <span class="s">ELASTIC_PASSWORD=your-secure-password</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-use-https">2. Use HTTPS</h3>

<p>Configure TLS/SSL for encrypted communication.</p>

<h3 id="3-limit-access">3. Limit Access</h3>

<p>Use firewall rules to restrict access to Elasticsearch (port 9200).</p>

<h3 id="4-regular-backups">4. Regular Backups</h3>

<p>Backup your Elasticsearch indices regularly.</p>

<h3 id="5-monitor-performance">5. Monitor Performance</h3>

<p>Monitor Elasticsearch cluster health and performance.</p>

<h2 id="key-takeaways">Key Takeaways</h2>

<ol>
  <li><strong>SIEM = Security Monitoring System</strong> - Collects and analyzes logs</li>
  <li><strong>Elasticsearch = Search Engine</strong> - Stores and searches logs</li>
  <li><strong>Index = Database</strong> - Organizes your data</li>
  <li><strong>Query = Search</strong> - Find specific events</li>
  <li><strong>Dashboards = Visualization</strong> - See your data</li>
  <li><strong>Always authenticate</strong> - Don‚Äôt leave Elasticsearch open</li>
  <li><strong>Use proper indexing</strong> - Organize data efficiently</li>
</ol>

<h2 id="practice-exercise">Practice Exercise</h2>

<p>Try this yourself:</p>

<ol>
  <li>Set up Elasticsearch with Docker</li>
  <li>Create a Python script that sends security events</li>
  <li>Query for specific events</li>
  <li>Create aggregations (count by type, severity, etc.)</li>
  <li>Build a simple dashboard query</li>
</ol>

<h2 id="resources-to-learn-more">Resources to Learn More</h2>

<ul>
  <li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">Elasticsearch Documentation</a></li>
  <li><a href="https://elasticsearch-py.readthedocs.io/">Elasticsearch Python Client</a></li>
  <li><a href="https://www.elastic.co/learn">ELK Stack Tutorial</a></li>
</ul>

<h2 id="whats-next">What‚Äôs Next?</h2>

<p>Now that you understand SIEM basics, you‚Äôre ready to:</p>
<ul>
  <li>Build comprehensive security dashboards</li>
  <li>Create automated alerting rules</li>
  <li>Integrate with other security tools</li>
</ul>

<p>Remember: SIEM is about turning noise (logs) into signal (actionable intelligence)!</p>

<blockquote>
  <p><strong>üí° Pro Tip:</strong> Start small with Elasticsearch. Index a few events, learn to query them, then gradually scale up. Don‚Äôt try to index everything at once - you‚Äôll get overwhelmed!</p>
</blockquote>

<hr />

<p><em>Ready to secure your deployments? Check out our next post on CI/CD Security, where we‚Äôll learn how to build secure deployment pipelines!</em></p>]]></content><author><name></name></author><category term="SIEM" /><category term="Security Monitoring" /><category term="Elasticsearch" /><category term="siem" /><category term="elasticsearch" /><category term="elk-stack" /><category term="security-monitoring" /><category term="log-analysis" /><category term="security" /><summary type="html"><![CDATA[SIEM (Security Information and Event Management) is like having a security guard that never sleeps, watching all your logs and alerting you when something suspicious happens. Elasticsearch is the engine that powers many SIEM solutions. Let's learn how to use it for security monitoring.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://placehold.co/1000x400/005571/FFFFFF?text=Elasticsearch+%26+SIEM" /><media:content medium="image" url="https://placehold.co/1000x400/005571/FFFFFF?text=Elasticsearch+%26+SIEM" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">AWS VPC Networking: Building Secure Cloud Networks</title><link href="http://0.0.0.0:4000/posts/aws-vpc-networking-fundamentals/" rel="alternate" type="text/html" title="AWS VPC Networking: Building Secure Cloud Networks" /><published>2025-11-21T09:00:00-05:00</published><updated>2025-11-15T03:28:20-05:00</updated><id>http://0.0.0.0:4000/posts/aws-vpc-networking-fundamentals</id><content type="html" xml:base="http://0.0.0.0:4000/posts/aws-vpc-networking-fundamentals/"><![CDATA[<blockquote>
  <p><strong>Think of it this way:</strong> When you create an AWS account, you get a default VPC - like a basic apartment building. It works, but it‚Äôs not optimized for security. Building your own VPC is like designing a custom office building with proper security zones, controlled access, and network segmentation. Let‚Äôs learn how to build secure VPC architectures.</p>
</blockquote>

<h2 id="what-is-a-vpc-really">What is a VPC, Really?</h2>

<p>A <strong>VPC (Virtual Private Cloud)</strong> is your own isolated network in AWS. Think of it as:</p>

<p><strong>Real-world analogy:</strong></p>
<ul>
  <li><strong>VPC</strong> = Your company‚Äôs private network</li>
  <li><strong>Subnets</strong> = Different floors/departments (public, private, database)</li>
  <li><strong>Route Tables</strong> = The building‚Äôs directory (where traffic goes)</li>
  <li><strong>Internet Gateway</strong> = The main entrance/exit</li>
  <li><strong>NAT Gateway</strong> = The secure exit (private subnets can go out, but nothing comes in)</li>
</ul>

<h2 id="core-vpc-components">Core VPC Components</h2>

<h3 id="1-vpc-virtual-private-cloud">1. VPC (Virtual Private Cloud)</h3>

<p>The container for everything. Defined by a CIDR block (IP address range):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>VPC: 10.0.0.0/16
This gives you 65,536 IP addresses (10.0.0.0 to 10.0.255.255)
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-subnets">2. Subnets</h3>

<p>Subdivisions of your VPC. Usually organized by function:</p>

<ul>
  <li><strong>Public Subnet</strong> - Has direct internet access (web servers)</li>
  <li><strong>Private Subnet</strong> - No direct internet access (application servers)</li>
  <li><strong>Database Subnet</strong> - Isolated, no internet (databases)</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>Public Subnet:  10.0.1.0/24 (256 IPs)
Private Subnet: 10.0.2.0/24 (256 IPs)
Database Subnet: 10.0.3.0/24 (256 IPs)
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-internet-gateway-igw">3. Internet Gateway (IGW)</h3>

<p>Allows resources in public subnets to access the internet.</p>

<p><strong>Think of it as:</strong> The main door of your building that connects to the outside world.</p>

<h3 id="4-nat-gateway">4. NAT Gateway</h3>

<p>Allows resources in private subnets to access the internet (outbound only).</p>

<p><strong>Think of it as:</strong> A one-way door - private resources can go out, but nothing can come in directly.</p>

<h3 id="5-route-tables">5. Route Tables</h3>

<p>Define where traffic goes. Like a GPS for your network.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>Route Table for Public Subnet:
10.0.0.0/16 ‚Üí local (stays in VPC)
0.0.0.0/0 ‚Üí igw-xxxxx (goes to internet)

Route Table for Private Subnet:
10.0.0.0/16 ‚Üí local (stays in VPC)
0.0.0.0/0 ‚Üí nat-xxxxx (goes through NAT to internet)
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="building-a-secure-vpc-architecture">Building a Secure VPC Architecture</h2>

<p>Let‚Äôs build a production-ready VPC for the compliance tool:</p>

<h3 id="architecture-overview">Architecture Overview</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>Internet
   ‚îÇ
   ‚ñº
Internet Gateway
   ‚îÇ
   ‚îú‚îÄ‚îÄ Public Subnet (10.0.1.0/24)
   ‚îÇ   ‚îî‚îÄ‚îÄ NAT Gateway
   ‚îÇ       ‚îÇ
   ‚îÇ       ‚îú‚îÄ‚îÄ Private Subnet (10.0.2.0/24)
   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ Application Servers
   ‚îÇ       ‚îÇ
   ‚îÇ       ‚îî‚îÄ‚îÄ Database Subnet (10.0.3.0/24)
   ‚îÇ           ‚îî‚îÄ‚îÄ Databases (isolated)
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-1-create-the-vpc">Step 1: Create the VPC</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c"># Create VPC</span>
aws ec2 create-vpc <span class="se">\</span>
  <span class="nt">--cidr-block</span> 10.0.0.0/16 <span class="se">\</span>
  <span class="nt">--tag-specifications</span> <span class="s1">'ResourceType=vpc,Tags=[{Key=Name,Value=ComplianceTool-VPC}]'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-2-create-subnets">Step 2: Create Subnets</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="c"># Get VPC ID (from previous step)</span>
<span class="nv">VPC_ID</span><span class="o">=</span><span class="s2">"vpc-12345678"</span>

<span class="c"># Public Subnet (for NAT Gateway)</span>
aws ec2 create-subnet <span class="se">\</span>
  <span class="nt">--vpc-id</span> <span class="nv">$VPC_ID</span> <span class="se">\</span>
  <span class="nt">--cidr-block</span> 10.0.1.0/24 <span class="se">\</span>
  <span class="nt">--availability-zone</span> us-east-1a <span class="se">\</span>
  <span class="nt">--tag-specifications</span> <span class="s1">'ResourceType=subnet,Tags=[{Key=Name,Value=Public-Subnet-1a}]'</span>

<span class="c"># Private Subnet (for application servers)</span>
aws ec2 create-subnet <span class="se">\</span>
  <span class="nt">--vpc-id</span> <span class="nv">$VPC_ID</span> <span class="se">\</span>
  <span class="nt">--cidr-block</span> 10.0.2.0/24 <span class="se">\</span>
  <span class="nt">--availability-zone</span> us-east-1a <span class="se">\</span>
  <span class="nt">--tag-specifications</span> <span class="s1">'ResourceType=subnet,Tags=[{Key=Name,Value=Private-Subnet-1a}]'</span>

<span class="c"># Database Subnet (isolated)</span>
aws ec2 create-subnet <span class="se">\</span>
  <span class="nt">--vpc-id</span> <span class="nv">$VPC_ID</span> <span class="se">\</span>
  <span class="nt">--cidr-block</span> 10.0.3.0/24 <span class="se">\</span>
  <span class="nt">--availability-zone</span> us-east-1b <span class="se">\</span>
  <span class="nt">--tag-specifications</span> <span class="s1">'ResourceType=subnet,Tags=[{Key=Name,Value=Database-Subnet-1b}]'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-3-create-internet-gateway">Step 3: Create Internet Gateway</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c"># Create Internet Gateway</span>
<span class="nv">IGW_ID</span><span class="o">=</span><span class="si">$(</span>aws ec2 create-internet-gateway <span class="se">\</span>
  <span class="nt">--tag-specifications</span> <span class="s1">'ResourceType=internet-gateway,Tags=[{Key=Name,Value=ComplianceTool-IGW}]'</span> <span class="se">\</span>
  <span class="nt">--query</span> <span class="s1">'InternetGateway.InternetGatewayId'</span> <span class="nt">--output</span> text<span class="si">)</span>

<span class="c"># Attach to VPC</span>
aws ec2 attach-internet-gateway <span class="se">\</span>
  <span class="nt">--internet-gateway-id</span> <span class="nv">$IGW_ID</span> <span class="se">\</span>
  <span class="nt">--vpc-id</span> <span class="nv">$VPC_ID</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-4-create-nat-gateway">Step 4: Create NAT Gateway</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="c"># Allocate Elastic IP for NAT Gateway</span>
<span class="nv">ALLOCATION_ID</span><span class="o">=</span><span class="si">$(</span>aws ec2 allocate-address <span class="se">\</span>
  <span class="nt">--domain</span> vpc <span class="se">\</span>
  <span class="nt">--query</span> <span class="s1">'AllocationId'</span> <span class="nt">--output</span> text<span class="si">)</span>

<span class="c"># Get Public Subnet ID</span>
<span class="nv">PUBLIC_SUBNET_ID</span><span class="o">=</span><span class="si">$(</span>aws ec2 describe-subnets <span class="se">\</span>
  <span class="nt">--filters</span> <span class="s2">"Name=tag:Name,Values=Public-Subnet-1a"</span> <span class="se">\</span>
  <span class="nt">--query</span> <span class="s1">'Subnets[0].SubnetId'</span> <span class="nt">--output</span> text<span class="si">)</span>

<span class="c"># Create NAT Gateway</span>
<span class="nv">NAT_GW_ID</span><span class="o">=</span><span class="si">$(</span>aws ec2 create-nat-gateway <span class="se">\</span>
  <span class="nt">--subnet-id</span> <span class="nv">$PUBLIC_SUBNET_ID</span> <span class="se">\</span>
  <span class="nt">--allocation-id</span> <span class="nv">$ALLOCATION_ID</span> <span class="se">\</span>
  <span class="nt">--tag-specifications</span> <span class="s1">'ResourceType=nat-gateway,Tags=[{Key=Name,Value=ComplianceTool-NAT}]'</span> <span class="se">\</span>
  <span class="nt">--query</span> <span class="s1">'NatGateway.NatGatewayId'</span> <span class="nt">--output</span> text<span class="si">)</span>

<span class="c"># Wait for NAT Gateway to be available</span>
aws ec2 <span class="nb">wait </span>nat-gateway-available <span class="nt">--nat-gateway-ids</span> <span class="nv">$NAT_GW_ID</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-5-configure-route-tables">Step 5: Configure Route Tables</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="rouge-code"><pre><span class="c"># Public Route Table</span>
<span class="nv">PUBLIC_RT_ID</span><span class="o">=</span><span class="si">$(</span>aws ec2 create-route-table <span class="se">\</span>
  <span class="nt">--vpc-id</span> <span class="nv">$VPC_ID</span> <span class="se">\</span>
  <span class="nt">--tag-specifications</span> <span class="s1">'ResourceType=route-table,Tags=[{Key=Name,Value=Public-RouteTable}]'</span> <span class="se">\</span>
  <span class="nt">--query</span> <span class="s1">'RouteTable.RouteTableId'</span> <span class="nt">--output</span> text<span class="si">)</span>

<span class="c"># Add route to internet</span>
aws ec2 create-route <span class="se">\</span>
  <span class="nt">--route-table-id</span> <span class="nv">$PUBLIC_RT_ID</span> <span class="se">\</span>
  <span class="nt">--destination-cidr-block</span> 0.0.0.0/0 <span class="se">\</span>
  <span class="nt">--gateway-id</span> <span class="nv">$IGW_ID</span>

<span class="c"># Associate public subnet</span>
aws ec2 associate-route-table <span class="se">\</span>
  <span class="nt">--subnet-id</span> <span class="nv">$PUBLIC_SUBNET_ID</span> <span class="se">\</span>
  <span class="nt">--route-table-id</span> <span class="nv">$PUBLIC_RT_ID</span>

<span class="c"># Private Route Table</span>
<span class="nv">PRIVATE_RT_ID</span><span class="o">=</span><span class="si">$(</span>aws ec2 create-route-table <span class="se">\</span>
  <span class="nt">--vpc-id</span> <span class="nv">$VPC_ID</span> <span class="se">\</span>
  <span class="nt">--tag-specifications</span> <span class="s1">'ResourceType=route-table,Tags=[{Key=Name,Value=Private-RouteTable}]'</span> <span class="se">\</span>
  <span class="nt">--query</span> <span class="s1">'RouteTable.RouteTableId'</span> <span class="nt">--output</span> text<span class="si">)</span>

<span class="c"># Add route through NAT Gateway</span>
aws ec2 create-route <span class="se">\</span>
  <span class="nt">--route-table-id</span> <span class="nv">$PRIVATE_RT_ID</span> <span class="se">\</span>
  <span class="nt">--destination-cidr-block</span> 0.0.0.0/0 <span class="se">\</span>
  <span class="nt">--nat-gateway-id</span> <span class="nv">$NAT_GW_ID</span>

<span class="c"># Get Private Subnet ID</span>
<span class="nv">PRIVATE_SUBNET_ID</span><span class="o">=</span><span class="si">$(</span>aws ec2 describe-subnets <span class="se">\</span>
  <span class="nt">--filters</span> <span class="s2">"Name=tag:Name,Values=Private-Subnet-1a"</span> <span class="se">\</span>
  <span class="nt">--query</span> <span class="s1">'Subnets[0].SubnetId'</span> <span class="nt">--output</span> text<span class="si">)</span>

<span class="c"># Associate private subnet</span>
aws ec2 associate-route-table <span class="se">\</span>
  <span class="nt">--subnet-id</span> <span class="nv">$PRIVATE_SUBNET_ID</span> <span class="se">\</span>
  <span class="nt">--route-table-id</span> <span class="nv">$PRIVATE_RT_ID</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="vpc-flow-logs-monitoring-network-traffic">VPC Flow Logs: Monitoring Network Traffic</h2>

<p>VPC Flow Logs record network traffic. Essential for security monitoring:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="c"># Create CloudWatch Log Group</span>
aws logs create-log-group <span class="nt">--log-group-name</span> /aws/vpc/flowlogs

<span class="c"># Create IAM role for Flow Logs</span>
<span class="c"># (Create role with VPC Flow Logs permissions)</span>

<span class="c"># Enable Flow Logs</span>
aws ec2 create-flow-logs <span class="se">\</span>
  <span class="nt">--resource-type</span> VPC <span class="se">\</span>
  <span class="nt">--resource-ids</span> <span class="nv">$VPC_ID</span> <span class="se">\</span>
  <span class="nt">--traffic-type</span> ALL <span class="se">\</span>
  <span class="nt">--log-destination-type</span> cloud-watch-logs <span class="se">\</span>
  <span class="nt">--log-group-name</span> /aws/vpc/flowlogs
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>What this captures:</strong></p>
<ul>
  <li>Source and destination IPs</li>
  <li>Ports</li>
  <li>Protocols</li>
  <li>Accepted/rejected traffic</li>
  <li>Timestamps</li>
</ul>

<p><strong>Real-world use:</strong> Detect suspicious traffic, investigate security incidents, compliance auditing.</p>

<h2 id="vpc-endpoints-private-aws-service-access">VPC Endpoints: Private AWS Service Access</h2>

<p>VPC Endpoints allow private access to AWS services (S3, DynamoDB, etc.) without going through the internet:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># Create S3 VPC Endpoint</span>
aws ec2 create-vpc-endpoint <span class="se">\</span>
  <span class="nt">--vpc-id</span> <span class="nv">$VPC_ID</span> <span class="se">\</span>
  <span class="nt">--service-name</span> com.amazonaws.us-east-1.s3 <span class="se">\</span>
  <span class="nt">--route-table-ids</span> <span class="nv">$PRIVATE_RT_ID</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Benefits:</strong></p>
<ul>
  <li>No internet gateway needed</li>
  <li>No data transfer charges</li>
  <li>More secure (traffic stays in AWS network)</li>
  <li>Lower latency</li>
</ul>

<h2 id="python-script-automated-vpc-creation">Python Script: Automated VPC Creation</h2>

<p>Here‚Äôs a complete script to create a secure VPC:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">boto3</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="n">botocore.exceptions</span> <span class="kn">import</span> <span class="n">ClientError</span>

<span class="k">def</span> <span class="nf">create_secure_vpc</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="sh">'</span><span class="s">us-east-1</span><span class="sh">'</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Create a secure VPC with public, private, and database subnets.</span><span class="sh">"""</span>
    <span class="n">ec2_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">ec2</span><span class="sh">'</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>
    
    <span class="c1"># Step 1: Create VPC
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Creating VPC...</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">vpc_response</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">create_vpc</span><span class="p">(</span>
        <span class="n">CidrBlock</span><span class="o">=</span><span class="sh">'</span><span class="s">10.0.0.0/16</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">TagSpecifications</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span>
                <span class="sh">'</span><span class="s">ResourceType</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">vpc</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">Tags</span><span class="sh">'</span><span class="p">:</span> <span class="p">[{</span><span class="sh">'</span><span class="s">Key</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Value</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ComplianceTool-VPC</span><span class="sh">'</span><span class="p">}]</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">vpc_id</span> <span class="o">=</span> <span class="n">vpc_response</span><span class="p">[</span><span class="sh">'</span><span class="s">Vpc</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">VpcId</span><span class="sh">'</span><span class="p">]</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚úÖ VPC created: </span><span class="si">{</span><span class="n">vpc_id</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># Enable DNS hostnames
</span>    <span class="n">ec2_client</span><span class="p">.</span><span class="nf">modify_vpc_attribute</span><span class="p">(</span>
        <span class="n">VpcId</span><span class="o">=</span><span class="n">vpc_id</span><span class="p">,</span>
        <span class="n">EnableDnsHostnames</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">Value</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
    <span class="p">)</span>
    
    <span class="c1"># Step 2: Create Internet Gateway
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Creating Internet Gateway...</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">igw_response</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">create_internet_gateway</span><span class="p">(</span>
        <span class="n">TagSpecifications</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span>
                <span class="sh">'</span><span class="s">ResourceType</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">internet-gateway</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">Tags</span><span class="sh">'</span><span class="p">:</span> <span class="p">[{</span><span class="sh">'</span><span class="s">Key</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Value</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ComplianceTool-IGW</span><span class="sh">'</span><span class="p">}]</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">igw_id</span> <span class="o">=</span> <span class="n">igw_response</span><span class="p">[</span><span class="sh">'</span><span class="s">InternetGateway</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">InternetGatewayId</span><span class="sh">'</span><span class="p">]</span>
    <span class="n">ec2_client</span><span class="p">.</span><span class="nf">attach_internet_gateway</span><span class="p">(</span><span class="n">InternetGatewayId</span><span class="o">=</span><span class="n">igw_id</span><span class="p">,</span> <span class="n">VpcId</span><span class="o">=</span><span class="n">vpc_id</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚úÖ Internet Gateway created and attached: </span><span class="si">{</span><span class="n">igw_id</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># Step 3: Get Availability Zones
</span>    <span class="n">azs</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">describe_availability_zones</span><span class="p">()</span>
    <span class="n">az1</span> <span class="o">=</span> <span class="n">azs</span><span class="p">[</span><span class="sh">'</span><span class="s">AvailabilityZones</span><span class="sh">'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="sh">'</span><span class="s">ZoneName</span><span class="sh">'</span><span class="p">]</span>
    <span class="n">az2</span> <span class="o">=</span> <span class="n">azs</span><span class="p">[</span><span class="sh">'</span><span class="s">AvailabilityZones</span><span class="sh">'</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="sh">'</span><span class="s">ZoneName</span><span class="sh">'</span><span class="p">]</span>
    
    <span class="c1"># Step 4: Create Subnets
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Creating subnets...</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">subnets</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="c1"># Public Subnet
</span>    <span class="n">public_subnet</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">create_subnet</span><span class="p">(</span>
        <span class="n">VpcId</span><span class="o">=</span><span class="n">vpc_id</span><span class="p">,</span>
        <span class="n">CidrBlock</span><span class="o">=</span><span class="sh">'</span><span class="s">10.0.1.0/24</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">AvailabilityZone</span><span class="o">=</span><span class="n">az1</span><span class="p">,</span>
        <span class="n">TagSpecifications</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span>
                <span class="sh">'</span><span class="s">ResourceType</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">subnet</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">Tags</span><span class="sh">'</span><span class="p">:</span> <span class="p">[{</span><span class="sh">'</span><span class="s">Key</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Value</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Public-Subnet-1a</span><span class="sh">'</span><span class="p">}]</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">subnets</span><span class="p">[</span><span class="sh">'</span><span class="s">public</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">public_subnet</span><span class="p">[</span><span class="sh">'</span><span class="s">Subnet</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">SubnetId</span><span class="sh">'</span><span class="p">]</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚úÖ Public subnet created: </span><span class="si">{</span><span class="n">subnets</span><span class="p">[</span><span class="sh">'</span><span class="s">public</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># Private Subnet
</span>    <span class="n">private_subnet</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">create_subnet</span><span class="p">(</span>
        <span class="n">VpcId</span><span class="o">=</span><span class="n">vpc_id</span><span class="p">,</span>
        <span class="n">CidrBlock</span><span class="o">=</span><span class="sh">'</span><span class="s">10.0.2.0/24</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">AvailabilityZone</span><span class="o">=</span><span class="n">az1</span><span class="p">,</span>
        <span class="n">TagSpecifications</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span>
                <span class="sh">'</span><span class="s">ResourceType</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">subnet</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">Tags</span><span class="sh">'</span><span class="p">:</span> <span class="p">[{</span><span class="sh">'</span><span class="s">Key</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Value</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Private-Subnet-1a</span><span class="sh">'</span><span class="p">}]</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">subnets</span><span class="p">[</span><span class="sh">'</span><span class="s">private</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">private_subnet</span><span class="p">[</span><span class="sh">'</span><span class="s">Subnet</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">SubnetId</span><span class="sh">'</span><span class="p">]</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚úÖ Private subnet created: </span><span class="si">{</span><span class="n">subnets</span><span class="p">[</span><span class="sh">'</span><span class="s">private</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># Database Subnet
</span>    <span class="n">db_subnet</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">create_subnet</span><span class="p">(</span>
        <span class="n">VpcId</span><span class="o">=</span><span class="n">vpc_id</span><span class="p">,</span>
        <span class="n">CidrBlock</span><span class="o">=</span><span class="sh">'</span><span class="s">10.0.3.0/24</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">AvailabilityZone</span><span class="o">=</span><span class="n">az2</span><span class="p">,</span>
        <span class="n">TagSpecifications</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span>
                <span class="sh">'</span><span class="s">ResourceType</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">subnet</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">Tags</span><span class="sh">'</span><span class="p">:</span> <span class="p">[{</span><span class="sh">'</span><span class="s">Key</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Value</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Database-Subnet-1b</span><span class="sh">'</span><span class="p">}]</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">subnets</span><span class="p">[</span><span class="sh">'</span><span class="s">database</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">db_subnet</span><span class="p">[</span><span class="sh">'</span><span class="s">Subnet</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">SubnetId</span><span class="sh">'</span><span class="p">]</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚úÖ Database subnet created: </span><span class="si">{</span><span class="n">subnets</span><span class="p">[</span><span class="sh">'</span><span class="s">database</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># Step 5: Create NAT Gateway
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Creating NAT Gateway...</span><span class="sh">"</span><span class="p">)</span>
    <span class="c1"># Allocate Elastic IP
</span>    <span class="n">eip</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">allocate_address</span><span class="p">(</span><span class="n">Domain</span><span class="o">=</span><span class="sh">'</span><span class="s">vpc</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">allocation_id</span> <span class="o">=</span> <span class="n">eip</span><span class="p">[</span><span class="sh">'</span><span class="s">AllocationId</span><span class="sh">'</span><span class="p">]</span>
    
    <span class="c1"># Create NAT Gateway
</span>    <span class="n">nat_gw</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">create_nat_gateway</span><span class="p">(</span>
        <span class="n">SubnetId</span><span class="o">=</span><span class="n">subnets</span><span class="p">[</span><span class="sh">'</span><span class="s">public</span><span class="sh">'</span><span class="p">],</span>
        <span class="n">AllocationId</span><span class="o">=</span><span class="n">allocation_id</span><span class="p">,</span>
        <span class="n">TagSpecifications</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span>
                <span class="sh">'</span><span class="s">ResourceType</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">nat-gateway</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">Tags</span><span class="sh">'</span><span class="p">:</span> <span class="p">[{</span><span class="sh">'</span><span class="s">Key</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Value</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ComplianceTool-NAT</span><span class="sh">'</span><span class="p">}]</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">nat_gw_id</span> <span class="o">=</span> <span class="n">nat_gw</span><span class="p">[</span><span class="sh">'</span><span class="s">NatGateway</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">NatGatewayId</span><span class="sh">'</span><span class="p">]</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚úÖ NAT Gateway created: </span><span class="si">{</span><span class="n">nat_gw_id</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># Wait for NAT Gateway to be available
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Waiting for NAT Gateway to be available...</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">waiter</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">get_waiter</span><span class="p">(</span><span class="sh">'</span><span class="s">nat_gateway_available</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">waiter</span><span class="p">.</span><span class="nf">wait</span><span class="p">(</span><span class="n">NatGatewayIds</span><span class="o">=</span><span class="p">[</span><span class="n">nat_gw_id</span><span class="p">])</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">‚úÖ NAT Gateway is available</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># Step 6: Create Route Tables
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Creating route tables...</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># Public Route Table
</span>    <span class="n">public_rt</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">create_route_table</span><span class="p">(</span>
        <span class="n">VpcId</span><span class="o">=</span><span class="n">vpc_id</span><span class="p">,</span>
        <span class="n">TagSpecifications</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span>
                <span class="sh">'</span><span class="s">ResourceType</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">route-table</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">Tags</span><span class="sh">'</span><span class="p">:</span> <span class="p">[{</span><span class="sh">'</span><span class="s">Key</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Value</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Public-RouteTable</span><span class="sh">'</span><span class="p">}]</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">public_rt_id</span> <span class="o">=</span> <span class="n">public_rt</span><span class="p">[</span><span class="sh">'</span><span class="s">RouteTable</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">RouteTableId</span><span class="sh">'</span><span class="p">]</span>
    
    <span class="c1"># Add route to internet
</span>    <span class="n">ec2_client</span><span class="p">.</span><span class="nf">create_route</span><span class="p">(</span>
        <span class="n">RouteTableId</span><span class="o">=</span><span class="n">public_rt_id</span><span class="p">,</span>
        <span class="n">DestinationCidrBlock</span><span class="o">=</span><span class="sh">'</span><span class="s">0.0.0.0/0</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">GatewayId</span><span class="o">=</span><span class="n">igw_id</span>
    <span class="p">)</span>
    
    <span class="c1"># Associate public subnet
</span>    <span class="n">ec2_client</span><span class="p">.</span><span class="nf">associate_route_table</span><span class="p">(</span>
        <span class="n">SubnetId</span><span class="o">=</span><span class="n">subnets</span><span class="p">[</span><span class="sh">'</span><span class="s">public</span><span class="sh">'</span><span class="p">],</span>
        <span class="n">RouteTableId</span><span class="o">=</span><span class="n">public_rt_id</span>
    <span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚úÖ Public route table configured</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># Private Route Table
</span>    <span class="n">private_rt</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">create_route_table</span><span class="p">(</span>
        <span class="n">VpcId</span><span class="o">=</span><span class="n">vpc_id</span><span class="p">,</span>
        <span class="n">TagSpecifications</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span>
                <span class="sh">'</span><span class="s">ResourceType</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">route-table</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">Tags</span><span class="sh">'</span><span class="p">:</span> <span class="p">[{</span><span class="sh">'</span><span class="s">Key</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Value</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Private-RouteTable</span><span class="sh">'</span><span class="p">}]</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">private_rt_id</span> <span class="o">=</span> <span class="n">private_rt</span><span class="p">[</span><span class="sh">'</span><span class="s">RouteTable</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">RouteTableId</span><span class="sh">'</span><span class="p">]</span>
    
    <span class="c1"># Add route through NAT
</span>    <span class="n">ec2_client</span><span class="p">.</span><span class="nf">create_route</span><span class="p">(</span>
        <span class="n">RouteTableId</span><span class="o">=</span><span class="n">private_rt_id</span><span class="p">,</span>
        <span class="n">DestinationCidrBlock</span><span class="o">=</span><span class="sh">'</span><span class="s">0.0.0.0/0</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">NatGatewayId</span><span class="o">=</span><span class="n">nat_gw_id</span>
    <span class="p">)</span>
    
    <span class="c1"># Associate private subnet
</span>    <span class="n">ec2_client</span><span class="p">.</span><span class="nf">associate_route_table</span><span class="p">(</span>
        <span class="n">SubnetId</span><span class="o">=</span><span class="n">subnets</span><span class="p">[</span><span class="sh">'</span><span class="s">private</span><span class="sh">'</span><span class="p">],</span>
        <span class="n">RouteTableId</span><span class="o">=</span><span class="n">private_rt_id</span>
    <span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚úÖ Private route table configured</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">vpc_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">vpc_id</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">igw_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">igw_id</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">nat_gw_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">nat_gw_id</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">subnets</span><span class="sh">'</span><span class="p">:</span> <span class="n">subnets</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">route_tables</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">public</span><span class="sh">'</span><span class="p">:</span> <span class="n">public_rt_id</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">private</span><span class="sh">'</span><span class="p">:</span> <span class="n">private_rt_id</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nf">create_secure_vpc</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span> <span class="o">+</span> <span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">VPC Creation Complete!</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">VPC ID: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="sh">'</span><span class="s">vpc_id</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Public Subnet: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="sh">'</span><span class="s">subnets</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">public</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Private Subnet: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="sh">'</span><span class="s">subnets</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">private</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Database Subnet: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="sh">'</span><span class="s">subnets</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">database</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="security-best-practices">Security Best Practices</h2>

<h3 id="1-network-segmentation">1. Network Segmentation</h3>

<p>Separate your resources by function:</p>
<ul>
  <li>Public subnets for load balancers</li>
  <li>Private subnets for application servers</li>
  <li>Isolated subnets for databases</li>
</ul>

<h3 id="2-enable-flow-logs">2. Enable Flow Logs</h3>

<p>Always enable VPC Flow Logs for:</p>
<ul>
  <li>Security monitoring</li>
  <li>Compliance auditing</li>
  <li>Troubleshooting</li>
</ul>

<h3 id="3-use-vpc-endpoints">3. Use VPC Endpoints</h3>

<p>For AWS service access, use VPC endpoints instead of internet:</p>
<ul>
  <li>More secure</li>
  <li>Lower cost</li>
  <li>Better performance</li>
</ul>

<h3 id="4-restrict-subnet-access">4. Restrict Subnet Access</h3>

<p>Use Network ACLs (in addition to Security Groups) for defense in depth.</p>

<h3 id="5-multi-az-deployment">5. Multi-AZ Deployment</h3>

<p>Deploy resources across multiple Availability Zones for high availability.</p>

<h2 id="key-takeaways">Key Takeaways</h2>

<ol>
  <li><strong>VPC = Your Private Network</strong> - Isolated network in AWS</li>
  <li><strong>Subnets = Network Segments</strong> - Organize by function</li>
  <li><strong>Internet Gateway = Public Access</strong> - For public subnets</li>
  <li><strong>NAT Gateway = Private Internet Access</strong> - One-way outbound</li>
  <li><strong>Route Tables = Traffic Direction</strong> - Where packets go</li>
  <li><strong>Flow Logs = Monitoring</strong> - Essential for security</li>
  <li><strong>VPC Endpoints = Private AWS Access</strong> - More secure, cheaper</li>
</ol>

<h2 id="practice-exercise">Practice Exercise</h2>

<p>Try this yourself:</p>

<ol>
  <li>Create a VPC with CIDR 10.0.0.0/16</li>
  <li>Create public and private subnets</li>
  <li>Create Internet Gateway and NAT Gateway</li>
  <li>Configure route tables</li>
  <li>Enable VPC Flow Logs</li>
  <li>Launch an instance in the private subnet and test connectivity</li>
</ol>

<h2 id="resources-to-learn-more">Resources to Learn More</h2>

<ul>
  <li><a href="https://docs.aws.amazon.com/vpc/">AWS VPC Documentation</a></li>
  <li><a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-security-best-practices.html">VPC Best Practices</a></li>
  <li><a href="https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs.html">VPC Flow Logs</a></li>
</ul>

<h2 id="whats-next">What‚Äôs Next?</h2>

<p>Now that you understand VPC networking, you‚Äôre ready to:</p>
<ul>
  <li>Build multi-tier architectures</li>
  <li>Configure secure application deployments</li>
  <li>Understand advanced networking concepts</li>
</ul>

<p>Remember: Good network design is the foundation of secure cloud infrastructure!</p>

<blockquote>
  <p><strong>üí° Pro Tip:</strong> Start with AWS‚Äôs VPC Wizard for your first VPC. It creates a basic setup you can then customize. Once you understand the components, build your own from scratch!</p>
</blockquote>

<hr />

<p><em>Ready to learn about security monitoring? Check out our next post on Elasticsearch and SIEM, where we‚Äôll learn how to collect and analyze security events!</em></p>]]></content><author><name></name></author><category term="AWS" /><category term="Cloud Security" /><category term="Networking" /><category term="aws" /><category term="vpc" /><category term="networking" /><category term="cloud-security" /><category term="subnets" /><category term="routing" /><summary type="html"><![CDATA[VPC (Virtual Private Cloud) is like building your own private network in AWS. Just like how you'd design a secure office building with different floors and access controls, VPC lets you design secure network architectures. Let's learn how to build them properly.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://placehold.co/1000x400/FF9900/FFFFFF?text=AWS+VPC+Networking" /><media:content medium="image" url="https://placehold.co/1000x400/FF9900/FFFFFF?text=AWS+VPC+Networking" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">EC2 Security Groups: Your Virtual Firewall in the Cloud</title><link href="http://0.0.0.0:4000/posts/aws-ec2-security-groups/" rel="alternate" type="text/html" title="EC2 Security Groups: Your Virtual Firewall in the Cloud" /><published>2025-11-20T09:00:00-05:00</published><updated>2025-11-15T03:28:20-05:00</updated><id>http://0.0.0.0:4000/posts/aws-ec2-security-groups</id><content type="html" xml:base="http://0.0.0.0:4000/posts/aws-ec2-security-groups/"><![CDATA[<blockquote>
  <p><strong>Imagine this:</strong> You‚Äôve launched an EC2 instance (a virtual server) in AWS. By default, it‚Äôs completely isolated - nothing can reach it, and it can‚Äôt reach anything. That‚Äôs actually good for security, but you probably need it to do something. Security Groups are your virtual firewall that controls exactly what traffic is allowed. Let me show you how to configure them properly.</p>
</blockquote>

<h2 id="what-are-security-groups-really">What are Security Groups, Really?</h2>

<p>Think of Security Groups like this:</p>

<p><strong>Real-world analogy:</strong> Your EC2 instance is a house. Security Groups are the security system that controls:</p>
<ul>
  <li>Who can knock on the door (inbound traffic)</li>
  <li>What doors/windows are open (ports)</li>
  <li>Where traffic can come from (source IPs)</li>
  <li>Where traffic can go (outbound traffic)</li>
</ul>

<p><strong>Key characteristics:</strong></p>
<ul>
  <li><strong>Stateful</strong> - If you allow traffic in, the response is automatically allowed out</li>
  <li><strong>Default deny</strong> - Everything is blocked unless explicitly allowed</li>
  <li><strong>Virtual firewall</strong> - Applied at the instance level, not the network level</li>
</ul>

<h2 id="security-groups-vs-network-acls">Security Groups vs Network ACLs</h2>

<p>You might hear about Network ACLs (Access Control Lists). Here‚Äôs the difference:</p>

<table>
  <thead>
    <tr>
      <th>Feature</th>
      <th>Security Groups</th>
      <th>Network ACLs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Level</td>
      <td>Instance level</td>
      <td>Subnet level</td>
    </tr>
    <tr>
      <td>Stateful</td>
      <td>Yes (automatic return traffic)</td>
      <td>No (stateless)</td>
    </tr>
    <tr>
      <td>Rules</td>
      <td>Allow only</td>
      <td>Allow and Deny</td>
    </tr>
    <tr>
      <td>Evaluation</td>
      <td>All rules evaluated</td>
      <td>Rules evaluated in order</td>
    </tr>
  </tbody>
</table>

<p><strong>For most use cases, Security Groups are what you need.</strong> Network ACLs are for additional subnet-level security.</p>

<h2 id="understanding-security-group-rules">Understanding Security Group Rules</h2>

<p>Security Group rules have 4 components:</p>

<ol>
  <li><strong>Type</strong> - The protocol (TCP, UDP, ICMP, etc.)</li>
  <li><strong>Protocol</strong> - Usually TCP for web traffic</li>
  <li><strong>Port Range</strong> - Which ports (e.g., 80 for HTTP, 443 for HTTPS)</li>
  <li><strong>Source/Destination</strong> - Where traffic can come from/go to</li>
</ol>

<h3 id="inbound-rules-ingress">Inbound Rules (Ingress)</h3>

<p>Control what traffic can reach your instance:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>Type: SSH
Protocol: TCP
Port: 22
Source: 10.0.0.0/16 (your VPC)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This says: ‚ÄúAllow SSH (port 22) traffic from IPs in the 10.0.0.0/16 range.‚Äù</p>

<h3 id="outbound-rules-egress">Outbound Rules (Egress)</h3>

<p>Control what traffic can leave your instance:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>Type: HTTPS
Protocol: TCP
Port: 443
Destination: 0.0.0.0/0 (anywhere)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This says: ‚ÄúAllow HTTPS (port 443) traffic to anywhere.‚Äù</p>

<p><strong>Important:</strong> By default, outbound traffic is allowed to anywhere. You should restrict this for better security!</p>

<h2 id="common-security-group-patterns">Common Security Group Patterns</h2>

<h3 id="pattern-1-web-server">Pattern 1: Web Server</h3>

<p>A web server needs:</p>
<ul>
  <li>HTTP (port 80) from the internet</li>
  <li>HTTPS (port 443) from the internet</li>
  <li>SSH (port 22) from your office IP only</li>
</ul>

<p><strong>Inbound Rules:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>HTTP (80)    | TCP | 80  | 0.0.0.0/0
HTTPS (443)  | TCP | 443 | 0.0.0.0/0
SSH (22)     | TCP | 22  | YOUR_OFFICE_IP/32
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Outbound Rules:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>HTTPS (443)  | TCP | 443 | 0.0.0.0/0  (for API calls)
HTTP (80)    | TCP | 80  | 0.0.0.0/0  (for package updates)
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="pattern-2-database-server">Pattern 2: Database Server</h3>

<p>A database should NEVER be accessible from the internet:</p>

<p><strong>Inbound Rules:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>MySQL (3306) | TCP | 3306 | 10.0.1.0/24  (only from app servers)
SSH (22)     | TCP | 22   | 10.0.0.0/16  (only from VPC)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Outbound Rules:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>HTTPS (443)  | TCP | 443 | 0.0.0.0/0  (for updates)
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="pattern-3-compliance-scanner">Pattern 3: Compliance Scanner</h3>

<p>Your compliance scanner needs:</p>
<ul>
  <li>Outbound access to AWS APIs</li>
  <li>SSH from your management network</li>
  <li>No inbound access from internet</li>
</ul>

<p><strong>Inbound Rules:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>SSH (22)     | TCP | 22  | 10.0.0.0/16  (management network)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Outbound Rules:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>HTTPS (443)  | TCP | 443 | 0.0.0.0/0  (AWS APIs)
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="creating-security-groups-with-aws-cli">Creating Security Groups with AWS CLI</h2>

<h3 id="create-a-security-group">Create a Security Group</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># Create security group</span>
aws ec2 create-security-group <span class="se">\</span>
  <span class="nt">--group-name</span> compliance-scanner-sg <span class="se">\</span>
  <span class="nt">--description</span> <span class="s2">"Security group for compliance scanner"</span> <span class="se">\</span>
  <span class="nt">--vpc-id</span> vpc-12345678
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Output:</strong></p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"GroupId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sg-1234567890abcdef0"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="add-inbound-rules">Add Inbound Rules</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c"># Allow SSH from VPC</span>
aws ec2 authorize-security-group-ingress <span class="se">\</span>
  <span class="nt">--group-id</span> sg-1234567890abcdef0 <span class="se">\</span>
  <span class="nt">--protocol</span> tcp <span class="se">\</span>
  <span class="nt">--port</span> 22 <span class="se">\</span>
  <span class="nt">--cidr</span> 10.0.0.0/16
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="add-outbound-rules">Add Outbound Rules</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c"># Allow HTTPS outbound</span>
aws ec2 authorize-security-group-egress <span class="se">\</span>
  <span class="nt">--group-id</span> sg-1234567890abcdef0 <span class="se">\</span>
  <span class="nt">--protocol</span> tcp <span class="se">\</span>
  <span class="nt">--port</span> 443 <span class="se">\</span>
  <span class="nt">--cidr</span> 0.0.0.0/0
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="creating-security-groups-with-python-boto3">Creating Security Groups with Python (Boto3)</h2>

<p>Here‚Äôs how to create and configure security groups programmatically:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">boto3</span>
<span class="kn">from</span> <span class="n">botocore.exceptions</span> <span class="kn">import</span> <span class="n">ClientError</span>

<span class="k">def</span> <span class="nf">create_security_group</span><span class="p">(</span><span class="n">vpc_id</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Create a security group.</span><span class="sh">"""</span>
    <span class="n">ec2_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">ec2</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">create_security_group</span><span class="p">(</span>
            <span class="n">GroupName</span><span class="o">=</span><span class="n">group_name</span><span class="p">,</span>
            <span class="n">Description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">VpcId</span><span class="o">=</span><span class="n">vpc_id</span>
        <span class="p">)</span>
        <span class="n">group_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">GroupId</span><span class="sh">'</span><span class="p">]</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Created security group: </span><span class="si">{</span><span class="n">group_id</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">group_id</span>
    <span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">Error</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">Code</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">InvalidGroup.Duplicate</span><span class="sh">'</span><span class="p">:</span>
            <span class="c1"># Group already exists, get its ID
</span>            <span class="n">response</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">describe_security_groups</span><span class="p">(</span>
                <span class="n">GroupNames</span><span class="o">=</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">SecurityGroups</span><span class="sh">'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="sh">'</span><span class="s">GroupId</span><span class="sh">'</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error creating security group: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">add_inbound_rule</span><span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Add an inbound rule to a security group.</span><span class="sh">"""</span>
    <span class="n">ec2_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">ec2</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ec2_client</span><span class="p">.</span><span class="nf">authorize_security_group_ingress</span><span class="p">(</span>
            <span class="n">GroupId</span><span class="o">=</span><span class="n">group_id</span><span class="p">,</span>
            <span class="n">IpPermissions</span><span class="o">=</span><span class="p">[</span>
                <span class="p">{</span>
                    <span class="sh">'</span><span class="s">IpProtocol</span><span class="sh">'</span><span class="p">:</span> <span class="n">protocol</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">FromPort</span><span class="sh">'</span><span class="p">:</span> <span class="n">port</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">ToPort</span><span class="sh">'</span><span class="p">:</span> <span class="n">port</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">IpRanges</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="sh">'</span><span class="s">CidrIp</span><span class="sh">'</span><span class="p">:</span> <span class="n">source</span><span class="p">,</span>
                            <span class="sh">'</span><span class="s">Description</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">Allow </span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s"> from </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="sh">'</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Added inbound rule: </span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s"> from </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">Error</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">Code</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">InvalidPermission.Duplicate</span><span class="sh">'</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Rule already exists: </span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s"> from </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error adding rule: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">add_outbound_rule</span><span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">destination</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Add an outbound rule to a security group.</span><span class="sh">"""</span>
    <span class="n">ec2_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">ec2</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ec2_client</span><span class="p">.</span><span class="nf">authorize_security_group_egress</span><span class="p">(</span>
            <span class="n">GroupId</span><span class="o">=</span><span class="n">group_id</span><span class="p">,</span>
            <span class="n">IpPermissions</span><span class="o">=</span><span class="p">[</span>
                <span class="p">{</span>
                    <span class="sh">'</span><span class="s">IpProtocol</span><span class="sh">'</span><span class="p">:</span> <span class="n">protocol</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">FromPort</span><span class="sh">'</span><span class="p">:</span> <span class="n">port</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">ToPort</span><span class="sh">'</span><span class="p">:</span> <span class="n">port</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">IpRanges</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="sh">'</span><span class="s">CidrIp</span><span class="sh">'</span><span class="p">:</span> <span class="n">destination</span><span class="p">,</span>
                            <span class="sh">'</span><span class="s">Description</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">Allow </span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s"> to </span><span class="si">{</span><span class="n">destination</span><span class="si">}</span><span class="sh">'</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Added outbound rule: </span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s"> to </span><span class="si">{</span><span class="n">destination</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">Error</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">Code</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">InvalidPermission.Duplicate</span><span class="sh">'</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Rule already exists: </span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s"> to </span><span class="si">{</span><span class="n">destination</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error adding rule: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_compliance_scanner_sg</span><span class="p">(</span><span class="n">vpc_id</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Create a security group for compliance scanner.</span><span class="sh">"""</span>
    <span class="n">group_id</span> <span class="o">=</span> <span class="nf">create_security_group</span><span class="p">(</span>
        <span class="n">vpc_id</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">compliance-scanner-sg</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">Security group for automated compliance scanner</span><span class="sh">'</span>
    <span class="p">)</span>
    
    <span class="k">if</span> <span class="n">group_id</span><span class="p">:</span>
        <span class="c1"># Inbound: SSH from VPC only
</span>        <span class="nf">add_inbound_rule</span><span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="sh">'</span><span class="s">tcp</span><span class="sh">'</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="sh">'</span><span class="s">10.0.0.0/16</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># Outbound: HTTPS for AWS APIs
</span>        <span class="nf">add_outbound_rule</span><span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="sh">'</span><span class="s">tcp</span><span class="sh">'</span><span class="p">,</span> <span class="mi">443</span><span class="p">,</span> <span class="sh">'</span><span class="s">0.0.0.0/0</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># Outbound: HTTP for package updates (optional, can be restricted)
</span>        <span class="nf">add_outbound_rule</span><span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="sh">'</span><span class="s">tcp</span><span class="sh">'</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="sh">'</span><span class="s">0.0.0.0/0</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">group_id</span>
    <span class="k">return</span> <span class="bp">None</span>

<span class="c1"># Example usage
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">vpc_id</span> <span class="o">=</span> <span class="sh">"</span><span class="s">vpc-12345678</span><span class="sh">"</span>  <span class="c1"># Your VPC ID
</span>    <span class="n">sg_id</span> <span class="o">=</span> <span class="nf">create_compliance_scanner_sg</span><span class="p">(</span><span class="n">vpc_id</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Security group ready: </span><span class="si">{</span><span class="n">sg_id</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="auditing-security-groups-for-risks">Auditing Security Groups for Risks</h2>

<p>Here‚Äôs a script to find risky security group configurations:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">boto3</span>

<span class="c1"># Risky ports that shouldn't be open to the internet
</span><span class="n">RISKY_PORTS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">22</span><span class="p">:</span> <span class="sh">"</span><span class="s">SSH</span><span class="sh">"</span><span class="p">,</span>
    <span class="mi">3389</span><span class="p">:</span> <span class="sh">"</span><span class="s">RDP</span><span class="sh">"</span><span class="p">,</span>
    <span class="mi">445</span><span class="p">:</span> <span class="sh">"</span><span class="s">SMB</span><span class="sh">"</span><span class="p">,</span>
    <span class="mi">139</span><span class="p">:</span> <span class="sh">"</span><span class="s">NetBIOS</span><span class="sh">"</span><span class="p">,</span>
    <span class="mi">1433</span><span class="p">:</span> <span class="sh">"</span><span class="s">SQL Server</span><span class="sh">"</span><span class="p">,</span>
    <span class="mi">3306</span><span class="p">:</span> <span class="sh">"</span><span class="s">MySQL</span><span class="sh">"</span><span class="p">,</span>
    <span class="mi">5432</span><span class="p">:</span> <span class="sh">"</span><span class="s">PostgreSQL</span><span class="sh">"</span><span class="p">,</span>
    <span class="mi">27017</span><span class="p">:</span> <span class="sh">"</span><span class="s">MongoDB</span><span class="sh">"</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">audit_security_groups</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Audit all security groups for risky configurations.</span><span class="sh">"""</span>
    <span class="n">ec2_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">ec2</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="c1"># Get all security groups
</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">describe_security_groups</span><span class="p">()</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Security Group Security Audit</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">sg</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">SecurityGroups</span><span class="sh">'</span><span class="p">]:</span>
        <span class="n">sg_id</span> <span class="o">=</span> <span class="n">sg</span><span class="p">[</span><span class="sh">'</span><span class="s">GroupId</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">sg_name</span> <span class="o">=</span> <span class="n">sg</span><span class="p">[</span><span class="sh">'</span><span class="s">GroupName</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">vpc_id</span> <span class="o">=</span> <span class="n">sg</span><span class="p">[</span><span class="sh">'</span><span class="s">VpcId</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">Security Group: </span><span class="si">{</span><span class="n">sg_name</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">sg_id</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">VPC: </span><span class="si">{</span><span class="n">vpc_id</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
        
        <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Check inbound rules
</span>        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">sg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">IpPermissions</span><span class="sh">'</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">port</span> <span class="o">=</span> <span class="n">rule</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">FromPort</span><span class="sh">'</span><span class="p">)</span>
            <span class="n">protocol</span> <span class="o">=</span> <span class="n">rule</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">IpProtocol</span><span class="sh">'</span><span class="p">)</span>
            
            <span class="c1"># Check if port is risky
</span>            <span class="k">if</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">RISKY_PORTS</span><span class="p">:</span>
                <span class="c1"># Check if open to internet (0.0.0.0/0)
</span>                <span class="k">for</span> <span class="n">ip_range</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">IpRanges</span><span class="sh">'</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">cidr</span> <span class="o">=</span> <span class="n">ip_range</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">CidrIp</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">cidr</span> <span class="o">==</span> <span class="sh">'</span><span class="s">0.0.0.0/0</span><span class="sh">'</span><span class="p">:</span>
                        <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span>
                            <span class="sa">f</span><span class="sh">"</span><span class="s">CRITICAL: Port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">RISKY_PORTS</span><span class="p">[</span><span class="n">port</span><span class="p">]</span><span class="si">}</span><span class="s">) </span><span class="sh">"</span>
                            <span class="sa">f</span><span class="sh">"</span><span class="s">is open to the internet (0.0.0.0/0)</span><span class="sh">"</span>
                        <span class="p">)</span>
            
            <span class="c1"># Check for overly permissive rules
</span>            <span class="k">for</span> <span class="n">ip_range</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">IpRanges</span><span class="sh">'</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">cidr</span> <span class="o">=</span> <span class="n">ip_range</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">CidrIp</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cidr</span> <span class="o">==</span> <span class="sh">'</span><span class="s">0.0.0.0/0</span><span class="sh">'</span> <span class="ow">and</span> <span class="n">protocol</span> <span class="o">!=</span> <span class="sh">'</span><span class="s">-1</span><span class="sh">'</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">port</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">443</span><span class="p">]:</span>  <span class="c1"># HTTP/HTTPS might be OK
</span>                        <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span>
                            <span class="sa">f</span><span class="sh">"</span><span class="s">WARNING: Port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s">) open to </span><span class="sh">"</span>
                            <span class="sa">f</span><span class="sh">"</span><span class="s">internet (0.0.0.0/0)</span><span class="sh">"</span>
                        <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">issues</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">‚ö†Ô∏è  Security Issues Found:</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">issue</span> <span class="ow">in</span> <span class="n">issues</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">   - </span><span class="si">{</span><span class="n">issue</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">‚úÖ No obvious security issues found</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Show current rules
</span>        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Current Inbound Rules:</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">IpPermissions</span><span class="sh">'</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">sg</span><span class="p">[</span><span class="sh">'</span><span class="s">IpPermissions</span><span class="sh">'</span><span class="p">]:</span>
                <span class="n">port</span> <span class="o">=</span> <span class="n">rule</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">FromPort</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">All</span><span class="sh">'</span><span class="p">)</span>
                <span class="n">protocol</span> <span class="o">=</span> <span class="n">rule</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">IpProtocol</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">all</span><span class="sh">'</span><span class="p">)</span>
                <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="n">ip</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">CidrIp</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">)</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">IpRanges</span><span class="sh">'</span><span class="p">,</span> <span class="p">[])]</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">   </span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s"> from </span><span class="si">{</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">sources</span><span class="p">)</span> <span class="k">if</span> <span class="n">sources</span> <span class="k">else</span> <span class="sh">'</span><span class="s">N/A</span><span class="sh">'</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">audit_security_groups</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="security-best-practices">Security Best Practices</h2>

<h3 id="1-principle-of-least-privilege">1. Principle of Least Privilege</h3>

<p><strong>Bad:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Allow: All traffic (0.0.0.0/0) on all ports
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Good:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>Allow: SSH (22) from 10.0.0.0/16 only
Allow: HTTPS (443) from 0.0.0.0/0 (if needed for web server)
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-restrict-outbound-traffic">2. Restrict Outbound Traffic</h3>

<p><strong>Bad:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Allow: All outbound traffic (default)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Good:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>Allow: HTTPS (443) to 0.0.0.0/0 (for AWS APIs)
Allow: HTTP (80) to specific update servers only
Block: Everything else
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-use-specific-ip-ranges">3. Use Specific IP Ranges</h3>

<p><strong>Bad:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Source: 0.0.0.0/0 (entire internet)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Good:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>Source: 10.0.1.0/24 (specific subnet)
Source: YOUR_OFFICE_IP/32 (your office IP only)
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4-reference-other-security-groups">4. Reference Other Security Groups</h3>

<p>Instead of IP addresses, reference other security groups:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c"># Allow app servers to access database</span>
aws ec2 authorize-security-group-ingress <span class="se">\</span>
  <span class="nt">--group-id</span> sg-database <span class="se">\</span>
  <span class="nt">--protocol</span> tcp <span class="se">\</span>
  <span class="nt">--port</span> 3306 <span class="se">\</span>
  <span class="nt">--source-group</span> sg-app-servers
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This is more secure and flexible than IP addresses!</p>

<h3 id="5-regular-audits">5. Regular Audits</h3>

<p>Run security group audits regularly:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c"># Use AWS Config to monitor security groups</span>
aws configservice put-config-rule <span class="se">\</span>
  <span class="nt">--config-rule</span> file://sg-audit-rule.json
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="common-mistakes">Common Mistakes</h2>

<h3 id="mistake-1-opening-ssh-to-internet">Mistake 1: Opening SSH to Internet</h3>

<p><strong>Don‚Äôt do this:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>SSH (22) from 0.0.0.0/0
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Do this instead:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>SSH (22) from YOUR_IP/32
# Or use AWS Systems Manager Session Manager (no SSH needed!)
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="mistake-2-opening-database-ports-to-internet">Mistake 2: Opening Database Ports to Internet</h3>

<p><strong>Don‚Äôt do this:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>MySQL (3306) from 0.0.0.0/0
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Do this instead:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>MySQL (3306) from 10.0.1.0/24 (app servers only)
# Or use RDS with proper security groups
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="mistake-3-not-restricting-outbound-traffic">Mistake 3: Not Restricting Outbound Traffic</h3>

<p><strong>Don‚Äôt do this:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Allow all outbound (default)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Do this instead:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>Allow only what's needed:
- HTTPS (443) for AWS APIs
- Specific ports for specific services
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="key-takeaways">Key Takeaways</h2>

<ol>
  <li><strong>Security Groups = Virtual Firewall</strong> - Control traffic to/from instances</li>
  <li><strong>Default Deny</strong> - Everything blocked unless explicitly allowed</li>
  <li><strong>Stateful</strong> - Return traffic automatically allowed</li>
  <li><strong>Least Privilege</strong> - Only allow what‚Äôs needed</li>
  <li><strong>Restrict Outbound</strong> - Don‚Äôt allow all outbound traffic</li>
  <li><strong>Use Specific IPs</strong> - Not 0.0.0.0/0 when possible</li>
  <li><strong>Reference Other SGs</strong> - More secure than IP addresses</li>
  <li><strong>Regular Audits</strong> - Check for risky configurations</li>
</ol>

<h2 id="practice-exercise">Practice Exercise</h2>

<p>Try this yourself:</p>

<ol>
  <li>Create a security group for a web server</li>
  <li>Add rules for HTTP, HTTPS, and SSH</li>
  <li>Restrict SSH to your IP only</li>
  <li>Audit your security groups for risks</li>
  <li>Create a security group that references another</li>
</ol>

<h2 id="resources-to-learn-more">Resources to Learn More</h2>

<ul>
  <li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/working-with-security-groups.html">AWS Security Groups Documentation</a></li>
  <li><a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html">Security Group Best Practices</a></li>
  <li><a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html">AWS Network ACLs</a></li>
</ul>

<h2 id="whats-next">What‚Äôs Next?</h2>

<p>Now that you understand Security Groups, you‚Äôre ready to:</p>
<ul>
  <li>Learn about VPC networking (our next post!)</li>
  <li>Configure secure multi-tier architectures</li>
  <li>Build properly secured applications</li>
</ul>

<p>Remember: Security Groups are your first line of defense. Configure them carefully!</p>

<blockquote>
  <p><strong>üí° Pro Tip:</strong> Use AWS Systems Manager Session Manager instead of SSH when possible. It doesn‚Äôt require opening port 22, and all sessions are logged. Much more secure!</p>
</blockquote>

<hr />

<p><em>Ready to dive deeper into networking? Check out our next post on AWS VPC, where we‚Äôll learn how to build secure network architectures!</em></p>]]></content><author><name></name></author><category term="AWS" /><category term="Cloud Security" /><category term="Networking" /><category term="aws" /><category term="ec2" /><category term="security-groups" /><category term="networking" /><category term="firewall" /><category term="cloud-security" /><summary type="html"><![CDATA[Security Groups are like bouncers at a club, but for your virtual servers. They decide what traffic is allowed in and what's blocked. Understanding them is crucial for securing your AWS infrastructure. Let's learn how they work and how to configure them properly.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://placehold.co/1000x400/FF9900/FFFFFF?text=EC2+Security+Groups" /><media:content medium="image" url="https://placehold.co/1000x400/FF9900/FFFFFF?text=EC2+Security+Groups" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Kubernetes for Security: Orchestrating Containers at Scale</title><link href="http://0.0.0.0:4000/posts/kubernetes-orchestration-basics/" rel="alternate" type="text/html" title="Kubernetes for Security: Orchestrating Containers at Scale" /><published>2025-11-19T09:00:00-05:00</published><updated>2025-11-15T03:28:20-05:00</updated><id>http://0.0.0.0:4000/posts/kubernetes-orchestration-basics</id><content type="html" xml:base="http://0.0.0.0:4000/posts/kubernetes-orchestration-basics/"><![CDATA[<blockquote>
  <p><strong>The problem:</strong> You have a compliance scanning tool running in a Docker container. It works great. But what if you need to scan 50 AWS accounts? Or run scans every hour? Or handle failures automatically? Managing containers manually doesn‚Äôt scale. Kubernetes (K8s) is your solution. It‚Äôs like having a smart system that manages your containers for you - automatically.</p>
</blockquote>

<h2 id="what-is-kubernetes-really">What is Kubernetes, Really?</h2>

<p>Think of Kubernetes like this:</p>

<p><strong>Without Kubernetes:</strong></p>
<ul>
  <li>You manually start containers</li>
  <li>You manually restart them when they crash</li>
  <li>You manually scale up/down</li>
  <li>You manually handle networking</li>
  <li>Lots of manual work</li>
</ul>

<p><strong>With Kubernetes:</strong></p>
<ul>
  <li>You declare what you want (‚ÄúI want 3 instances of my scanner‚Äù)</li>
  <li>Kubernetes makes it happen</li>
  <li>It restarts crashed containers automatically</li>
  <li>It scales based on demand</li>
  <li>It handles networking automatically</li>
  <li>It‚Äôs self-healing and self-managing</li>
</ul>

<p><strong>Real-world analogy:</strong> Kubernetes is like a smart warehouse manager. You say ‚ÄúI need 10 scanners running,‚Äù and the manager:</p>
<ul>
  <li>Finds available workers (nodes)</li>
  <li>Assigns them tasks (pods)</li>
  <li>Monitors their health</li>
  <li>Replaces them if they fail</li>
  <li>Balances the workload</li>
</ul>

<h2 id="core-kubernetes-concepts">Core Kubernetes Concepts</h2>

<h3 id="cluster-the-big-picture">Cluster: The Big Picture</h3>

<p>A <strong>cluster</strong> is your entire Kubernetes setup. It consists of:</p>
<ul>
  <li><strong>Control Plane</strong> (master) - The brain that makes decisions</li>
  <li><strong>Nodes</strong> (workers) - The machines that run your containers</li>
</ul>

<p>Think of it as a company:</p>
<ul>
  <li>Control Plane = Management</li>
  <li>Nodes = Employees doing the work</li>
</ul>

<h3 id="pods-the-smallest-unit">Pods: The Smallest Unit</h3>

<p>A <strong>pod</strong> is the smallest deployable unit in Kubernetes. It‚Äôs usually one container, but can contain multiple related containers.</p>

<p><strong>Key point:</strong> Pods are ephemeral (temporary). They can be created, destroyed, and recreated. Don‚Äôt store important data in pods!</p>

<h3 id="deployments-managing-pods">Deployments: Managing Pods</h3>

<p>A <strong>Deployment</strong> manages a set of pods. It ensures a specified number of pods are running.</p>

<p><strong>Real-world example:</strong> You want 3 instances of your compliance scanner running. You create a Deployment that says ‚Äúkeep 3 pods running.‚Äù If one crashes, Kubernetes automatically creates a new one.</p>

<h3 id="services-exposing-pods">Services: Exposing Pods</h3>

<p>A <strong>Service</strong> provides a stable network endpoint for pods. Even if pods are recreated with new IPs, the service provides a consistent address.</p>

<p><strong>Real-world example:</strong> Your scanner needs to be accessible. You create a Service that gives it a stable IP address and DNS name, even when pods restart.</p>

<h2 id="your-first-kubernetes-deployment">Your First Kubernetes Deployment</h2>

<p>Let‚Äôs deploy the compliance scanner to Kubernetes:</p>

<h3 id="step-1-create-a-deployment">Step 1: Create a Deployment</h3>

<p><code class="language-plaintext highlighter-rouge">deployment.yaml</code>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">compliance-scanner</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">compliance-scanner</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">2</span>  <span class="c1"># Run 2 instances</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">compliance-scanner</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">compliance-scanner</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">scanner</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">compliance-tool:latest</span>
        <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">AWS_ACCESS_KEY_ID</span>
          <span class="na">valueFrom</span><span class="pi">:</span>
            <span class="na">secretKeyRef</span><span class="pi">:</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">aws-credentials</span>
              <span class="na">key</span><span class="pi">:</span> <span class="s">access-key-id</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">AWS_SECRET_ACCESS_KEY</span>
          <span class="na">valueFrom</span><span class="pi">:</span>
            <span class="na">secretKeyRef</span><span class="pi">:</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">aws-credentials</span>
              <span class="na">key</span><span class="pi">:</span> <span class="s">secret-access-key</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">reports</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/app/reports</span>
      <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">reports</span>
        <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
          <span class="na">claimName</span><span class="pi">:</span> <span class="s">reports-pvc</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Breaking it down:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">replicas: 2</code> - Run 2 instances</li>
  <li><code class="language-plaintext highlighter-rouge">image: compliance-tool:latest</code> - The container image</li>
  <li><code class="language-plaintext highlighter-rouge">env</code> - Environment variables (from secrets)</li>
  <li><code class="language-plaintext highlighter-rouge">volumes</code> - Persistent storage for reports</li>
</ul>

<h3 id="step-2-create-a-service">Step 2: Create a Service</h3>

<p><code class="language-plaintext highlighter-rouge">service.yaml</code>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">compliance-scanner-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">compliance-scanner</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
    <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8080</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">ClusterIP</span>  <span class="c1"># Internal access only</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-3-create-a-persistentvolumeclaim-for-reports">Step 3: Create a PersistentVolumeClaim (for reports)</h3>

<p><code class="language-plaintext highlighter-rouge">pvc.yaml</code>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">reports-pvc</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">10Gi</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-4-create-secrets-for-aws-credentials">Step 4: Create Secrets (for AWS credentials)</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c"># Create secret from literal values</span>
kubectl create secret generic aws-credentials <span class="se">\</span>
  <span class="nt">--from-literal</span><span class="o">=</span>access-key-id<span class="o">=</span><span class="s1">'YOUR_ACCESS_KEY'</span> <span class="se">\</span>
  <span class="nt">--from-literal</span><span class="o">=</span>secret-access-key<span class="o">=</span><span class="s1">'YOUR_SECRET_KEY'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>‚ö†Ô∏è Security Note:</strong> Never commit secrets to Git! Use Kubernetes secrets or external secret management.</p>

<h3 id="step-5-deploy-everything">Step 5: Deploy Everything</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c"># Apply all configurations</span>
kubectl apply <span class="nt">-f</span> deployment.yaml
kubectl apply <span class="nt">-f</span> service.yaml
kubectl apply <span class="nt">-f</span> pvc.yaml

<span class="c"># Check status</span>
kubectl get pods
kubectl get services
kubectl get pvc
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Expected output:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>NAME                                READY   STATUS    RESTARTS   AGE
compliance-scanner-7d8f9b4c5-abc12   1/1     Running   0          10s
compliance-scanner-7d8f9b4c5-xyz34   1/1     Running   0          10s
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="common-kubernetes-commands">Common Kubernetes Commands</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="c"># Get pods</span>
kubectl get pods

<span class="c"># Get all resources</span>
kubectl get all

<span class="c"># Describe a pod (detailed info)</span>
kubectl describe pod compliance-scanner-abc12

<span class="c"># View logs</span>
kubectl logs compliance-scanner-abc12

<span class="c"># Follow logs (like tail -f)</span>
kubectl logs <span class="nt">-f</span> compliance-scanner-abc12

<span class="c"># Execute command in pod</span>
kubectl <span class="nb">exec</span> <span class="nt">-it</span> compliance-scanner-abc12 <span class="nt">--</span> /bin/bash

<span class="c"># Delete a pod (will be recreated by Deployment)</span>
kubectl delete pod compliance-scanner-abc12

<span class="c"># Scale deployment</span>
kubectl scale deployment compliance-scanner <span class="nt">--replicas</span><span class="o">=</span>5

<span class="c"># Update image</span>
kubectl <span class="nb">set </span>image deployment/compliance-scanner <span class="nv">scanner</span><span class="o">=</span>compliance-tool:v2.0

<span class="c"># Rollback update</span>
kubectl rollout undo deployment/compliance-scanner
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="scheduled-jobs-cronjobs">Scheduled Jobs: CronJobs</h2>

<p>Want to run your scanner on a schedule? Use a CronJob:</p>

<p><code class="language-plaintext highlighter-rouge">cronjob.yaml</code>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">batch/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CronJob</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">compliance-scanner-cron</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">schedule</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*"</span>  <span class="c1"># Run daily at 2 AM</span>
  <span class="na">jobTemplate</span><span class="pi">:</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">template</span><span class="pi">:</span>
        <span class="na">spec</span><span class="pi">:</span>
          <span class="na">containers</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">scanner</span>
            <span class="na">image</span><span class="pi">:</span> <span class="s">compliance-tool:latest</span>
            <span class="na">env</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">AWS_ACCESS_KEY_ID</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">secretKeyRef</span><span class="pi">:</span>
                  <span class="na">name</span><span class="pi">:</span> <span class="s">aws-credentials</span>
                  <span class="na">key</span><span class="pi">:</span> <span class="s">access-key-id</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">AWS_SECRET_ACCESS_KEY</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">secretKeyRef</span><span class="pi">:</span>
                  <span class="na">name</span><span class="pi">:</span> <span class="s">aws-credentials</span>
                  <span class="na">key</span><span class="pi">:</span> <span class="s">secret-access-key</span>
          <span class="na">restartPolicy</span><span class="pi">:</span> <span class="s">OnFailure</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Schedule syntax:</strong> <code class="language-plaintext highlighter-rouge">"minute hour day month weekday"</code></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">"0 2 * * *"</code> - Daily at 2 AM</li>
  <li><code class="language-plaintext highlighter-rouge">"0 */6 * * *"</code> - Every 6 hours</li>
  <li><code class="language-plaintext highlighter-rouge">"0 9 * * 1"</code> - Every Monday at 9 AM</li>
</ul>

<h2 id="configmaps-configuration-management">ConfigMaps: Configuration Management</h2>

<p>Store configuration separately from code:</p>

<p><code class="language-plaintext highlighter-rouge">configmap.yaml</code>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">scanner-config</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">baseline_checks.json</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">{</span>
      <span class="s">"iam_policy": {</span>
        <span class="s">"disallow_wildcard_action": true</span>
      <span class="s">},</span>
      <span class="s">"s3_bucket": {</span>
        <span class="s">"require_server_side_encryption": true</span>
      <span class="s">}</span>
    <span class="s">}</span>
  <span class="na">scan_interval</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3600"</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Use in deployment:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="na">containers</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">scanner</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">compliance-tool:latest</span>
  <span class="na">envFrom</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">configMapRef</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">scanner-config</span>
  <span class="na">volumeMounts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
    <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/app/config</span>
<span class="na">volumes</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
  <span class="na">configMap</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">scanner-config</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="security-best-practices">Security Best Practices</h2>

<h3 id="1-use-non-root-users">1. Use Non-Root Users</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="na">securityContext</span><span class="pi">:</span>
  <span class="na">runAsNonRoot</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">1000</span>
  <span class="na">fsGroup</span><span class="pi">:</span> <span class="m">1000</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-limit-resources">2. Limit Resources</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="na">resources</span><span class="pi">:</span>
  <span class="na">requests</span><span class="pi">:</span>
    <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">256Mi"</span>
    <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">250m"</span>
  <span class="na">limits</span><span class="pi">:</span>
    <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">512Mi"</span>
    <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">500m"</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This prevents one pod from consuming all resources.</p>

<h3 id="3-use-network-policies">3. Use Network Policies</h3>

<p>Control network traffic between pods:</p>

<p><code class="language-plaintext highlighter-rouge">network-policy.yaml</code>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NetworkPolicy</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">scanner-policy</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">podSelector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">compliance-scanner</span>
  <span class="na">policyTypes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">Ingress</span>
  <span class="pi">-</span> <span class="s">Egress</span>
  <span class="na">ingress</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">from</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">podSelector</span><span class="pi">:</span>
        <span class="na">matchLabels</span><span class="pi">:</span>
          <span class="na">app</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
  <span class="na">egress</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">to</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">podSelector</span><span class="pi">:</span>
        <span class="na">matchLabels</span><span class="pi">:</span>
          <span class="na">app</span><span class="pi">:</span> <span class="s">elasticsearch</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">9200</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4-use-secrets-not-environment-variables">4. Use Secrets, Not Environment Variables</h3>

<p><strong>Bad:</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="na">env</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">AWS_SECRET_ACCESS_KEY</span>
  <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">AKIA..."</span>  <span class="c1"># DON'T DO THIS!</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Good:</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="na">env</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">AWS_SECRET_ACCESS_KEY</span>
  <span class="na">valueFrom</span><span class="pi">:</span>
    <span class="na">secretKeyRef</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">aws-credentials</span>
      <span class="na">key</span><span class="pi">:</span> <span class="s">secret-access-key</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="complete-production-setup">Complete Production Setup</h2>

<p>Here‚Äôs a production-ready configuration:</p>

<h3 id="namespace">Namespace</h3>

<p><code class="language-plaintext highlighter-rouge">namespace.yaml</code>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Namespace</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">compliance-system</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="deployment-with-all-best-practices">Deployment (with all best practices)</h3>

<p><code class="language-plaintext highlighter-rouge">deployment-production.yaml</code>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
</pre></td><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">compliance-scanner</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">compliance-system</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">3</span>
  <span class="na">strategy</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">RollingUpdate</span>
    <span class="na">rollingUpdate</span><span class="pi">:</span>
      <span class="na">maxSurge</span><span class="pi">:</span> <span class="m">1</span>
      <span class="na">maxUnavailable</span><span class="pi">:</span> <span class="m">0</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">compliance-scanner</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">compliance-scanner</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="na">runAsNonRoot</span><span class="pi">:</span> <span class="kc">true</span>
        <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">1000</span>
        <span class="na">fsGroup</span><span class="pi">:</span> <span class="m">1000</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">scanner</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">compliance-tool:1.0.0</span>
        <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">Always</span>
        <span class="na">securityContext</span><span class="pi">:</span>
          <span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="kc">false</span>
          <span class="na">readOnlyRootFilesystem</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">capabilities</span><span class="pi">:</span>
            <span class="na">drop</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">ALL</span>
        <span class="na">resources</span><span class="pi">:</span>
          <span class="na">requests</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">256Mi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">250m"</span>
          <span class="na">limits</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">512Mi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">500m"</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">AWS_ACCESS_KEY_ID</span>
          <span class="na">valueFrom</span><span class="pi">:</span>
            <span class="na">secretKeyRef</span><span class="pi">:</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">aws-credentials</span>
              <span class="na">key</span><span class="pi">:</span> <span class="s">access-key-id</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">AWS_SECRET_ACCESS_KEY</span>
          <span class="na">valueFrom</span><span class="pi">:</span>
            <span class="na">secretKeyRef</span><span class="pi">:</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">aws-credentials</span>
              <span class="na">key</span><span class="pi">:</span> <span class="s">secret-access-key</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">reports</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/app/reports</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">tmp</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/tmp</span>
        <span class="na">livenessProbe</span><span class="pi">:</span>
          <span class="na">exec</span><span class="pi">:</span>
            <span class="na">command</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">python</span>
            <span class="pi">-</span> <span class="s">-c</span>
            <span class="pi">-</span> <span class="s2">"</span><span class="s">import</span><span class="nv"> </span><span class="s">sys;</span><span class="nv"> </span><span class="s">sys.exit(0)"</span>
          <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">30</span>
          <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
        <span class="na">readinessProbe</span><span class="pi">:</span>
          <span class="na">exec</span><span class="pi">:</span>
            <span class="na">command</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">python</span>
            <span class="pi">-</span> <span class="s">-c</span>
            <span class="pi">-</span> <span class="s2">"</span><span class="s">import</span><span class="nv"> </span><span class="s">sys;</span><span class="nv"> </span><span class="s">sys.exit(0)"</span>
          <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">5</span>
          <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">5</span>
      <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">reports</span>
        <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
          <span class="na">claimName</span><span class="pi">:</span> <span class="s">reports-pvc</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">tmp</span>
        <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="monitoring-and-observability">Monitoring and Observability</h2>

<h3 id="view-pod-logs">View Pod Logs</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c"># All pods</span>
kubectl logs <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>compliance-scanner

<span class="c"># Specific pod</span>
kubectl logs compliance-scanner-abc12

<span class="c"># Previous container (if crashed)</span>
kubectl logs compliance-scanner-abc12 <span class="nt">--previous</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="check-resource-usage">Check Resource Usage</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># Top pods by CPU/memory</span>
kubectl top pods

<span class="c"># Top nodes</span>
kubectl top nodes
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="describe-resources">Describe Resources</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c"># Get detailed info</span>
kubectl describe pod compliance-scanner-abc12
kubectl describe deployment compliance-scanner
kubectl describe service compliance-scanner-service
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="key-takeaways">Key Takeaways</h2>

<ol>
  <li><strong>Kubernetes = Container Orchestration</strong> - Manages containers at scale</li>
  <li><strong>Pods = Running Containers</strong> - The actual workloads</li>
  <li><strong>Deployments = Pod Managers</strong> - Ensure pods stay running</li>
  <li><strong>Services = Network Endpoints</strong> - Expose pods to network</li>
  <li><strong>Secrets = Secure Credentials</strong> - Never hardcode secrets</li>
  <li><strong>ConfigMaps = Configuration</strong> - Separate config from code</li>
  <li><strong>CronJobs = Scheduled Tasks</strong> - Run jobs on schedule</li>
  <li><strong>Always use non-root</strong> - Security best practice</li>
  <li><strong>Limit resources</strong> - Prevent resource exhaustion</li>
  <li><strong>Use namespaces</strong> - Organize resources</li>
</ol>

<h2 id="practice-exercise">Practice Exercise</h2>

<p>Try this yourself:</p>

<ol>
  <li>Create a simple deployment with 2 replicas</li>
  <li>Create a service to expose it</li>
  <li>Scale it to 5 replicas</li>
  <li>Create a CronJob that runs hourly</li>
  <li>Check logs and status</li>
</ol>

<h2 id="resources-to-learn-more">Resources to Learn More</h2>

<ul>
  <li><a href="https://kubernetes.io/docs/home/">Kubernetes Documentation</a></li>
  <li><a href="https://kubernetes.io/docs/tutorials/">Kubernetes Tutorial</a></li>
  <li><a href="https://kubernetes.io/docs/concepts/security/pod-security-standards/">Kubernetes Best Practices</a></li>
</ul>

<h2 id="whats-next">What‚Äôs Next?</h2>

<p>Now that you understand Kubernetes, you‚Äôre ready to:</p>
<ul>
  <li>Deploy to cloud Kubernetes (EKS, GKE, AKS)</li>
  <li>Set up CI/CD pipelines</li>
  <li>Monitor and scale applications</li>
  <li>Build production-ready systems</li>
</ul>

<p>Remember: Kubernetes is powerful but complex. Start simple, learn the basics, then gradually add complexity!</p>

<blockquote>
  <p><strong>üí° Pro Tip:</strong> Use <code class="language-plaintext highlighter-rouge">kubectl explain</code> to understand any Kubernetes resource. For example: <code class="language-plaintext highlighter-rouge">kubectl explain deployment.spec</code> shows you all available options for deployments!</p>
</blockquote>

<hr />

<p><em>Ready to secure your deployments? Check out our next post on CI/CD Security, where we‚Äôll learn how to build secure deployment pipelines!</em></p>]]></content><author><name></name></author><category term="Kubernetes" /><category term="DevOps" /><category term="Cloud Security" /><category term="kubernetes" /><category term="k8s" /><category term="containers" /><category term="orchestration" /><category term="devops" /><category term="cloud-security" /><summary type="html"><![CDATA[You've containerized your security tools with Docker. Great! But what happens when you need to run 100 containers? Or when one crashes? Or when traffic spikes? Kubernetes is the answer - it's like having an intelligent manager for your containerized applications.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://placehold.co/1000x400/326CE5/FFFFFF?text=Kubernetes+Orchestration" /><media:content medium="image" url="https://placehold.co/1000x400/326CE5/FFFFFF?text=Kubernetes+Orchestration" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Docker for Security Professionals: Containerization Made Simple</title><link href="http://0.0.0.0:4000/posts/docker-containerization-basics/" rel="alternate" type="text/html" title="Docker for Security Professionals: Containerization Made Simple" /><published>2025-11-18T09:00:00-05:00</published><updated>2025-11-15T03:28:20-05:00</updated><id>http://0.0.0.0:4000/posts/docker-containerization-basics</id><content type="html" xml:base="http://0.0.0.0:4000/posts/docker-containerization-basics/"><![CDATA[<blockquote>
  <p><strong>Here‚Äôs the problem:</strong> You write a Python script on your Mac. It works perfectly. You send it to your colleague who uses Windows. It doesn‚Äôt work. Different Python versions, missing libraries, path issues - the classic ‚Äúworks on my machine‚Äù problem. Docker solves this. Your script runs the same way everywhere. Let me show you how.</p>
</blockquote>

<h2 id="what-is-docker-really">What is Docker, Really?</h2>

<p>Think of Docker like this:</p>

<p><strong>Without Docker:</strong></p>
<ul>
  <li>Your app needs Python 3.11</li>
  <li>Your colleague has Python 3.9</li>
  <li>Your server has Python 3.10</li>
  <li>Everyone has different library versions</li>
  <li>Chaos ensues</li>
</ul>

<p><strong>With Docker:</strong></p>
<ul>
  <li>You package your app with Python 3.11</li>
  <li>It runs the same on Mac, Windows, Linux, AWS, anywhere</li>
  <li>No ‚Äúworks on my machine‚Äù problems</li>
  <li>Consistent, reproducible environments</li>
</ul>

<h2 id="the-core-concepts">The Core Concepts</h2>

<h3 id="images-the-blueprint">Images: The Blueprint</h3>

<p>An <strong>image</strong> is like a recipe. It contains:</p>
<ul>
  <li>The operating system (usually Linux)</li>
  <li>Your application code</li>
  <li>All dependencies</li>
  <li>Configuration files</li>
</ul>

<p>Think of it as a snapshot of everything your app needs to run.</p>

<h3 id="containers-the-running-instance">Containers: The Running Instance</h3>

<p>A <strong>container</strong> is a running instance of an image. Like how a house is built from a blueprint, a container is created from an image.</p>

<p><strong>Key point:</strong> You can run multiple containers from the same image. Each one is isolated and independent.</p>

<h3 id="dockerfile-the-recipe">Dockerfile: The Recipe</h3>

<p>A <strong>Dockerfile</strong> is the instructions for building an image. It‚Äôs like a recipe card:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> python:3.11-slim</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> requirements.txt .</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt
<span class="k">COPY</span><span class="s"> . .</span>
<span class="k">CMD</span><span class="s"> ["python", "main.py"]</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This says:</p>
<ol>
  <li>Start with Python 3.11</li>
  <li>Set working directory to /app</li>
  <li>Copy requirements file</li>
  <li>Install dependencies</li>
  <li>Copy application code</li>
  <li>Run the application</li>
</ol>

<h2 id="your-first-docker-container">Your First Docker Container</h2>

<p>Let‚Äôs containerize a simple Python script:</p>

<h3 id="step-1-create-a-simple-python-script">Step 1: Create a Simple Python Script</h3>

<p><code class="language-plaintext highlighter-rouge">hello_security.py</code>:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">platform</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Security Compliance Scanner</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Running on: </span><span class="si">{</span><span class="n">platform</span><span class="p">.</span><span class="nf">system</span><span class="p">()</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Python version: </span><span class="si">{</span><span class="n">sys</span><span class="p">.</span><span class="n">version</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">‚úÖ Scanner initialized successfully!</span><span class="sh">"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-2-create-a-dockerfile">Step 2: Create a Dockerfile</h3>

<p><code class="language-plaintext highlighter-rouge">Dockerfile</code>:</p>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c"># Use Python 3.11 as base image</span>
<span class="k">FROM</span><span class="s"> python:3.11-slim</span>

<span class="c"># Set working directory</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Copy the script</span>
<span class="k">COPY</span><span class="s"> hello_security.py .</span>

<span class="c"># Run the script</span>
<span class="k">CMD</span><span class="s"> ["python", "hello_security.py"]</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-3-build-the-image">Step 3: Build the Image</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker build <span class="nt">-t</span> security-scanner:latest <span class="nb">.</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Breaking it down:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">docker build</code> - Build command</li>
  <li><code class="language-plaintext highlighter-rouge">-t security-scanner:latest</code> - Tag (name:version)</li>
  <li><code class="language-plaintext highlighter-rouge">.</code> - Build context (current directory)</li>
</ul>

<h3 id="step-4-run-the-container">Step 4: Run the Container</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker run security-scanner:latest
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Output:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>==================================================
Security Compliance Scanner
==================================================
Running on: Linux
Python version: 3.11.0 (default, ...)
‚úÖ Scanner initialized successfully!
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Real-world example:</strong> You‚Äôve just created a containerized version of your script. It will run the same way on your laptop, your colleague‚Äôs Windows machine, and your AWS EC2 instance!</p>

<h2 id="containerizing-the-compliance-tool">Containerizing the Compliance Tool</h2>

<p>Let‚Äôs containerize a real security tool - our compliance scanner:</p>

<h3 id="step-1-project-structure">Step 1: Project Structure</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>compliance-tool/
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ main.py
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ baseline_checks.json
‚îî‚îÄ‚îÄ reports/
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-2-requirementstxt">Step 2: requirements.txt</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>boto3&gt;=1.28.0
pandas&gt;=2.0.0
openpyxl&gt;=3.1.0
elasticsearch&gt;=8.8.0
requests&gt;=2.31.0
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-3-dockerfile">Step 3: Dockerfile</h3>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="c"># Use Python 3.11 slim image (smaller, faster)</span>
<span class="k">FROM</span><span class="s"> python:3.11-slim</span>

<span class="c"># Set working directory</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Install system dependencies (if needed)</span>
<span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> <span class="se">\
</span>    gcc <span class="se">\
</span>    <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span>

<span class="c"># Copy requirements first (for better caching)</span>
<span class="k">COPY</span><span class="s"> requirements.txt .</span>

<span class="c"># Install Python dependencies</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nt">-r</span> requirements.txt

<span class="c"># Copy application code</span>
<span class="k">COPY</span><span class="s"> . .</span>

<span class="c"># Create reports directory</span>
<span class="k">RUN </span><span class="nb">mkdir</span> <span class="nt">-p</span> /app/reports

<span class="c"># Set environment variables</span>
<span class="k">ENV</span><span class="s"> PYTHONUNBUFFERED=1</span>

<span class="c"># Run the application</span>
<span class="k">CMD</span><span class="s"> ["python", "main.py"]</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-4-build-and-run">Step 4: Build and Run</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c"># Build the image</span>
docker build <span class="nt">-t</span> compliance-tool:1.0 <span class="nb">.</span>

<span class="c"># Run the container</span>
docker run <span class="nt">--rm</span> <span class="se">\</span>
  <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>/reports:/app/reports <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="nv">$AWS_ACCESS_KEY_ID</span> <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="nv">$AWS_SECRET_ACCESS_KEY</span> <span class="se">\</span>
  compliance-tool:1.0
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>What this does:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">--rm</code> - Remove container after it stops</li>
  <li><code class="language-plaintext highlighter-rouge">-v $(pwd)/reports:/app/reports</code> - Mount reports directory (persist data)</li>
  <li><code class="language-plaintext highlighter-rouge">-e</code> - Pass environment variables (AWS credentials)</li>
</ul>

<h2 id="docker-compose-multi-container-applications">Docker Compose: Multi-Container Applications</h2>

<p>Docker Compose lets you run multiple containers together. Perfect for complex applications!</p>

<h3 id="docker-composeyml">docker-compose.yml</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># Compliance scanner</span>
  <span class="na">scanner</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">.</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">compliance-tool:latest</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}</span>
      <span class="pi">-</span> <span class="s">AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}</span>
      <span class="pi">-</span> <span class="s">AWS_DEFAULT_REGION=us-east-1</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./reports:/app/reports</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">nginx</span>
  
  <span class="c1"># Web server to view reports</span>
  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8080:80"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./reports:/usr/share/nginx/html/reports:ro</span>
      <span class="pi">-</span> <span class="s">./nginx.conf:/etc/nginx/nginx.conf:ro</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
  
  <span class="c1"># Scheduled scanner (runs daily)</span>
  <span class="na">scheduler</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">compliance-tool:latest</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">python main.py</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}</span>
      <span class="pi">-</span> <span class="s">AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./reports:/app/reports</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Run it:</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker-compose up <span class="nt">-d</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This starts:</p>
<ul>
  <li>Your compliance scanner</li>
  <li>An Nginx web server (view reports at http://localhost:8080)</li>
  <li>A scheduled scanner</li>
</ul>

<p><strong>Real-world example:</strong> This is exactly how you‚Äôd deploy the compliance tool in production. One command starts everything!</p>

<h2 id="security-best-practices">Security Best Practices</h2>

<h3 id="1-dont-run-as-root">1. Don‚Äôt Run as Root</h3>

<p><strong>Bad:</strong></p>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> python:3.11</span>
<span class="c"># Runs as root by default - DANGEROUS!</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Good:</strong></p>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> python:3.11-slim</span>

<span class="c"># Create non-root user</span>
<span class="k">RUN </span>useradd <span class="nt">-m</span> <span class="nt">-u</span> 1000 appuser

<span class="c"># Switch to non-root user</span>
<span class="k">USER</span><span class="s"> appuser</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-use-dockerignore">2. Use .dockerignore</h3>

<p>Create a <code class="language-plaintext highlighter-rouge">.dockerignore</code> file (like <code class="language-plaintext highlighter-rouge">.gitignore</code>):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>__pycache__
*.pyc
.git
.env
*.log
reports/*
.DS_Store
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This prevents sensitive files from being copied into the image.</p>

<h3 id="3-dont-store-secrets-in-images">3. Don‚Äôt Store Secrets in Images</h3>

<p><strong>Bad:</strong></p>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="k">ENV</span><span class="s"> AWS_ACCESS_KEY_ID="AKIA..."</span>
<span class="k">ENV</span><span class="s"> AWS_SECRET_ACCESS_KEY="secret..."</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Good:</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c"># Pass as environment variables at runtime</span>
docker run <span class="nt">-e</span> <span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="nv">$AWS_ACCESS_KEY_ID</span> ...
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Or use Docker secrets (for Docker Swarm) or mounted files.</p>

<h3 id="4-use-multi-stage-builds">4. Use Multi-Stage Builds</h3>

<p>Keep images small:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="c"># Stage 1: Build</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s">builder</span>
<span class="k">WORKDIR</span><span class="s"> /build</span>
<span class="k">COPY</span><span class="s"> requirements.txt .</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--user</span> <span class="nt">-r</span> requirements.txt

<span class="c"># Stage 2: Runtime</span>
<span class="k">FROM</span><span class="s"> python:3.11-slim</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="c"># Copy only installed packages from builder</span>
<span class="k">COPY</span><span class="s"> --from=builder /root/.local /root/.local</span>
<span class="k">COPY</span><span class="s"> . .</span>
<span class="k">ENV</span><span class="s"> PATH=/root/.local/bin:$PATH</span>
<span class="k">CMD</span><span class="s"> ["python", "main.py"]</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This creates a smaller final image (no build tools).</p>

<h3 id="5-scan-images-for-vulnerabilities">5. Scan Images for Vulnerabilities</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c"># Use Trivy to scan images</span>
docker run <span class="nt">--rm</span> <span class="se">\</span>
  <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="se">\</span>
  aquasec/trivy image compliance-tool:latest
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="common-docker-commands">Common Docker Commands</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="c"># List running containers</span>
docker ps

<span class="c"># List all containers (including stopped)</span>
docker ps <span class="nt">-a</span>

<span class="c"># List images</span>
docker images

<span class="c"># Stop a container</span>
docker stop container-name

<span class="c"># Remove a container</span>
docker <span class="nb">rm </span>container-name

<span class="c"># Remove an image</span>
docker rmi image-name

<span class="c"># View logs</span>
docker logs container-name

<span class="c"># Execute command in running container</span>
docker <span class="nb">exec</span> <span class="nt">-it</span> container-name /bin/bash

<span class="c"># Build image</span>
docker build <span class="nt">-t</span> my-image:tag <span class="nb">.</span>

<span class="c"># Run container</span>
docker run <span class="nt">-d</span> <span class="nt">--name</span> my-container my-image:tag
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="real-world-example-complete-compliance-tool-setup">Real-World Example: Complete Compliance Tool Setup</h2>

<p>Here‚Äôs a production-ready setup:</p>

<h3 id="dockerfile">Dockerfile</h3>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> python:3.11-slim</span>

<span class="c"># Create non-root user</span>
<span class="k">RUN </span>useradd <span class="nt">-m</span> <span class="nt">-u</span> 1000 scanner <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">mkdir</span> <span class="nt">-p</span> /app/reports <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">chown</span> <span class="nt">-R</span> scanner:scanner /app

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Install dependencies</span>
<span class="k">COPY</span><span class="s"> requirements.txt .</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nt">-r</span> requirements.txt <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">rm</span> <span class="nt">-rf</span> /root/.cache

<span class="c"># Copy application</span>
<span class="k">COPY</span><span class="s"> --chown=scanner:scanner . .</span>

<span class="c"># Switch to non-root user</span>
<span class="k">USER</span><span class="s"> scanner</span>

<span class="c"># Health check</span>
<span class="k">HEALTHCHECK</span><span class="s"> --interval=30s --timeout=3s \</span>
  CMD python -c "import sys; sys.exit(0)"

<span class="k">CMD</span><span class="s"> ["python", "main.py"]</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="docker-composeyml-1">docker-compose.yml</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">scanner</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">compliance-tool:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">compliance-scanner</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}</span>
      <span class="pi">-</span> <span class="s">AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}</span>
      <span class="pi">-</span> <span class="s">AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION:-us-east-1}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./reports:/app/reports</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">compliance-network</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">compliance-network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="debugging-containers">Debugging Containers</h2>

<h3 id="view-logs">View Logs</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># Follow logs</span>
docker logs <span class="nt">-f</span> container-name

<span class="c"># Last 100 lines</span>
docker logs <span class="nt">--tail</span> 100 container-name
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="enter-container">Enter Container</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># Get a shell inside the container</span>
docker <span class="nb">exec</span> <span class="nt">-it</span> container-name /bin/bash

<span class="c"># Check what's running</span>
docker <span class="nb">exec </span>container-name ps aux
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="inspect-container">Inspect Container</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># View container details</span>
docker inspect container-name

<span class="c"># View container stats</span>
docker stats container-name
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="key-takeaways">Key Takeaways</h2>

<ol>
  <li><strong>Docker = Consistency</strong> - Same environment everywhere</li>
  <li><strong>Images = Blueprints</strong> - Define what your app needs</li>
  <li><strong>Containers = Running Instances</strong> - Actual running applications</li>
  <li><strong>Dockerfile = Recipe</strong> - Instructions for building images</li>
  <li><strong>Don‚Äôt run as root</strong> - Security best practice</li>
  <li><strong>Use .dockerignore</strong> - Don‚Äôt copy unnecessary files</li>
  <li><strong>Multi-stage builds</strong> - Keep images small</li>
  <li><strong>Scan for vulnerabilities</strong> - Use Trivy or similar tools</li>
</ol>

<h2 id="practice-exercise">Practice Exercise</h2>

<p>Try this yourself:</p>

<ol>
  <li>Create a simple Python script</li>
  <li>Write a Dockerfile for it</li>
  <li>Build the image</li>
  <li>Run the container</li>
  <li>Modify the script and rebuild</li>
  <li>Use Docker Compose to run multiple containers</li>
</ol>

<h2 id="resources-to-learn-more">Resources to Learn More</h2>

<ul>
  <li><a href="https://docs.docker.com/">Docker Documentation</a></li>
  <li><a href="https://docs.docker.com/develop/dev-best-practices/">Docker Best Practices</a></li>
  <li><a href="https://docs.docker.com/engine/security/">Docker Security</a></li>
</ul>

<h2 id="whats-next">What‚Äôs Next?</h2>

<p>Now that you understand Docker, you‚Äôre ready to:</p>
<ul>
  <li>Deploy containers to Kubernetes (our next post!)</li>
  <li>Build CI/CD pipelines with Docker</li>
  <li>Create production-ready containerized applications</li>
</ul>

<p>Remember: Docker is about consistency and portability. Master it, and deployment becomes much easier!</p>

<blockquote>
  <p><strong>üí° Pro Tip:</strong> Start with simple containers, then gradually add complexity. Don‚Äôt try to containerize everything at once. Learn the basics first, then build up!</p>
</blockquote>

<hr />

<p><em>Ready to orchestrate containers at scale? Check out our next post on Kubernetes, where we‚Äôll learn how to manage containerized applications in production!</em></p>]]></content><author><name></name></author><category term="Docker" /><category term="DevOps" /><category term="Security" /><category term="docker" /><category term="containers" /><category term="containerization" /><category term="devops" /><category term="security" /><category term="automation" /><summary type="html"><![CDATA[Docker is like shipping containers for software. Just like how shipping containers revolutionized global trade by standardizing how goods are transported, Docker standardizes how applications run. Let's learn how to use it for security tools.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://placehold.co/1000x400/2496ED/FFFFFF?text=Docker+Containerization" /><media:content medium="image" url="https://placehold.co/1000x400/2496ED/FFFFFF?text=Docker+Containerization" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Python &amp;amp; Boto3: Automating AWS Like a Security Pro</title><link href="http://0.0.0.0:4000/posts/python-boto3-aws-automation/" rel="alternate" type="text/html" title="Python &amp;amp; Boto3: Automating AWS Like a Security Pro" /><published>2025-11-17T09:00:00-05:00</published><updated>2025-11-15T03:28:20-05:00</updated><id>http://0.0.0.0:4000/posts/python-boto3-aws-automation</id><content type="html" xml:base="http://0.0.0.0:4000/posts/python-boto3-aws-automation/"><![CDATA[<blockquote>
  <p><strong>Here‚Äôs the truth:</strong> As a security professional, you‚Äôll spend way too much time doing repetitive tasks. Checking 50 S3 buckets for public access? Manually reviewing IAM policies? Scanning EC2 instances for misconfigurations? That‚Äôs hours of work that could be automated. Python and Boto3 are your superpowers for automating AWS security. Let me show you how.</p>
</blockquote>

<h2 id="why-python--boto3">Why Python + Boto3?</h2>

<p><strong>Python</strong> is the language of choice for security automation because:</p>
<ul>
  <li>Easy to read and write (even if you‚Äôre not a full-time developer)</li>
  <li>Huge ecosystem of security libraries</li>
  <li>Great for scripting and automation</li>
  <li>Widely used in the security community</li>
</ul>

<p><strong>Boto3</strong> is AWS‚Äôs official Python SDK. It‚Äôs like having a remote control for all AWS services.</p>

<p>Think of it this way:</p>
<ul>
  <li><strong>AWS Console</strong> = Manual control (clicking buttons)</li>
  <li><strong>AWS CLI</strong> = Command-line control (typing commands)</li>
  <li><strong>Boto3</strong> = Programmatic control (writing scripts that do the work for you)</li>
</ul>

<h2 id="getting-started-installation-and-setup">Getting Started: Installation and Setup</h2>

<h3 id="step-1-install-boto3">Step 1: Install Boto3</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>pip <span class="nb">install </span>boto3
</pre></td></tr></tbody></table></code></pre></div></div>

<p>That‚Äôs it! Well, almost. You‚Äôll also need AWS credentials configured.</p>

<h3 id="step-2-configure-aws-credentials">Step 2: Configure AWS Credentials</h3>

<p>You have three options:</p>

<p><strong>Option 1: AWS CLI (Easiest)</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>aws configure
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This creates credentials in <code class="language-plaintext highlighter-rouge">~/.aws/credentials</code> that Boto3 automatically uses.</p>

<p><strong>Option 2: Environment Variables</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="s2">"your-access-key"</span>
<span class="nb">export </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="s2">"your-secret-key"</span>
<span class="nb">export </span><span class="nv">AWS_DEFAULT_REGION</span><span class="o">=</span><span class="s2">"us-east-1"</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Option 3: IAM Role (Best for Production)</strong>
If your script runs on an EC2 instance, use an IAM role. No credentials needed!</p>

<h3 id="step-3-your-first-boto3-script">Step 3: Your First Boto3 Script</h3>

<p>Let‚Äôs start simple - list all your S3 buckets:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">boto3</span>

<span class="c1"># Create an S3 client
</span><span class="n">s3_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">s3</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># List all buckets
</span><span class="n">response</span> <span class="o">=</span> <span class="n">s3_client</span><span class="p">.</span><span class="nf">list_buckets</span><span class="p">()</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Your S3 Buckets:</span><span class="sh">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">Buckets</span><span class="sh">'</span><span class="p">]:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  - </span><span class="si">{</span><span class="n">bucket</span><span class="p">[</span><span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s"> (created: </span><span class="si">{</span><span class="n">bucket</span><span class="p">[</span><span class="sh">'</span><span class="s">CreationDate</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Run it:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>python list_buckets.py
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Real-world example:</strong> You need to audit all your S3 buckets. Instead of clicking through the console 50 times, this script does it in seconds!</p>

<h2 id="understanding-boto3-clients-vs-resources">Understanding Boto3 Clients vs Resources</h2>

<p>Boto3 has two ways to interact with AWS:</p>

<h3 id="clients-low-level">Clients (Low-Level)</h3>

<p>Clients give you direct access to AWS API operations. More control, more verbose:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">boto3</span>

<span class="c1"># Create a client
</span><span class="n">ec2_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">ec2</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># Describe instances (returns raw API response)
</span><span class="n">response</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">describe_instances</span><span class="p">()</span>

<span class="c1"># Access the data
</span><span class="k">for</span> <span class="n">reservation</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">Reservations</span><span class="sh">'</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">reservation</span><span class="p">[</span><span class="sh">'</span><span class="s">Instances</span><span class="sh">'</span><span class="p">]:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Instance ID: </span><span class="si">{</span><span class="n">instance</span><span class="p">[</span><span class="sh">'</span><span class="s">InstanceId</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">State: </span><span class="si">{</span><span class="n">instance</span><span class="p">[</span><span class="sh">'</span><span class="s">State</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="resources-high-level">Resources (High-Level)</h3>

<p>Resources provide a more Pythonic interface. Easier to use, less control:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">boto3</span>

<span class="c1"># Create a resource
</span><span class="n">ec2_resource</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">resource</span><span class="p">(</span><span class="sh">'</span><span class="s">ec2</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># Get all instances (more Pythonic)
</span><span class="n">instances</span> <span class="o">=</span> <span class="n">ec2_resource</span><span class="p">.</span><span class="n">instances</span><span class="p">.</span><span class="nf">all</span><span class="p">()</span>

<span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Instance ID: </span><span class="si">{</span><span class="n">instance</span><span class="p">.</span><span class="nb">id</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">State: </span><span class="si">{</span><span class="n">instance</span><span class="p">.</span><span class="n">state</span><span class="p">[</span><span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>When to use which:</strong></p>
<ul>
  <li><strong>Clients</strong> - When you need specific API operations or more control</li>
  <li><strong>Resources</strong> - When you want simpler, more Pythonic code</li>
</ul>

<p>For security automation, I usually use <strong>clients</strong> because they give me more control over what I‚Äôm doing.</p>

<h2 id="real-world-example-1-compliance-scanner-for-s3">Real-World Example 1: Compliance Scanner for S3</h2>

<p>Let‚Äôs build a script that checks all S3 buckets for security issues:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">boto3</span>
<span class="kn">from</span> <span class="n">botocore.exceptions</span> <span class="kn">import</span> <span class="n">ClientError</span>

<span class="k">def</span> <span class="nf">check_s3_bucket_security</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Check a single S3 bucket for common security issues.</span><span class="sh">"""</span>
    <span class="n">s3_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">s3</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Check 1: Public Access Block
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="n">public_access</span> <span class="o">=</span> <span class="n">s3_client</span><span class="p">.</span><span class="nf">get_public_access_block</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">)</span>
            <span class="n">block_config</span> <span class="o">=</span> <span class="n">public_access</span><span class="p">[</span><span class="sh">'</span><span class="s">PublicAccessBlockConfiguration</span><span class="sh">'</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="nf">all</span><span class="p">([</span>
                <span class="n">block_config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">BlockPublicAcls</span><span class="sh">'</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
                <span class="n">block_config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">BlockPublicPolicy</span><span class="sh">'</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
                <span class="n">block_config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">RestrictPublicBuckets</span><span class="sh">'</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            <span class="p">]):</span>
                <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">Public access not fully blocked</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ClientError</span><span class="p">:</span>
            <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">CRITICAL: Public access block not configured!</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Check 2: Encryption
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="n">encryption</span> <span class="o">=</span> <span class="n">s3_client</span><span class="p">.</span><span class="nf">get_bucket_encryption</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="sh">'</span><span class="s">ServerSideEncryptionConfiguration</span><span class="sh">'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">encryption</span><span class="p">:</span>
                <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">Encryption not configured</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ClientError</span><span class="p">:</span>
            <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">CRITICAL: Encryption not enabled!</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Check 3: Versioning
</span>        <span class="n">versioning</span> <span class="o">=</span> <span class="n">s3_client</span><span class="p">.</span><span class="nf">get_bucket_versioning</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">versioning</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">Status</span><span class="sh">'</span><span class="p">)</span> <span class="o">!=</span> <span class="sh">'</span><span class="s">Enabled</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">Versioning not enabled</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Check 4: Bucket Policy (check if it allows public access)
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="n">policy</span> <span class="o">=</span> <span class="n">s3_client</span><span class="p">.</span><span class="nf">get_bucket_policy</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">)</span>
            <span class="n">policy_doc</span> <span class="o">=</span> <span class="nf">eval</span><span class="p">(</span><span class="n">policy</span><span class="p">[</span><span class="sh">'</span><span class="s">Policy</span><span class="sh">'</span><span class="p">])</span>  <span class="c1"># Convert string to dict
</span>            
            <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">policy_doc</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">Statement</span><span class="sh">'</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="k">if</span> <span class="n">statement</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">Principal</span><span class="sh">'</span><span class="p">)</span> <span class="o">==</span> <span class="sh">'</span><span class="s">*</span><span class="sh">'</span> <span class="ow">or</span> <span class="n">statement</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">Principal</span><span class="sh">'</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="sh">'</span><span class="s">AWS</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">*</span><span class="sh">'</span><span class="p">}:</span>
                    <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">WARNING: Bucket policy allows public access</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ClientError</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># No policy is fine
</span>        
        <span class="k">return</span> <span class="n">issues</span>
        
    <span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error checking bucket: </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">scan_all_s3_buckets</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Scan all S3 buckets for security issues.</span><span class="sh">"""</span>
    <span class="n">s3_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">s3</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="c1"># Get all buckets
</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">s3_client</span><span class="p">.</span><span class="nf">list_buckets</span><span class="p">()</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">S3 Bucket Security Scan</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">Buckets</span><span class="sh">'</span><span class="p">]:</span>
        <span class="n">bucket_name</span> <span class="o">=</span> <span class="n">bucket</span><span class="p">[</span><span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">]</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">Scanning: </span><span class="si">{</span><span class="n">bucket_name</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        
        <span class="n">issues</span> <span class="o">=</span> <span class="nf">check_s3_bucket_security</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">issues</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">‚ö†Ô∏è  Issues Found:</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">issue</span> <span class="ow">in</span> <span class="n">issues</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">   - </span><span class="si">{</span><span class="n">issue</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">‚úÖ No issues found!</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">scan_all_s3_buckets</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>What this does:</strong></p>
<ol>
  <li>Lists all your S3 buckets</li>
  <li>Checks each one for:
    <ul>
      <li>Public access configuration</li>
      <li>Encryption settings</li>
      <li>Versioning status</li>
      <li>Public bucket policies</li>
    </ul>
  </li>
  <li>Reports any issues found</li>
</ol>

<p><strong>Real-world use:</strong> Run this daily as part of your compliance checks. It‚Äôs exactly what the automated compliance tool does!</p>

<h2 id="real-world-example-2-ec2-security-group-auditor">Real-World Example 2: EC2 Security Group Auditor</h2>

<p>Let‚Äôs check EC2 security groups for risky open ports:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">boto3</span>

<span class="c1"># Risky ports that shouldn't be open to the internet
</span><span class="n">RISKY_PORTS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">22</span><span class="p">:</span> <span class="sh">"</span><span class="s">SSH</span><span class="sh">"</span><span class="p">,</span>
    <span class="mi">3389</span><span class="p">:</span> <span class="sh">"</span><span class="s">RDP</span><span class="sh">"</span><span class="p">,</span>
    <span class="mi">445</span><span class="p">:</span> <span class="sh">"</span><span class="s">SMB</span><span class="sh">"</span><span class="p">,</span>
    <span class="mi">139</span><span class="p">:</span> <span class="sh">"</span><span class="s">NetBIOS</span><span class="sh">"</span><span class="p">,</span>
    <span class="mi">1433</span><span class="p">:</span> <span class="sh">"</span><span class="s">SQL Server</span><span class="sh">"</span><span class="p">,</span>
    <span class="mi">3306</span><span class="p">:</span> <span class="sh">"</span><span class="s">MySQL</span><span class="sh">"</span><span class="p">,</span>
    <span class="mi">5432</span><span class="p">:</span> <span class="sh">"</span><span class="s">PostgreSQL</span><span class="sh">"</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">check_security_group</span><span class="p">(</span><span class="n">security_group_id</span><span class="p">,</span> <span class="n">group_name</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Check a security group for risky configurations.</span><span class="sh">"""</span>
    <span class="n">ec2_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">ec2</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Get security group details
</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">describe_security_groups</span><span class="p">(</span>
        <span class="n">GroupIds</span><span class="o">=</span><span class="p">[</span><span class="n">security_group_id</span><span class="p">]</span>
    <span class="p">)</span>
    
    <span class="n">sg</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">SecurityGroups</span><span class="sh">'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Check each rule
</span>    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">sg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">IpPermissions</span><span class="sh">'</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">rule</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">FromPort</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">protocol</span> <span class="o">=</span> <span class="n">rule</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">IpProtocol</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># Check if port is risky
</span>        <span class="k">if</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">RISKY_PORTS</span><span class="p">:</span>
            <span class="c1"># Check if it's open to the internet (0.0.0.0/0)
</span>            <span class="k">for</span> <span class="n">ip_range</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">IpRanges</span><span class="sh">'</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="k">if</span> <span class="n">ip_range</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">CidrIp</span><span class="sh">'</span><span class="p">)</span> <span class="o">==</span> <span class="sh">'</span><span class="s">0.0.0.0/0</span><span class="sh">'</span><span class="p">:</span>
                    <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="sh">"</span><span class="s">CRITICAL: Port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">RISKY_PORTS</span><span class="p">[</span><span class="n">port</span><span class="p">]</span><span class="si">}</span><span class="s">) </span><span class="sh">"</span>
                        <span class="sa">f</span><span class="sh">"</span><span class="s">is open to the internet (0.0.0.0/0)</span><span class="sh">"</span>
                    <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">issues</span>

<span class="k">def</span> <span class="nf">scan_all_security_groups</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Scan all security groups for risky configurations.</span><span class="sh">"""</span>
    <span class="n">ec2_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">ec2</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="c1"># Get all security groups
</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">describe_security_groups</span><span class="p">()</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">EC2 Security Group Audit</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">sg</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">SecurityGroups</span><span class="sh">'</span><span class="p">]:</span>
        <span class="n">sg_id</span> <span class="o">=</span> <span class="n">sg</span><span class="p">[</span><span class="sh">'</span><span class="s">GroupId</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">sg_name</span> <span class="o">=</span> <span class="n">sg</span><span class="p">[</span><span class="sh">'</span><span class="s">GroupName</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">Checking: </span><span class="si">{</span><span class="n">sg_name</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">sg_id</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        
        <span class="n">issues</span> <span class="o">=</span> <span class="nf">check_security_group</span><span class="p">(</span><span class="n">sg_id</span><span class="p">,</span> <span class="n">sg_name</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">issues</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">issue</span> <span class="ow">in</span> <span class="n">issues</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚ö†Ô∏è  </span><span class="si">{</span><span class="n">issue</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">‚úÖ No risky ports found</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">scan_all_security_groups</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>What this does:</strong></p>
<ul>
  <li>Scans all security groups</li>
  <li>Identifies risky ports (SSH, RDP, etc.) open to the internet</li>
  <li>Reports critical findings</li>
</ul>

<p><strong>Real-world use:</strong> This is exactly what compliance auditors look for. Finding these issues automatically saves hours of manual review!</p>

<h2 id="real-world-example-3-iam-policy-analyzer">Real-World Example 3: IAM Policy Analyzer</h2>

<p>Let‚Äôs check IAM policies for dangerous wildcard permissions:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">boto3</span>
<span class="kn">import</span> <span class="n">json</span>

<span class="k">def</span> <span class="nf">analyze_iam_policy</span><span class="p">(</span><span class="n">policy_document</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Analyze an IAM policy for security issues.</span><span class="sh">"""</span>
    <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Convert policy string to dict if needed
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">policy_document</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">policy_doc</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">policy_document</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">policy_doc</span> <span class="o">=</span> <span class="n">policy_document</span>
    
    <span class="c1"># Check each statement
</span>    <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">policy_doc</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">Statement</span><span class="sh">'</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">effect</span> <span class="o">=</span> <span class="n">statement</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">Effect</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Allow</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="n">statement</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">Action</span><span class="sh">'</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="n">statement</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">Resource</span><span class="sh">'</span><span class="p">,</span> <span class="p">[])</span>
        
        <span class="c1"># Normalize to lists
</span>        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">actions</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="n">actions</span><span class="p">]</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">resources</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="p">[</span><span class="n">resources</span><span class="p">]</span>
        
        <span class="c1"># Check for wildcard actions
</span>        <span class="k">if</span> <span class="sh">'</span><span class="s">*</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">actions</span> <span class="ow">or</span> <span class="sh">'</span><span class="s">s3:*</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">actions</span> <span class="ow">or</span> <span class="sh">'</span><span class="s">ec2:*</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="sh">"</span><span class="s">WARNING: Wildcard action found: </span><span class="si">{</span><span class="n">actions</span><span class="si">}</span><span class="s"> </span><span class="sh">"</span>
                <span class="sa">f</span><span class="sh">"</span><span class="s">(Effect: </span><span class="si">{</span><span class="n">effect</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span>
            <span class="p">)</span>
        
        <span class="c1"># Check for wildcard resources
</span>        <span class="k">if</span> <span class="sh">'</span><span class="s">*</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
            <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="sh">"</span><span class="s">CRITICAL: Wildcard resource </span><span class="sh">'</span><span class="s">*</span><span class="sh">'</span><span class="s"> found! </span><span class="sh">"</span>
                <span class="sa">f</span><span class="sh">"</span><span class="s">This allows access to ALL resources.</span><span class="sh">"</span>
            <span class="p">)</span>
        
        <span class="c1"># Check for overly permissive actions
</span>        <span class="n">dangerous_actions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sh">'</span><span class="s">iam:CreateUser</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">iam:DeleteUser</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">iam:AttachUserPolicy</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">s3:DeleteBucket</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">ec2:TerminateInstances</span><span class="sh">'</span>
        <span class="p">]</span>
        
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="k">if</span> <span class="nf">any</span><span class="p">(</span><span class="n">danger</span> <span class="ow">in</span> <span class="n">action</span> <span class="k">for</span> <span class="n">danger</span> <span class="ow">in</span> <span class="n">dangerous_actions</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">effect</span> <span class="o">==</span> <span class="sh">'</span><span class="s">Allow</span><span class="sh">'</span> <span class="ow">and</span> <span class="sh">'</span><span class="s">*</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
                    <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="sh">"</span><span class="s">CRITICAL: Dangerous action </span><span class="sh">'</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="sh">'</span><span class="s"> allowed </span><span class="sh">"</span>
                        <span class="sa">f</span><span class="sh">"</span><span class="s">on all resources!</span><span class="sh">"</span>
                    <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">issues</span>

<span class="k">def</span> <span class="nf">scan_user_policies</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Scan all IAM users and their policies.</span><span class="sh">"""</span>
    <span class="n">iam_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">iam</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">IAM Policy Security Analysis</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    
    <span class="c1"># Get all users
</span>    <span class="n">users_response</span> <span class="o">=</span> <span class="n">iam_client</span><span class="p">.</span><span class="nf">list_users</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users_response</span><span class="p">[</span><span class="sh">'</span><span class="s">Users</span><span class="sh">'</span><span class="p">]:</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">user</span><span class="p">[</span><span class="sh">'</span><span class="s">UserName</span><span class="sh">'</span><span class="p">]</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">Analyzing user: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        
        <span class="c1"># Get attached policies
</span>        <span class="n">attached_policies</span> <span class="o">=</span> <span class="n">iam_client</span><span class="p">.</span><span class="nf">list_attached_user_policies</span><span class="p">(</span>
            <span class="n">UserName</span><span class="o">=</span><span class="n">username</span>
        <span class="p">)</span>
        
        <span class="c1"># Get inline policies
</span>        <span class="n">inline_policies</span> <span class="o">=</span> <span class="n">iam_client</span><span class="p">.</span><span class="nf">list_user_policies</span><span class="p">(</span><span class="n">UserName</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>
        
        <span class="n">all_issues</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Check attached policies
</span>        <span class="k">for</span> <span class="n">policy</span> <span class="ow">in</span> <span class="n">attached_policies</span><span class="p">[</span><span class="sh">'</span><span class="s">AttachedPolicies</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">policy_arn</span> <span class="o">=</span> <span class="n">policy</span><span class="p">[</span><span class="sh">'</span><span class="s">PolicyArn</span><span class="sh">'</span><span class="p">]</span>
            <span class="n">policy_version</span> <span class="o">=</span> <span class="n">iam_client</span><span class="p">.</span><span class="nf">get_policy</span><span class="p">(</span><span class="n">PolicyArn</span><span class="o">=</span><span class="n">policy_arn</span><span class="p">)</span>
            <span class="n">default_version</span> <span class="o">=</span> <span class="n">policy_version</span><span class="p">[</span><span class="sh">'</span><span class="s">Policy</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">DefaultVersionId</span><span class="sh">'</span><span class="p">]</span>
            
            <span class="n">policy_doc</span> <span class="o">=</span> <span class="n">iam_client</span><span class="p">.</span><span class="nf">get_policy_version</span><span class="p">(</span>
                <span class="n">PolicyArn</span><span class="o">=</span><span class="n">policy_arn</span><span class="p">,</span>
                <span class="n">VersionId</span><span class="o">=</span><span class="n">default_version</span>
            <span class="p">)</span>
            
            <span class="n">issues</span> <span class="o">=</span> <span class="nf">analyze_iam_policy</span><span class="p">(</span>
                <span class="n">policy_doc</span><span class="p">[</span><span class="sh">'</span><span class="s">PolicyVersion</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">Document</span><span class="sh">'</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">all_issues</span><span class="p">.</span><span class="nf">extend</span><span class="p">(</span><span class="n">issues</span><span class="p">)</span>
        
        <span class="c1"># Check inline policies
</span>        <span class="k">for</span> <span class="n">policy_name</span> <span class="ow">in</span> <span class="n">inline_policies</span><span class="p">[</span><span class="sh">'</span><span class="s">PolicyNames</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">policy_doc</span> <span class="o">=</span> <span class="n">iam_client</span><span class="p">.</span><span class="nf">get_user_policy</span><span class="p">(</span>
                <span class="n">UserName</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
                <span class="n">PolicyName</span><span class="o">=</span><span class="n">policy_name</span>
            <span class="p">)</span>
            
            <span class="n">issues</span> <span class="o">=</span> <span class="nf">analyze_iam_policy</span><span class="p">(</span>
                <span class="n">policy_doc</span><span class="p">[</span><span class="sh">'</span><span class="s">PolicyDocument</span><span class="sh">'</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">all_issues</span><span class="p">.</span><span class="nf">extend</span><span class="p">(</span><span class="n">issues</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">all_issues</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">issue</span> <span class="ow">in</span> <span class="n">all_issues</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚ö†Ô∏è  </span><span class="si">{</span><span class="n">issue</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">‚úÖ No policy issues found</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">scan_user_policies</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>What this does:</strong></p>
<ul>
  <li>Scans all IAM users</li>
  <li>Analyzes their policies for:
    <ul>
      <li>Wildcard actions (<code class="language-plaintext highlighter-rouge">*</code>)</li>
      <li>Wildcard resources (<code class="language-plaintext highlighter-rouge">*</code>)</li>
      <li>Dangerous permissions</li>
    </ul>
  </li>
  <li>Reports security issues</li>
</ul>

<h2 id="error-handling-the-professional-way">Error Handling: The Professional Way</h2>

<p>Always handle errors properly. Here‚Äôs how:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">boto3</span>
<span class="kn">from</span> <span class="n">botocore.exceptions</span> <span class="kn">import</span> <span class="n">ClientError</span><span class="p">,</span> <span class="n">BotoCoreError</span>

<span class="k">def</span> <span class="nf">safe_aws_operation</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Example of proper error handling.</span><span class="sh">"""</span>
    <span class="n">s3_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">s3</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">s3_client</span><span class="p">.</span><span class="nf">list_buckets</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">Buckets</span><span class="sh">'</span><span class="p">]</span>
    
    <span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">error_code</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">Error</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">Code</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">error_code</span> <span class="o">==</span> <span class="sh">'</span><span class="s">AccessDenied</span><span class="sh">'</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">‚ùå Access denied. Check your IAM permissions.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">error_code</span> <span class="o">==</span> <span class="sh">'</span><span class="s">InvalidAccessKeyId</span><span class="sh">'</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">‚ùå Invalid AWS credentials.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚ùå AWS Error: </span><span class="si">{</span><span class="n">error_code</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    
    <span class="k">except</span> <span class="n">BotoCoreError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚ùå Boto3 Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚ùå Unexpected error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="pagination-handling-large-results">Pagination: Handling Large Results</h2>

<p>AWS API responses are paginated. Here‚Äôs how to handle it:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">boto3</span>

<span class="k">def</span> <span class="nf">get_all_ec2_instances</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Get all EC2 instances, handling pagination.</span><span class="sh">"""</span>
    <span class="n">ec2_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">ec2</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">all_instances</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Use paginator for automatic pagination
</span>    <span class="n">paginator</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="p">.</span><span class="nf">get_paginator</span><span class="p">(</span><span class="sh">'</span><span class="s">describe_instances</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">paginator</span><span class="p">.</span><span class="nf">paginate</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">reservation</span> <span class="ow">in</span> <span class="n">page</span><span class="p">[</span><span class="sh">'</span><span class="s">Reservations</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">all_instances</span><span class="p">.</span><span class="nf">extend</span><span class="p">(</span><span class="n">reservation</span><span class="p">[</span><span class="sh">'</span><span class="s">Instances</span><span class="sh">'</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">all_instances</span>

<span class="c1"># Or manually handle pagination
</span><span class="k">def</span> <span class="nf">get_all_s3_objects</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Get all objects in an S3 bucket.</span><span class="sh">"""</span>
    <span class="n">s3_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">s3</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">all_objects</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">s3_client</span><span class="p">.</span><span class="nf">get_paginator</span><span class="p">(</span><span class="sh">'</span><span class="s">list_objects_v2</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">paginator</span><span class="p">.</span><span class="nf">paginate</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="sh">'</span><span class="s">Contents</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">page</span><span class="p">:</span>
            <span class="n">all_objects</span><span class="p">.</span><span class="nf">extend</span><span class="p">(</span><span class="n">page</span><span class="p">[</span><span class="sh">'</span><span class="s">Contents</span><span class="sh">'</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">all_objects</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="best-practices-for-security-scripts">Best Practices for Security Scripts</h2>

<h3 id="1-use-iam-roles-not-access-keys">1. Use IAM Roles, Not Access Keys</h3>

<p><strong>Bad:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c1"># Don't hardcode credentials!
</span><span class="n">s3_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span>
    <span class="sh">'</span><span class="s">s3</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">aws_access_key_id</span><span class="o">=</span><span class="sh">'</span><span class="s">AKIA...</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="sh">'</span><span class="s">secret...</span><span class="sh">'</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Good:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c1"># Let Boto3 use default credential chain
# (IAM role, environment variables, or ~/.aws/credentials)
</span><span class="n">s3_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">s3</span><span class="sh">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-handle-errors-gracefully">2. Handle Errors Gracefully</h3>

<p>Always wrap AWS calls in try/except blocks.</p>

<h3 id="3-use-paginators">3. Use Paginators</h3>

<p>Don‚Äôt manually handle pagination. Use paginators!</p>

<h3 id="4-add-logging">4. Add Logging</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">logging</span>

<span class="n">logging</span><span class="p">.</span><span class="nf">basicConfig</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="sh">'</span><span class="s">%(asctime)s - %(levelname)s - %(message)s</span><span class="sh">'</span>
<span class="p">)</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">scan_buckets</span><span class="p">():</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Starting S3 bucket scan...</span><span class="sh">"</span><span class="p">)</span>
    <span class="c1"># ... your code ...
</span>    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Scan complete!</span><span class="sh">"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="5-make-scripts-reusable">5. Make Scripts Reusable</h3>

<p>Use functions, not just scripts:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">check_bucket_encryption</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Check if a bucket has encryption enabled.</span><span class="sh">"""</span>
    <span class="c1"># ... implementation ...
</span>
<span class="k">def</span> <span class="nf">check_bucket_public_access</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Check if a bucket blocks public access.</span><span class="sh">"""</span>
    <span class="c1"># ... implementation ...
</span>
<span class="c1"># Main function that uses the above
</span><span class="k">def</span> <span class="nf">audit_s3_bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Complete audit of an S3 bucket.</span><span class="sh">"""</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">encryption</span><span class="sh">'</span><span class="p">:</span> <span class="nf">check_bucket_encryption</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">),</span>
        <span class="sh">'</span><span class="s">public_access</span><span class="sh">'</span><span class="p">:</span> <span class="nf">check_bucket_public_access</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">results</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="key-takeaways">Key Takeaways</h2>

<ol>
  <li><strong>Boto3 is your AWS automation toolkit</strong> - Learn it well</li>
  <li><strong>Always handle errors</strong> - AWS APIs can fail</li>
  <li><strong>Use paginators</strong> - For large result sets</li>
  <li><strong>Use IAM roles</strong> - Not hardcoded credentials</li>
  <li><strong>Write reusable functions</strong> - Not one-off scripts</li>
  <li><strong>Add logging</strong> - Know what your scripts are doing</li>
  <li><strong>Test in a dev account first</strong> - Don‚Äôt break production!</li>
</ol>

<h2 id="practice-exercise">Practice Exercise</h2>

<p>Try building this yourself:</p>

<ol>
  <li>Create a script that lists all EC2 instances</li>
  <li>For each instance, check if it has encryption enabled</li>
  <li>Check if the security groups have risky ports open</li>
  <li>Generate a report in a text file</li>
</ol>

<h2 id="resources-to-learn-more">Resources to Learn More</h2>

<ul>
  <li><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html">Boto3 Documentation</a></li>
  <li><a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/python">AWS Python SDK Examples</a></li>
  <li><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/best-practices.html">Boto3 Best Practices</a></li>
</ul>

<h2 id="whats-next">What‚Äôs Next?</h2>

<p>Now that you can automate AWS with Python, you‚Äôre ready to:</p>
<ul>
  <li>Build the full compliance scanning tool</li>
  <li>Automate security incident response</li>
  <li>Create custom security monitoring scripts</li>
</ul>

<p>Remember: Automation is a force multiplier. The time you spend learning Boto3 will save you hundreds of hours in the future!</p>

<blockquote>
  <p><strong>üí° Pro Tip:</strong> Start with the AWS CLI to understand what operations you need, then translate them to Boto3. The AWS CLI commands map directly to Boto3 client methods!</p>
</blockquote>

<hr />

<p><em>Ready to containerize your scripts? Check out our next post on Docker, where we‚Äôll learn how to package your Python automation tools!</em></p>]]></content><author><name></name></author><category term="Python" /><category term="AWS" /><category term="Automation" /><category term="DevSecOps" /><category term="python" /><category term="boto3" /><category term="aws" /><category term="automation" /><category term="scripting" /><category term="security" /><category term="devsecops" /><summary type="html"><![CDATA[Manual tasks are the enemy of security. The more you automate, the less chance for human error. Let's learn how to use Python and Boto3 to automate AWS security tasks, from compliance scanning to incident response.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://placehold.co/1000x400/3776AB/FFFFFF?text=Python+%26+Boto3+Automation" /><media:content medium="image" url="https://placehold.co/1000x400/3776AB/FFFFFF?text=Python+%26+Boto3+Automation" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">AWS S3 Security: Protecting Your Cloud Storage Like a Pro</title><link href="http://0.0.0.0:4000/posts/aws-s3-security-basics/" rel="alternate" type="text/html" title="AWS S3 Security: Protecting Your Cloud Storage Like a Pro" /><published>2025-11-16T09:00:00-05:00</published><updated>2025-11-15T03:28:20-05:00</updated><id>http://0.0.0.0:4000/posts/aws-s3-security-basics</id><content type="html" xml:base="http://0.0.0.0:4000/posts/aws-s3-security-basics/"><![CDATA[<blockquote>
  <p><strong>Picture this:</strong> You‚Äôve got important documents - compliance reports, customer data, financial records. You store them in S3 (Simple Storage Service), AWS‚Äôs cloud storage. But here‚Äôs the thing: by default, S3 buckets are private, but one misconfiguration can expose everything to the entire internet. I‚Äôve seen it happen, and it‚Äôs not pretty. Let‚Äôs make sure it doesn‚Äôt happen to you.</p>
</blockquote>

<h2 id="what-is-s3-really">What is S3, Really?</h2>

<p>Think of S3 as a massive, infinite filing cabinet in the cloud. You can store:</p>
<ul>
  <li>Files (documents, images, videos)</li>
  <li>Backups</li>
  <li>Website content</li>
  <li>Application data</li>
  <li>Compliance reports</li>
</ul>

<p>Each ‚Äúdrawer‚Äù in this filing cabinet is called a <strong>bucket</strong>, and each file is called an <strong>object</strong>.</p>

<h2 id="the-s3-security-model">The S3 Security Model</h2>

<p>S3 security has three main layers:</p>

<ol>
  <li><strong>Access Control</strong> - Who can access your buckets</li>
  <li><strong>Encryption</strong> - Protecting data at rest and in transit</li>
  <li><strong>Public Access</strong> - Controlling internet exposure</li>
</ol>

<p>Let‚Äôs dive into each one.</p>

<h2 id="layer-1-access-control-iam-policies">Layer 1: Access Control (IAM Policies)</h2>

<p>Remember IAM from our last post? S3 uses IAM policies to control access. Here‚Äôs a basic example:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"s3:GetObject"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"s3:ListBucket"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"arn:aws:s3:::my-secure-bucket"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"arn:aws:s3:::my-secure-bucket/*"</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>This policy allows someone to:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">s3:ListBucket</code> - See what files are in the bucket</li>
  <li><code class="language-plaintext highlighter-rouge">s3:GetObject</code> - Download files from the bucket</li>
</ul>

<p><strong>Real-world example:</strong> Your compliance tool needs to read reports from a bucket. This policy gives it read-only access to just that one bucket.</p>

<h3 id="common-s3-actions-youll-see">Common S3 Actions You‚Äôll See</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">s3:GetObject</code> - Read/download a file</li>
  <li><code class="language-plaintext highlighter-rouge">s3:PutObject</code> - Upload a file</li>
  <li><code class="language-plaintext highlighter-rouge">s3:DeleteObject</code> - Delete a file</li>
  <li><code class="language-plaintext highlighter-rouge">s3:ListBucket</code> - List files in a bucket</li>
  <li><code class="language-plaintext highlighter-rouge">s3:GetBucketLocation</code> - Find out where a bucket is stored</li>
</ul>

<h2 id="layer-2-bucket-policies">Layer 2: Bucket Policies</h2>

<p>Bucket policies are like the rules posted on the filing cabinet itself. They‚Äôre attached directly to the bucket.</p>

<p>Here‚Äôs a bucket policy that allows public read access to a specific folder:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PublicReadGetObject"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Principal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3:GetObject"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:s3:::my-website-bucket/public/*"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Breaking it down:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">Principal: "*"</code> - Anyone (public access)</li>
  <li><code class="language-plaintext highlighter-rouge">Action: s3:GetObject</code> - Can read files</li>
  <li><code class="language-plaintext highlighter-rouge">Resource</code> - Only files in the <code class="language-plaintext highlighter-rouge">/public/</code> folder</li>
</ul>

<p><strong>Real-world example:</strong> You‚Äôre hosting a website. You want images in the <code class="language-plaintext highlighter-rouge">/public/</code> folder to be accessible to everyone, but keep everything else private.</p>

<h2 id="layer-3-block-public-access-the-safety-net">Layer 3: Block Public Access (The Safety Net)</h2>

<p>This is your most important security setting! <strong>Block Public Access</strong> is like a master switch that prevents accidental public exposure.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># Enable Block Public Access (recommended for most buckets)</span>
aws s3api put-public-access-block <span class="se">\</span>
  <span class="nt">--bucket</span> my-secure-bucket <span class="se">\</span>
  <span class="nt">--public-access-block-configuration</span> <span class="se">\</span>
  <span class="s2">"BlockPublicAcls=true,IgnorePublicAcls=true,BlockPublicPolicy=true,RestrictPublicBuckets=true"</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>What this does:</strong></p>
<ul>
  <li>Blocks new public ACLs (access control lists)</li>
  <li>Ignores existing public ACLs</li>
  <li>Blocks public bucket policies</li>
  <li>Restricts public access even if policies allow it</li>
</ul>

<p><strong>Real-world example:</strong> You‚Äôre setting up a bucket for compliance reports. You enable Block Public Access, then even if someone accidentally creates a public policy, it won‚Äôt work. Safety first!</p>

<h2 id="encryption-protecting-your-data">Encryption: Protecting Your Data</h2>

<p>Encryption is like putting your files in a safe. Even if someone gets access, they can‚Äôt read them without the key.</p>

<h3 id="encryption-at-rest-data-stored-in-s3">Encryption at Rest (Data Stored in S3)</h3>

<p>S3 offers several encryption options:</p>

<h4 id="1-sse-s3-server-side-encryption-with-s3-managed-keys">1. SSE-S3 (Server-Side Encryption with S3-Managed Keys)</h4>

<p>This is the simplest option - AWS manages everything:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c"># Enable encryption when uploading</span>
aws s3 <span class="nb">cp </span>report.pdf s3://my-bucket/ <span class="se">\</span>
  <span class="nt">--server-side-encryption</span> AES256
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Or set it as default for the bucket:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>aws s3api put-bucket-encryption <span class="se">\</span>
  <span class="nt">--bucket</span> my-bucket <span class="se">\</span>
  <span class="nt">--server-side-encryption-configuration</span> <span class="s1">'{
    "Rules": [{
      "ApplyServerSideEncryptionByDefault": {
        "SSEAlgorithm": "AES256"
      }
    }]
  }'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Real-world example:</strong> Your compliance tool generates reports and uploads them to S3. With SSE-S3 enabled, every file is automatically encrypted. No extra work needed!</p>

<h4 id="2-sse-kms-server-side-encryption-with-aws-kms">2. SSE-KMS (Server-Side Encryption with AWS KMS)</h4>

<p>More control, more security. You manage the encryption keys:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>aws s3api put-bucket-encryption <span class="se">\</span>
  <span class="nt">--bucket</span> my-bucket <span class="se">\</span>
  <span class="nt">--server-side-encryption-configuration</span> <span class="s1">'{
    "Rules": [{
      "ApplyServerSideEncryptionByDefault": {
        "SSEAlgorithm": "aws:kms",
        "KMSMasterKeyID": "arn:aws:kms:us-east-1:123456789012:key/12345678-1234-1234-1234-123456789012"
      }
    }]
  }'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>When to use KMS:</strong></p>
<ul>
  <li>You need audit logs of who accessed the keys</li>
  <li>You need to meet compliance requirements (like HIPAA)</li>
  <li>You want to control key rotation</li>
</ul>

<h3 id="encryption-in-transit-data-moving-tofrom-s3">Encryption in Transit (Data Moving to/from S3)</h3>

<p>Always use HTTPS! S3 supports TLS/SSL by default. Just make sure you‚Äôre using the HTTPS endpoint:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># Good - uses HTTPS</span>
aws s3 <span class="nb">ls </span>s3://my-bucket <span class="nt">--endpoint-url</span> https://s3.amazonaws.com

<span class="c"># Bad - uses HTTP (insecure)</span>
aws s3 <span class="nb">ls </span>s3://my-bucket <span class="nt">--endpoint-url</span> http://s3.amazonaws.com
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="versioning-your-safety-net">Versioning: Your Safety Net</h2>

<p>Versioning is like having a time machine for your files. If something gets deleted or corrupted, you can go back:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c"># Enable versioning</span>
aws s3api put-bucket-versioning <span class="se">\</span>
  <span class="nt">--bucket</span> my-bucket <span class="se">\</span>
  <span class="nt">--versioning-configuration</span> <span class="nv">Status</span><span class="o">=</span>Enabled
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Real-world example:</strong> Your compliance tool accidentally overwrites an important report. With versioning enabled, you can restore the previous version. Crisis averted!</p>

<h2 id="lifecycle-policies-automatic-cleanup">Lifecycle Policies: Automatic Cleanup</h2>

<p>Lifecycle policies automatically move or delete files based on rules. Think of it as an automatic filing system:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Rules"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DeleteOldReports"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Expiration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Days"</span><span class="p">:</span><span class="w"> </span><span class="mi">90</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"Filter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Prefix"</span><span class="p">:</span><span class="w"> </span><span class="s2">"reports/"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MoveToGlacier"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Transitions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"Days"</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w">
          </span><span class="nl">"StorageClass"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"Filter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Prefix"</span><span class="p">:</span><span class="w"> </span><span class="s2">"archive/"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>What this does:</strong></p>
<ul>
  <li>Files in <code class="language-plaintext highlighter-rouge">reports/</code> are deleted after 90 days</li>
  <li>Files in <code class="language-plaintext highlighter-rouge">archive/</code> are moved to cheaper Glacier storage after 30 days</li>
</ul>

<p><strong>Real-world example:</strong> Your compliance tool generates monthly reports. After 3 months, you don‚Äôt need them taking up expensive storage. The lifecycle policy automatically deletes them. After 1 month, archive files move to cheaper storage.</p>

<h2 id="hands-on-securing-a-compliance-report-bucket">Hands-On: Securing a Compliance Report Bucket</h2>

<p>Let‚Äôs build a secure bucket for compliance reports step-by-step:</p>

<h3 id="step-1-create-the-bucket">Step 1: Create the Bucket</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>aws s3 mb s3://compliance-reports-2025 <span class="nt">--region</span> us-east-1
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-2-enable-block-public-access">Step 2: Enable Block Public Access</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>aws s3api put-public-access-block <span class="se">\</span>
  <span class="nt">--bucket</span> compliance-reports-2025 <span class="se">\</span>
  <span class="nt">--public-access-block-configuration</span> <span class="se">\</span>
  <span class="s2">"BlockPublicAcls=true,IgnorePublicAcls=true,BlockPublicPolicy=true,RestrictPublicBuckets=true"</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-3-enable-encryption">Step 3: Enable Encryption</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>aws s3api put-bucket-encryption <span class="se">\</span>
  <span class="nt">--bucket</span> compliance-reports-2025 <span class="se">\</span>
  <span class="nt">--server-side-encryption-configuration</span> <span class="s1">'{
    "Rules": [{
      "ApplyServerSideEncryptionByDefault": {
        "SSEAlgorithm": "AES256"
      },
      "BucketKeyEnabled": true
    }]
  }'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-4-enable-versioning">Step 4: Enable Versioning</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>aws s3api put-bucket-versioning <span class="se">\</span>
  <span class="nt">--bucket</span> compliance-reports-2025 <span class="se">\</span>
  <span class="nt">--versioning-configuration</span> <span class="nv">Status</span><span class="o">=</span>Enabled
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-5-create-a-bucket-policy-read-only-for-compliance-tool">Step 5: Create a Bucket Policy (Read-Only for Compliance Tool)</h3>

<p>Save this as <code class="language-plaintext highlighter-rouge">bucket-policy.json</code>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AllowComplianceToolRead"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Principal"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"AWS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::YOUR_ACCOUNT_ID:role/ComplianceScannerRole"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"s3:GetObject"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"s3:ListBucket"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"arn:aws:s3:::compliance-reports-2025"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"arn:aws:s3:::compliance-reports-2025/*"</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Apply it:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>aws s3api put-bucket-policy <span class="se">\</span>
  <span class="nt">--bucket</span> compliance-reports-2025 <span class="se">\</span>
  <span class="nt">--policy</span> file://bucket-policy.json
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-6-test-it">Step 6: Test It!</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># This should work (if you have the right IAM role)</span>
aws s3 <span class="nb">ls </span>s3://compliance-reports-2025

<span class="c"># This should fail (public access is blocked)</span>
curl https://compliance-reports-2025.s3.amazonaws.com/report.pdf
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="common-s3-security-mistakes">Common S3 Security Mistakes</h2>

<h3 id="mistake-1-public-buckets">Mistake 1: Public Buckets</h3>

<p><strong>Don‚Äôt do this:</strong></p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Principal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3:*"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>This makes your entire bucket public. Anyone can read, write, or delete files!</p>

<p><strong>Do this instead:</strong> Use Block Public Access and specific bucket policies.</p>

<h3 id="mistake-2-no-encryption">Mistake 2: No Encryption</h3>

<p><strong>Don‚Äôt do this:</strong> Uploading sensitive files without encryption.</p>

<p><strong>Do this instead:</strong> Always enable encryption, at minimum SSE-S3.</p>

<h3 id="mistake-3-weak-access-controls">Mistake 3: Weak Access Controls</h3>

<p><strong>Don‚Äôt do this:</strong></p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3:*"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Do this instead:</strong></p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"s3:GetObject"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"s3:ListBucket"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"arn:aws:s3:::specific-bucket"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"arn:aws:s3:::specific-bucket/*"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="mistake-4-not-using-https">Mistake 4: Not Using HTTPS</h3>

<p><strong>Don‚Äôt do this:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1"># BAD - uses HTTP
</span><span class="n">s3_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">s3</span><span class="sh">'</span><span class="p">,</span> <span class="n">endpoint_url</span><span class="o">=</span><span class="sh">'</span><span class="s">http://s3.amazonaws.com</span><span class="sh">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Do this instead:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1"># GOOD - uses HTTPS (default)
</span><span class="n">s3_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">s3</span><span class="sh">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="using-s3-with-python-boto3">Using S3 with Python (Boto3)</h2>

<p>Here‚Äôs how your compliance tool would interact with S3 securely:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">boto3</span>
<span class="kn">from</span> <span class="n">botocore.exceptions</span> <span class="kn">import</span> <span class="n">ClientError</span>

<span class="c1"># Create S3 client (automatically uses HTTPS)
</span><span class="n">s3_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">s3</span><span class="sh">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">upload_compliance_report</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">object_name</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Upload a compliance report to S3 with encryption.</span><span class="sh">"""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s3_client</span><span class="p">.</span><span class="nf">upload_file</span><span class="p">(</span>
            <span class="n">file_path</span><span class="p">,</span>
            <span class="n">bucket_name</span><span class="p">,</span>
            <span class="n">object_name</span><span class="p">,</span>
            <span class="n">ExtraArgs</span><span class="o">=</span><span class="p">{</span>
                <span class="sh">'</span><span class="s">ServerSideEncryption</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">AES256</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">ContentType</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">application/pdf</span><span class="sh">'</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Successfully uploaded </span><span class="si">{</span><span class="n">object_name</span><span class="si">}</span><span class="s"> to </span><span class="si">{</span><span class="n">bucket_name</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error uploading file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">download_compliance_report</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">object_name</span><span class="p">,</span> <span class="n">local_path</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Download a compliance report from S3.</span><span class="sh">"""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s3_client</span><span class="p">.</span><span class="nf">download_file</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">object_name</span><span class="p">,</span> <span class="n">local_path</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Successfully downloaded </span><span class="si">{</span><span class="n">object_name</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error downloading file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">list_reports</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="sh">'</span><span class="s">reports/</span><span class="sh">'</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">List all compliance reports in a bucket.</span><span class="sh">"""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">s3_client</span><span class="p">.</span><span class="nf">list_objects_v2</span><span class="p">(</span>
            <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span>
            <span class="n">Prefix</span><span class="o">=</span><span class="n">prefix</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="sh">'</span><span class="s">Contents</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="sh">'</span><span class="s">Key</span><span class="sh">'</span><span class="p">]</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">Contents</span><span class="sh">'</span><span class="p">]]</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error listing objects: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

<span class="c1"># Example usage
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">bucket</span> <span class="o">=</span> <span class="sh">"</span><span class="s">compliance-reports-2025</span><span class="sh">"</span>
    
    <span class="c1"># Upload a report
</span>    <span class="nf">upload_compliance_report</span><span class="p">(</span>
        <span class="n">bucket</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">compliance_report_2025.pdf</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">reports/compliance_report_2025.pdf</span><span class="sh">"</span>
    <span class="p">)</span>
    
    <span class="c1"># List all reports
</span>    <span class="n">reports</span> <span class="o">=</span> <span class="nf">list_reports</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Found </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">reports</span><span class="p">)</span><span class="si">}</span><span class="s"> reports</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># Download a report
</span>    <span class="nf">download_compliance_report</span><span class="p">(</span>
        <span class="n">bucket</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">reports/compliance_report_2025.pdf</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">downloaded_report.pdf</span><span class="sh">"</span>
    <span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="monitoring-s3-access">Monitoring S3 Access</h2>

<p>Want to know who‚Äôs accessing your buckets? Enable CloudTrail and S3 access logging:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c"># Enable server access logging</span>
aws s3api put-bucket-logging <span class="se">\</span>
  <span class="nt">--bucket</span> compliance-reports-2025 <span class="se">\</span>
  <span class="nt">--bucket-logging-status</span> <span class="s1">'{
    "LoggingEnabled": {
      "TargetBucket": "compliance-reports-2025-logs",
      "TargetPrefix": "access-logs/"
    }
  }'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This creates a log of every request to your bucket. Perfect for compliance audits!</p>

<h2 id="key-takeaways">Key Takeaways</h2>

<ol>
  <li><strong>Always enable Block Public Access</strong> - Your safety net</li>
  <li><strong>Use encryption</strong> - At minimum SSE-S3, consider KMS for sensitive data</li>
  <li><strong>Follow least privilege</strong> - Only give access to what‚Äôs needed</li>
  <li><strong>Enable versioning</strong> - For important data</li>
  <li><strong>Use lifecycle policies</strong> - To manage costs and cleanup</li>
  <li><strong>Monitor access</strong> - Enable logging for compliance</li>
  <li><strong>Always use HTTPS</strong> - Encrypt data in transit</li>
</ol>

<h2 id="practice-exercise">Practice Exercise</h2>

<p>Try this yourself:</p>

<ol>
  <li>Create a new S3 bucket</li>
  <li>Enable Block Public Access</li>
  <li>Enable encryption (SSE-S3)</li>
  <li>Create a bucket policy that allows only your IAM user to read/write</li>
  <li>Upload a test file</li>
  <li>Try to access it publicly (should fail!)</li>
</ol>

<h2 id="resources-to-learn-more">Resources to Learn More</h2>

<ul>
  <li><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html">AWS S3 Security Best Practices</a></li>
  <li><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingEncryption.html">S3 Encryption Documentation</a></li>
  <li><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html">S3 Access Control Guide</a></li>
</ul>

<h2 id="whats-next">What‚Äôs Next?</h2>

<p>Now that you understand S3 security, you‚Äôre ready to:</p>
<ul>
  <li>Learn about EC2 security groups (our next post!)</li>
  <li>Understand VPC networking</li>
  <li>Build secure applications that store data in S3</li>
</ul>

<p>Remember: S3 is powerful, but with great power comes great responsibility. Always think about security first!</p>

<blockquote>
  <p><strong>üí° Pro Tip:</strong> Use AWS Config to automatically check if your S3 buckets have public access enabled. It‚Äôs like having a security guard that never sleeps, constantly checking your configurations!</p>
</blockquote>

<hr />

<p><em>Ready for more? Check out our next post on EC2 Security Groups, where we‚Äôll learn how to control network access to your virtual servers!</em></p>]]></content><author><name></name></author><category term="AWS" /><category term="Cloud Security" /><category term="Storage" /><category term="aws" /><category term="s3" /><category term="cloud-storage" /><category term="encryption" /><category term="access-control" /><category term="security" /><category term="beginners" /><summary type="html"><![CDATA[S3 buckets are like digital filing cabinets in the cloud. But unlike your office filing cabinet, they're accessible from anywhere in the world. Let's learn how to lock them down properly so your data stays safe.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://placehold.co/1000x400/FF9900/FFFFFF?text=AWS+S3+Security+Basics" /><media:content medium="image" url="https://placehold.co/1000x400/FF9900/FFFFFF?text=AWS+S3+Security+Basics" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>