---
layout: default
---

{% include lang.html %}

{% assign all_posts = site.posts | where_exp: 'item', 'item.hidden != true' %}

<!-- Posts Data for JavaScript -->
<script type="application/json" id="posts-data">
[
  {% for post in all_posts %}
  {
    "title": {{ post.title | jsonify }},
    "url": {{ post.url | relative_url | jsonify }},
    "date": "{{ post.date | date: '%Y-%m-%d' }}",
    "categories": {{ post.categories | jsonify }},
    "tags": {{ post.tags | jsonify }},
    "excerpt": {{ post.excerpt | default: post.content | strip_html | truncate: 200 | jsonify }},
    "image": {% if post.image %}{{ post.image | jsonify }}{% else %}null{% endif %}
  }{% unless forloop.last %},{% endunless %}
  {% endfor %}
]
</script>

<div class="flex-grow-1 px-xl-1">
  <!-- Filter and Search Controls -->
  <div class="mb-4">
    <!-- Search Bar -->
    <div class="mb-3">
      <div class="input-group">
        <span class="input-group-text">
          <i class="fas fa-search"></i>
        </span>
        <input 
          type="text" 
          id="search-input" 
          class="form-control" 
          placeholder="Search posts by title, content, or tags..."
          onkeyup="filterPosts()"
        >
      </div>
    </div>

    <!-- Category Filter -->
    <div class="mb-3">
      <label class="form-label fw-bold">Filter by Category:</label>
      <div class="d-flex flex-wrap gap-2" id="category-filters">
        <button 
          class="btn btn-sm btn-outline-primary active" 
          onclick="toggleCategoryFilter('all')"
          data-category="all"
        >
          All Categories
        </button>
        {% assign all_categories = '' | split: '' %}
        {% for post in all_posts %}
          {% for category in post.categories %}
            {% unless all_categories contains category %}
              {% assign all_categories = all_categories | push: category %}
            {% endunless %}
          {% endfor %}
        {% endfor %}
        {% for category in all_categories %}
        <button 
          class="btn btn-sm btn-outline-primary" 
          onclick="toggleCategoryFilter('{{ category }}')"
          data-category="{{ category }}"
        >
          {{ category }}
        </button>
        {% endfor %}
      </div>
    </div>

    <!-- Tag Filter -->
    <div class="mb-3">
      <label class="form-label fw-bold">Filter by Tags:</label>
      <div class="d-flex flex-wrap gap-2" id="tag-filters">
        {% assign all_tags = '' | split: '' %}
        {% for post in all_posts %}
          {% for tag in post.tags %}
            {% unless all_tags contains tag %}
              {% assign all_tags = all_tags | push: tag %}
            {% endunless %}
          {% endfor %}
        {% endfor %}
        {% assign sorted_tags = all_tags | sort %}
        {% for tag in sorted_tags %}
        <button 
          class="btn btn-sm btn-outline-secondary tag-filter-btn" 
          onclick="toggleTagFilter('{{ tag }}')"
          data-tag="{{ tag }}"
        >
          #{{ tag }}
        </button>
        {% endfor %}
      </div>
    </div>

    <!-- Sort Options -->
    <div class="mb-3 d-flex align-items-center gap-3">
      <label class="form-label fw-bold mb-0">Sort by:</label>
      <select id="sort-select" class="form-select form-select-sm" style="width: auto;" onchange="sortPosts()">
        <option value="newest">Newest First</option>
        <option value="oldest">Oldest First</option>
        <option value="title-asc">Title (A-Z)</option>
        <option value="title-desc">Title (Z-A)</option>
        <option value="category">Category</option>
      </select>
      <span class="text-muted small" id="results-count"></span>
    </div>

    <!-- Active Filters Display -->
    <div id="active-filters" class="mb-3 d-none">
      <small class="text-muted">Active filters: </small>
      <span id="active-filters-list"></span>
      <button class="btn btn-sm btn-link text-danger p-0 ms-2" onclick="clearAllFilters()">
        Clear all
      </button>
    </div>
  </div>

  <!-- Posts Container -->
  <div id="post-list" class="flex-grow-1">
    <!-- Posts will be dynamically loaded here -->
  </div>

  <!-- No Results Message -->
  <div id="no-results" class="text-center py-5 d-none">
    <i class="fas fa-search fa-3x text-muted mb-3"></i>
    <p class="text-muted">No posts found matching your filters.</p>
    <button class="btn btn-outline-primary" onclick="clearAllFilters()">Clear Filters</button>
  </div>
</div>

<script>
(function() {
  // Get posts data from JSON
  const postsDataScript = document.getElementById('posts-data');
  let allPosts = JSON.parse(postsDataScript.textContent);
  let filteredPosts = [...allPosts];
  let selectedCategories = new Set(['all']);
  let selectedTags = new Set();
  let searchQuery = '';
  let sortBy = 'newest';

  // Initialize
  document.addEventListener('DOMContentLoaded', function() {
    renderPosts();
    updateResultsCount();
  });

  // Toggle category filter
  window.toggleCategoryFilter = function(category) {
    const button = document.querySelector(`[data-category="${category}"]`);
    
    if (category === 'all') {
      // If "All" is clicked, clear other category selections
      selectedCategories.clear();
      selectedCategories.add('all');
      document.querySelectorAll('[data-category]').forEach(btn => {
        btn.classList.remove('active');
      });
      button.classList.add('active');
    } else {
      // Remove "all" if a specific category is selected
      selectedCategories.delete('all');
      const allBtn = document.querySelector('[data-category="all"]');
      if (allBtn) allBtn.classList.remove('active');
      
      // Toggle the selected category
      if (selectedCategories.has(category)) {
        selectedCategories.delete(category);
        button.classList.remove('active');
      } else {
        selectedCategories.add(category);
        button.classList.add('active');
      }
      
      // If no categories selected, select "all"
      if (selectedCategories.size === 0) {
        selectedCategories.add('all');
        const allBtn = document.querySelector('[data-category="all"]');
        if (allBtn) allBtn.classList.add('active');
      }
    }
    
    filterPosts();
  };

  // Toggle tag filter
  window.toggleTagFilter = function(tag) {
    const button = document.querySelector(`[data-tag="${tag}"]`);
    
    if (selectedTags.has(tag)) {
      selectedTags.delete(tag);
      button.classList.remove('active');
    } else {
      selectedTags.add(tag);
      button.classList.add('active');
    }
    
    filterPosts();
  };

  // Filter posts
  window.filterPosts = function() {
    searchQuery = document.getElementById('search-input').value.toLowerCase();
    
    filteredPosts = allPosts.filter(post => {
      // Category filter
      if (!selectedCategories.has('all')) {
        const postCategories = post.categories || [];
        const hasSelectedCategory = Array.from(selectedCategories).some(cat => 
          postCategories.includes(cat)
        );
        if (!hasSelectedCategory) return false;
      }
      
      // Tag filter
      if (selectedTags.size > 0) {
        const postTags = post.tags || [];
        const hasSelectedTag = Array.from(selectedTags).some(tag => 
          postTags.includes(tag)
        );
        if (!hasSelectedTag) return false;
      }
      
      // Search filter
      if (searchQuery) {
        const searchableText = (
          post.title + ' ' + 
          post.excerpt + ' ' + 
          (post.tags || []).join(' ') + ' ' +
          (post.categories || []).join(' ')
        ).toLowerCase();
        
        if (!searchableText.includes(searchQuery)) return false;
      }
      
      return true;
    });
    
    sortPosts();
    renderPosts();
    updateResultsCount();
    updateActiveFilters();
  };

  // Sort posts
  window.sortPosts = function() {
    sortBy = document.getElementById('sort-select').value;
    
    filteredPosts.sort((a, b) => {
      switch(sortBy) {
        case 'newest':
          return new Date(b.date) - new Date(a.date);
        case 'oldest':
          return new Date(a.date) - new Date(b.date);
        case 'title-asc':
          return a.title.localeCompare(b.title);
        case 'title-desc':
          return b.title.localeCompare(a.title);
        case 'category':
          const catA = (a.categories || [])[0] || '';
          const catB = (b.categories || [])[0] || '';
          return catA.localeCompare(catB) || a.title.localeCompare(b.title);
        default:
          return 0;
      }
    });
    
    renderPosts();
  };

  // Render posts
  function renderPosts() {
    const container = document.getElementById('post-list');
    const noResults = document.getElementById('no-results');
    
    if (filteredPosts.length === 0) {
      container.innerHTML = '';
      noResults.classList.remove('d-none');
      return;
    }
    
    noResults.classList.add('d-none');
    container.innerHTML = filteredPosts.map(post => {
      const date = new Date(post.date);
      const formattedDate = date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
      
      const categories = (post.categories || []).map(cat => 
        `<span class="badge bg-primary me-1">${cat}</span>`
      ).join('');
      
      const tags = (post.tags || []).slice(0, 3).map(tag => 
        `<span class="badge bg-secondary me-1">#${tag}</span>`
      ).join('');
      
      const imageHtml = post.image ? 
        `<div class="col-md-5">
          <img src="${post.image}" alt="${post.title}" class="w-100 h-100 object-fit-cover rounded-start">
        </div>` : '';
      
      const cardBodyCol = post.image ? '7' : '12';
      
      return `
        <article class="card-wrapper card mb-4">
          <a href="${post.url}" class="post-preview row g-0 flex-md-row-reverse text-decoration-none">
            ${imageHtml}
            <div class="col-md-${cardBodyCol}">
              <div class="card-body d-flex flex-column">
                <h1 class="card-title my-2 mt-md-0">${post.title}</h1>
                <div class="card-text content mt-0 mb-3">
                  <p>${post.excerpt}</p>
                </div>
                <div class="post-meta flex-grow-1 d-flex flex-column">
                  <div class="mb-2">
                    ${categories}
                    ${tags}
                    ${(post.tags || []).length > 3 ? `<span class="badge bg-light text-dark">+${(post.tags || []).length - 3} more</span>` : ''}
                  </div>
                  <div class="d-flex justify-content-between align-items-end">
                    <div class="text-muted small">
                      <i class="far fa-calendar fa-fw"></i>
                      ${formattedDate}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </a>
        </article>
      `;
    }).join('');
  }

  // Update results count
  function updateResultsCount() {
    const countEl = document.getElementById('results-count');
    const total = allPosts.length;
    const filtered = filteredPosts.length;
    
    if (filtered === total) {
      countEl.textContent = `Showing all ${total} posts`;
    } else {
      countEl.textContent = `Showing ${filtered} of ${total} posts`;
    }
  }

  // Update active filters display
  function updateActiveFilters() {
    const activeFiltersEl = document.getElementById('active-filters');
    const activeFiltersListEl = document.getElementById('active-filters-list');
    
    const activeFilters = [];
    
    if (!selectedCategories.has('all') && selectedCategories.size > 0) {
      activeFilters.push(...Array.from(selectedCategories).map(cat => 
        `<span class="badge bg-primary me-1">Category: ${cat}</span>`
      ));
    }
    
    if (selectedTags.size > 0) {
      activeFilters.push(...Array.from(selectedTags).map(tag => 
        `<span class="badge bg-secondary me-1">Tag: #${tag}</span>`
      ));
    }
    
    if (searchQuery) {
      activeFilters.push(`<span class="badge bg-info me-1">Search: "${searchQuery}"</span>`);
    }
    
    if (activeFilters.length > 0) {
      activeFiltersListEl.innerHTML = activeFilters.join('');
      activeFiltersEl.classList.remove('d-none');
    } else {
      activeFiltersEl.classList.add('d-none');
    }
  }

  // Clear all filters
  window.clearAllFilters = function() {
    selectedCategories.clear();
    selectedCategories.add('all');
    selectedTags.clear();
    searchQuery = '';
    document.getElementById('search-input').value = '';
    document.getElementById('sort-select').value = 'newest';
    sortBy = 'newest';
    
    // Reset UI
    document.querySelectorAll('[data-category]').forEach(btn => {
      btn.classList.remove('active');
    });
    document.querySelector('[data-category="all"]').classList.add('active');
    
    document.querySelectorAll('.tag-filter-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    
    filterPosts();
  };
})();
</script>

<style>
.tag-filter-btn.active {
  background-color: var(--bs-secondary) !important;
  border-color: var(--bs-secondary) !important;
  color: white !important;
}

.btn-outline-primary.active {
  background-color: var(--bs-primary) !important;
  border-color: var(--bs-primary) !important;
  color: white !important;
}

#post-list .card-wrapper {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

#post-list .card-wrapper:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
}

.input-group-text {
  background-color: var(--main-bg);
  border-color: var(--main-border-color);
}

.form-control, .form-select {
  background-color: var(--main-bg);
  border-color: var(--main-border-color);
  color: var(--main-text-color);
}

.form-control:focus, .form-select:focus {
  background-color: var(--main-bg);
  border-color: var(--sidebar-active-color);
  color: var(--main-text-color);
  box-shadow: 0 0 0 0.2rem rgba(var(--bs-primary-rgb), 0.25);
}

#active-filters {
  padding: 0.75rem;
  background-color: var(--main-bg);
  border: 1px solid var(--main-border-color);
  border-radius: 0.375rem;
}

.badge {
  font-size: 0.75rem;
  padding: 0.35em 0.65em;
}
</style>
